---
title: "å½•éŸ³"
tag: "éŸ³è§†é¢‘"
---

html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Record Page</title>
    <link rel="stylesheet" type="text/css" href="index.css" />
  </head>

  <body>
    <h3>å½•éŸ³æ¡ˆä¾‹</h3>

    <div class="app">
      <audio controls class="audio-player"></audio>
      <div class="audioWarp">
        <div>â–·</div>
        <div>0:00</div>
        <div>/</div>
        <div class="val">0:00</div>
        <div class="progress"></div>
        <!-- <div>ğŸ”ˆğŸ”ˆğŸ“¢</div> -->
        <div class="horn">ğŸ”Š</div>
      </div>
      <button class="record-btn">å½•éŸ³</button>
      <a id="download" download="record.aac"></a>
    </div>
  </body>
  <script src="index.js"></script>
</html>
```

css

```css
* {
  padding: 0;
  margin: 0;
}
body {
  height: 100vh;
  background: radial-gradient(
      at 29.362541743542515% 46.30863360967681%,
      hsla(194.01197604790417, 95.4285714285714%, 65.68627450980392%, 1) 0%,
      hsla(194.01197604790417, 95.4285714285714%, 65.68627450980392%, 0) 100%
    ), radial-gradient(
      at 58.62746524618174% 94.74424965531507%,
      hsla(196.49122807017542, 87.69230769230768%, 61.76470588235294%, 1) 0%,
      hsla(196.49122807017542, 87.69230769230768%, 61.76470588235294%, 0) 100%
    ), radial-gradient(
      at 62.0864874076154% 12.731703134335959%,
      hsla(187.05882352941174, 62.962962962962976%, 94.70588235294117%, 1) 0%,
      hsla(187.05882352941174, 62.962962962962976%, 94.70588235294117%, 0) 100%
    ), radial-gradient(
      at 72.53535377107383% 87.95273269401827%,
      hsla(206.47058823529414, 90.42553191489363%, 36.86274509803921%, 1) 0%,
      hsla(206.47058823529414, 90.42553191489363%, 36.86274509803921%, 0) 100%
    ), radial-gradient(
      at 72.37241374312025% 13.764280680936869%,
      hsla(202.5, 66.66666666666666%, 35.294117647058826%, 1) 0%,
      hsla(202.5, 66.66666666666666%, 35.294117647058826%, 0) 100%
    ), radial-gradient(at 66.85255500515754% 26.25784786972436%, hsla(
          194.01197604790417,
          95.4285714285714%,
          65.68627450980392%,
          1
        ) 0%, hsla(
          194.01197604790417,
          95.4285714285714%,
          65.68627450980392%,
          0
        ) 100%);
}
.app {
  display: flex;
  justify-content: center;
  align-items: center;
}

.record-btn {
  padding: 10px 20px;
  margin: 0 10px;
  background-color: #8181f1;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.audio-player {
  display: none;
}
h3 {
  padding: 50px 0;
  text-align: center;
}
.audioWarp {
  width: 200px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  border-radius: 20px;
  background-color: #f1f3f4;
  font-size: 14px;
}
.progress {
  width: 40%;
  height: 5px;
  border-radius: 20px;
  background-color: #c1c2c3;
}
.horn {
  opacity: 0.5;
}
```

js

```js
const recordBtn = document.querySelector(".record-btn");
const player = document.querySelector(".audio-player");
const download = document.querySelector("#download");
const val = document.querySelector(".val");
let count = 0;
let timer = null;
if (navigator.mediaDevices.getUserMedia) {
  let audioChunks = [];
  // çº¦æŸå±æ€§
  const constraints = {
    // éŸ³é¢‘çº¦æŸ
    audio: {
      sampleRate: 16000, // é‡‡æ ·ç‡
      sampleSize: 16, // æ¯ä¸ªé‡‡æ ·ç‚¹å¤§å°çš„ä½æ•°
      channelCount: 1, // é€šé“æ•°
      volume: 1, // ä» 0ï¼ˆé™éŸ³ï¼‰åˆ° 1ï¼ˆæœ€å¤§éŸ³é‡ï¼‰å–å€¼ï¼Œè¢«ç”¨ä½œæ¯ä¸ªæ ·æœ¬å€¼çš„ä¹˜æ•°
      echoCancellation: true, // å¼€å¯å›éŸ³æ¶ˆé™¤
      noiseSuppression: true, // å¼€å¯é™å™ªåŠŸèƒ½
    },
    // è§†é¢‘çº¦æŸ
    video: false,
  };
  // è¯·æ±‚è·å–éŸ³é¢‘æµ
  navigator.mediaDevices
    .getUserMedia(constraints)
    .catch((err) => serverLog("ERROR mediaDevices.getUserMedia: ${err}"))
    .then(
      (stream) => {
        // åœ¨æ­¤å¤„ç†éŸ³é¢‘æµ
        // åˆ›å»º MediaRecorder å®ä¾‹
        const mediaRecorder = new MediaRecorder(stream);
        // ç‚¹å‡»æŒ‰é’®
        recordBtn.onclick = () => {
          if (mediaRecorder.state === "recording") {
            // å½•åˆ¶å®Œæˆååœæ­¢
            mediaRecorder.stop();
            recordBtn.textContent = "å½•éŸ³ç»“æŸ,ç»§ç»­ç‚¹å‡»å¯é‡æ–°å½•éŸ³";
            clearInterval(timer);
            count = 0;
          } else {
            // å¼€å§‹å½•åˆ¶
            mediaRecorder.start();
            timer = setInterval(() => {
              count++;
              let temp = count % 60 > 9 ? count % 60 : "0" + (count % 60);
              val.textContent = Math.floor(count / 60) + ":" + temp;
            }, 1000);
            recordBtn.textContent = `å½•éŸ³ä¸­â€¦â€¦ç»§ç»­ç‚¹å‡»ç»“æŸå½•éŸ³`;
          }
        };
        mediaRecorder.ondataavailable = (e) => {
          audioChunks.push(e.data);
        };
        // ç»“æŸäº‹ä»¶
        mediaRecorder.onstop = (e) => {
          // å°†å½•åˆ¶çš„æ•°æ®ç»„è£…æˆ Blobï¼ˆbinary large objectï¼‰ å¯¹è±¡ï¼ˆä¸€ä¸ªä¸å¯ä¿®æ”¹çš„å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®çš„å®¹å™¨ï¼‰
          const blob = new Blob(audioChunks, { type: "audio/aac" });
          audioChunks = [];
          const audioURL = window.URL.createObjectURL(blob);
          // èµ‹å€¼ç»™ä¸€ä¸ª <audio> å…ƒç´ çš„ src å±æ€§è¿›è¡Œæ’­æ”¾
          player.src = audioURL;
          // æ·»åŠ ä¸‹è½½åŠŸèƒ½
          download.innerHTML = "ä¸‹è½½";
          download.href = audioURL;
        };
      },
      () => {
        console.error("æˆæƒå¤±è´¥ï¼");
      }
    );
} else {
  console.error("è¯¥æµè§ˆå™¨ä¸æ”¯æŒ getUserMediaï¼");
}
```
