---
title: "ä¸è¦é”™è¿‡ES2024(ES15)è¿™5ä¸ªæ–°ç‰¹æ€§"
tag: "æ–°ç‰¹æ€§"
time: 2025-01-13 13:01:58
---

## 1\. Promise.withResolvers

ä¸ç¬¨é‡çš„ Promise æ„é€ æ–¹æ³•è¯´å†è§å§ã€‚Promise.withResolvers æä¾›äº†ä¸€ç§æ›´ä¸ºç›´æ¥çš„æ–¹æ³•æ¥åˆ›å»º Promiseï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ä»å¤–éƒ¨è®¿é—® resolve å’Œ reject å›è°ƒã€‚

```js
const { promise, resolve, reject } = Promise.withResolvers();

setTimeout(() => resolve("Resolved after 2 seconds"), 2000);
promise.then((value) => console.log(value));
```

è¿™ä½¿å¾—å¼‚æ­¥æ“ä½œæ›´åŠ é¡ºç•…ã€‚

**ä»¥ä¸‹å†…å®¹ä¸ºç¿»è¯‘äººå‘˜è¡¥å……å†…å®¹ï¼š**

å…ˆå›é¡¾ä¸€ä¸‹ä¼ ç»Ÿçš„æ–¹å¼ã€‚åœ¨ä½¿ç”¨ Promise çš„æ—¶å€™ï¼Œç»å¸¸ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼šéœ€è¦æ‰‹åŠ¨æ§åˆ¶ Promise ä½•æ—¶è¿›è¡Œ resolve æˆ– rejectï¼Œè€Œéåœ¨å¼‚æ­¥æ“ä½œå®Œæˆåè‡ªåŠ¨ resolve æˆ– rejectï¼Œè¿™ç§éœ€æ±‚ä¸‹é€šå¸¸åˆ›å»ºä¸€ä¸ªâ€œå»¶è¿Ÿå¯¹è±¡â€ï¼ˆDeferred Objectï¼‰ï¼Œä»¥ä¾¿åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåå†å†³å®šä½•æ—¶ä»¥åŠå¦‚ä½•å¤„ç† Promise.

```js
class Deferred {
  constructor() {
    this.promise = new Promise((resolve, reject) => {
      this.resolve = resolve;
      this.reject = reject;
    });
  }
}

const deferred = new Deferred();

deferred.resolve();
```

é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†åœ¨ Promise æ„é€ å‡½æ•°çš„æ‰§è¡Œå™¨å‡½æ•°ä¸­æ‰‹åŠ¨å°† resolve å’Œ reject èµ‹å€¼ç»™å¤–éƒ¨å˜é‡ã€‚è¿™ç§æ–¹å¼è¾ƒä¸ºç¹çï¼Œä¸”ä»£ç ä¸å¤Ÿç®€æ´ã€‚ç›´æ¥ä½¿ç”¨ Promise.withResolversï¼Œå¯ä»¥åœ¨ä¸€è¡Œä»£ç ä¸­åŒæ—¶è·å– promiseã€resolve å’Œ rejectï¼Œä½¿ä»£ç æ›´ç®€æ´æ˜äº†ã€‚

è¯­æ³•å¦‚ä¸‹ï¼š

```js
const { promise, resolve, reject } = Promise.withResolvers();
```

- promiseï¼šä¸€ä¸ªæ–°çš„ Promise å®ä¾‹
- resolveï¼šä¸è¯¥ Promise å®ä¾‹å…³è”çš„ resolve å‡½æ•°
- rejectï¼šä¸è¯¥ Promise å®ä¾‹å…³è”çš„ reject å‡½æ•°

## 2\. Object.groupBy( )

ä½¿ç”¨ Object.groupBy( ) å¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚è¯¥æ–¹æ³•å¯ä»¥æ ¹æ®æŒ‡å®šçš„å±æ€§å°†å¯¹è±¡åˆ†ç»„åˆ°å¯¹åº”çš„æ•°ç»„ä¸­ï¼Œè®©ä½ å¯ä»¥æ›´åŠ è½»æ¾çš„ç»„ç»‡å’Œåˆ†ææ•°æ®ã€‚

```js
const animals = [
  { gender: "male", name: "Charlie" },
  { gender: "female", name: "Luna" },
  { gender: "male", name: "Max" },
];

const groupedAnimals = Object.groupBy(animals, (animal) => animal.gender);
console.log(groupedAnimals);

// Output:
// {
//   female: [{ gender: 'female', name: 'Luna' }],
//   male: [{ gender: 'male', name: 'Charlie' }, { gender: 'male', name: 'Max' }],
// }
```

ä»¥ä¸‹å†…å®¹ä¸ºç¿»è¯‘äººå‘˜è¡¥å……å†…å®¹ï¼š

è¯¥æ–°ç‰¹æ€§åœ¨åˆ†æç»Ÿè®¡æ•°æ®æ—¶éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚å°†ç”¨æˆ·æŒ‰å¹´é¾„æ®µåˆ†ç»„ã€æŒ‰é”€å”®é¢åˆ†ç»„ç­‰ï¼Œå¯ä»¥è½»æ¾å®ç°ã€‚Object.groupBy( ) è¯­æ³•å¦‚ä¸‹ï¼š

```js
Object.groupBy(array, callback);
```

- arrayï¼šéœ€è¦åˆ†ç»„çš„æ•°ç»„
- callbackï¼šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨æ¥ç¡®å®šåˆ†ç»„ä¾æ®ã€‚å®ƒä¼šæ¥æ”¶å½“å‰æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›ç”¨äºåˆ†ç»„çš„é”®å€¼ã€‚

```js
const fruits = [
  { name: "apple", type: "pome" },
  { name: "banana", type: "berry" },
  { name: "cherry", type: "drupe" },
  { name: "pear", type: "pome" },
];

// æ ¹æ®æ°´æœçš„ç±»å‹è¿›è¡Œåˆ†ç»„
const groupedByType = Object.groupBy(fruits, (fruit) => fruit.type);
console.log(groupedByType);
/* è¾“å‡ºï¼š
{
  pome: [{ name: 'apple', type: 'pome' }, { name: 'pear', type: 'pome' }],
  berry: [{ name: 'banana', type: 'berry' }],
  drupe: [{ name: 'cherry', type: 'drupe' }]
}
*/
```

```js
const fruits = [
  { name: "pineappleğŸ", color: "ğŸŸ¡" },
  { name: "appleğŸ", color: "ğŸ”´" },
  { name: "bananağŸŒ", color: "ğŸŸ¡" },
  { name: "strawberryğŸ“", color: "ğŸ”´" },
];

const groupedByColor = Object.groupBy(fruits, (fruit, index) => fruit.color);

// åŸç”Ÿ group by ç¤ºä¾‹
console.log(groupedByColor);
/*
è¾“å‡ºï¼š
{
'ğŸŸ¡': [
  { name: 'pineappleğŸ', color: 'ğŸŸ¡' },
  { name: 'bananağŸŒ', color: 'ğŸŸ¡' }
],
'ğŸ”´': [
  { name: 'appleğŸ', color: 'ğŸ”´' },
  { name: 'strawberryğŸ“', color: 'ğŸ”´' }
]
}
*/
```

## 3\. Temporal

Temporal API å¯ä»¥ä½¿æˆ‘ä»¬åœ¨ JS ä¸­å¤„ç†æ—¥æœŸå’Œæ—¶é—´çš„æ–¹å¼æ›´åŠ ç°ä»£åŒ–ã€‚Temporal å¼•å…¥äº†ä¸“é—¨ç”¨äºå¤„ç†æ—¥æœŸã€æ—¶é—´ã€æ—¶æ®µçš„æ•°æ®ç±»å‹ï¼ŒåŒæ—¶è¿˜å¼•å…¥äº†æ›´ç›´è§‚çš„åˆ›å»ºã€æ“ä½œã€æ ¼å¼åŒ–è¿™äº›æ•°æ®çš„å‡½æ•°ã€‚

```js
const today = Temporal.PlainDate.from({ year: 2023, month: 11, day: 19 });
console.log(today.toString()); // Output: 2023-11-19

const duration = Temporal.Duration.from({ hours: 3, minutes: 30 });
const tomorrow = today.add(duration);
console.log(tomorrow.toString()); // Output: 2023-11-20
```

ä»¥ä¸‹å†…å®¹ä¸ºç¿»è¯‘äººå‘˜è¡¥å……å†…å®¹ï¼š

**ä¸ºä»€ä¹ˆéœ€è¦ Temporalï¼Ÿ**

1. ä¿®å¤ Date çš„é—®é¢˜ï¼šDate API å­˜åœ¨è®¾è®¡ç¼ºé™·ï¼Œæ¯”å¦‚ï¼š

- ä¸å¯å˜æ€§ï¼šDate å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œå®¹æ˜“å¯¼è‡´æ„å¤–çš„å‰¯ä½œç”¨ã€‚
- ä¸æ”¯æŒæ—¶åŒºå¤„ç†ï¼šDate åªèƒ½å¤„ç†æœ¬åœ°æ—¶åŒºæˆ– UTCã€‚
- æ–¹æ³•ä¸ç›´è§‚ï¼šå¾ˆå¤š Date æ–¹æ³•æœ‰å‰¯ä½œç”¨ï¼Œæˆ–è€…å‘½åä¸æ¸…æ™°ã€‚

3. ç°ä»£éœ€æ±‚ï¼šå¼€å‘è€…éœ€è¦æ›´å¼ºå¤§çš„æ—¶é—´æ“ä½œå·¥å…·æ¥åº”å¯¹å›½é™…åŒ–ã€å¤šæ—¶åŒºã€æ—¥å†è½¬æ¢ç­‰éœ€æ±‚ã€‚

Temporal API å¼•å…¥äº†ä¸€ç»„ä¸“ç”¨ç±»å‹ï¼Œæ¯ç§ç±»å‹éƒ½é’ˆå¯¹ç‰¹å®šçš„æ—¶é—´ç›¸å…³æ¦‚å¿µï¼Œå¹¶ä¸”å…·å¤‡ä»¥ä¸‹é€šç”¨ç‰¹æ€§ï¼š

- ä¸å¯å˜æ€§ï¼šæ‰€æœ‰ Temporal å¯¹è±¡éƒ½æ˜¯ä¸å¯å˜çš„ã€‚
- æ”¯æŒæ—¶åŒºå’Œæ—¥å†ï¼šå¯å¤„ç†å¤æ‚çš„æ—¶åŒºå’Œéå…¬å†ï¼ˆå¦‚ä¼Šæ–¯å…°å†ï¼‰æ—¥æœŸã€‚
- æ›´ç›´è§‚çš„ APIï¼šæä¾›æ˜“ç”¨ã€æ˜“ç†è§£çš„è¯­æ³•ã€‚

ä¸‹é¢æä¾›ä¸€äº› Temporal çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

```js
const date = Temporal.PlainDate.from({ year: 2006, month: 8, day: 24 }); // => 2006-08-24
date.year; // => 2006
date.inLeapYear; // => false
date.toString(); // => '2006-08-24'
```

å¦å¤–è¯¥ç‰¹æ€§ç›®å‰è¿˜æ²¡æœ‰æ­£å¼è½åœ°ï¼Œå³ä¾¿æ˜¯æœ€æ–°çš„ chrome æµè§ˆå™¨éƒ½è¿˜ä¸æ”¯æŒè¯¥ç‰¹æ€§ã€‚ä½ å¯ä»¥åœ¨ https://tc39.es/proposal-temporal/docs/ æŸ¥çœ‹è¯¥ç‰¹æ€§çš„æœ€æ–°åŠ¨æ€ã€‚

## 4\. Records and Tuples

Record å’Œ Tuple å¼•å…¥äº†æ›´ä¸ºå¥å£®å’Œç±»å‹å®‰å…¨çš„æ–¹å¼æ¥å¤„ç†ç»“æ„åŒ–çš„æ•°æ®ã€‚Record ç±»ä¼¼äºå¯¹è±¡ï¼Œä½†å…·æœ‰ä¸€ç»„å›ºå®šçš„ç±»å‹åŒ–å±æ€§ã€‚Tuple ç±»ä¼¼äºæœ‰å›ºå®šé•¿åº¦çš„æ•°ç»„ï¼Œæ•°ç»„é‡Œé¢çš„æ¯ä¸ªå…ƒç´ å¯ä»¥å…·æœ‰ä¸åŒçš„ç±»å‹ã€‚

```js
let record = #{
  id: 1,
  name: "JavaScript",
  year: 2024,
};
console.log(record.name); // Output: JavaScript
```

**ä»¥ä¸‹å†…å®¹ä¸ºç¿»è¯‘äººå‘˜è¡¥å……å†…å®¹ï¼š**

Record å’Œ Tuple æ˜¯ ES2024 ææ¡ˆä¸­çš„ä¸¤ä¸ªå…¨æ–°æ•°æ®ç»“æ„ï¼Œç›®çš„æ˜¯ä¸º JS å¼•å…¥ä¸å¯å˜çš„ç»“æ„åŒ–æ•°æ®ã€‚

**Record ç‰¹ç‚¹ï¼š**

- ç±»ä¼¼äºä¸å¯å˜çš„å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹ï¼Œé”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„çš„ JS æ•°æ®ã€‚

```js
const record = #{ a: 1, b: 2 };
console.log(record.a); // 1
console.log(record.b); // 2
```

- ä¸å¯å˜æ€§ï¼šä¸€æ—¦åˆ›å»ºï¼Œå°±æ— æ³•æ›´æ”¹ã€‚

```js
const record = #{ a: 1 };
record.a = 2; // TypeError: Cannot assign to read-only property
```

- ç»“æ„åŒ–æ¯”è¾ƒï¼šä¸¤ä¸ªç»“æ„ç›¸åŒçš„ Record ä¼šè¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼Œå³ä½¿å®ƒä»¬åœ¨å†…å­˜ä¸­æ˜¯ä¸¤ä¸ªä¸åŒçš„å®ä¾‹ã€‚

```js
const obj1 = { a: 1 };
const obj2 = { a: 1 };
console.log(obj1 === obj2); // false

const record1 = #{ a: 1 };
const record2 = #{ a: 1 };
console.log(record1 === record2); // true
```

**Tuple ç‰¹ç‚¹ï¼š**

- ç±»ä¼¼äºä¸å¯å˜çš„æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æœ‰åºçš„æ•°æ®é›†åˆã€‚

```js
const tuple = #[1, 2, 3];
console.log(tuple[0]); // 1
```

- ä¸å¯å˜æ€§ï¼šä¸€æ—¦åˆ›å»ºï¼Œå°±æ— æ³•æ›´æ”¹ã€‚

```js
const tuple = #[1, 2];
tuple[0] = 3; // TypeError: Cannot assign to read-only property
```

- ç»“æ„åŒ–æ¯”è¾ƒï¼šä¸¤ä¸ªç»“æ„ç›¸åŒçš„ Tuple ä¼šè¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ã€‚

```js
const tuple1 = #[1, 2];
const tuple2 = #[1, 2];
console.log(tuple1 === tuple2); // true
```

å¦å¤–æ— è®ºæ˜¯ Record è¿˜æ˜¯ Tupleï¼Œç›®å‰ä»ç„¶å¤„äºææ¡ˆé˜¶æ®µï¼Œå³ä¾¿æ˜¯æœ€æ–°çš„ chrome æµè§ˆå™¨ï¼Œéƒ½è¿˜ä¸æ”¯æŒè¿™ä¸¤ç§æ–°çš„æ•°æ®ç»“æ„ã€‚

ä½ å¯ä»¥åœ¨ https://tc39.es/proposal-record-tuple/ æŸ¥çœ‹è¿™ä¸¤ç§æ–°æ•°æ®ç»“æ„çš„æœ€æ–°åŠ¨æ€ã€‚

## 5\. Decorator

è£…é¥°å™¨æä¾›äº†ä¸€ç§ç®€æ´çš„æ–¹æ³•æ¥æ·»åŠ å…ƒæ•°æ®æˆ–ä¿®æ”¹ç±»ã€å‡½æ•°æˆ–å±æ€§çš„è¡Œä¸ºã€‚è£…é¥°å™¨çš„å‡ºç°ä¸ºæ—¥å¿—è®°å½•ã€ç¼“å­˜å’Œä¾èµ–æ³¨å…¥ç­‰åŠŸèƒ½æä¾›äº†æ›´åŠ ä¼˜é›…çš„å®ç°æ–¹å¼ã€‚

```js
function logged(target, key, descriptor) {
  const original = descriptor.value;
  descriptor.value = function (...args) {
    console.log(`Calling ${key} with`, args);
    return original.apply(this, args);
  };
  return descriptor;
}

class Example {
  @logged
  sum(a, b) {
    return a + b;
  }
}
const e = new Example();
e.sum(1, 2); // Output: [1, 2]
```

**ä»¥ä¸‹å†…å®¹ä¸ºç¿»è¯‘äººå‘˜è¡¥å……å†…å®¹ï¼š**

è£…é¥°å™¨æ˜¯ä¸€ç§å£°æ˜æ€§è¯­æ³•ï¼Œèƒ½å¤Ÿä¸ºç±»çš„å­—æ®µã€æ–¹æ³•ã€è®¿é—®å™¨ä»¥åŠæ•´ä¸ªç±»æ·»åŠ å…ƒæ•°æ®æˆ–ä¿®æ”¹è¡Œä¸ºã€‚å®ƒé€šè¿‡ä¸ºç›®æ ‡æ·»åŠ ä¿®é¥°å™¨å‡½æ•°ï¼Œæå‡ä»£ç çš„å¯å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚è£…é¥°å™¨çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š

```js
@decorator
class MyClass {
  @decorator
  myField;

  @decorator
  myMethod() {}
}
```

è£…é¥°å™¨æ¥æ”¶ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š

1. valueï¼šå¯¹äºå­—æ®µï¼Œæ˜¯åˆå§‹å€¼ï¼›å¯¹äºæ–¹æ³•ï¼Œæ˜¯åŸæ–¹æ³•ï¼›å¯¹äºè®¿é—®å™¨ï¼Œæ˜¯ getter/setterï¼›å¯¹äºç±»ï¼Œæ˜¯ç±»æœ¬èº«ã€‚
2. contextï¼šæä¾›å…³äºä¿®é¥°ç›®æ ‡çš„ä¿¡æ¯ã€‚å¸¸ç”¨å±æ€§ï¼š

- kindï¼šä¿®é¥°çš„ç›®æ ‡ç±»å‹ï¼Œå¦‚ classã€fieldã€methodã€getter æˆ– setterã€‚
- nameï¼šä¿®é¥°ç›®æ ‡çš„åç§°ã€‚
- staticï¼šæ˜¯å¦ä¸ºé™æ€æˆå‘˜ã€‚
- privateï¼šæ˜¯å¦ä¸ºç§æœ‰æˆå‘˜ã€‚
- addInitializer(fn)ï¼šå…è®¸ä¸ºç›®æ ‡æ·»åŠ åˆå§‹åŒ–å™¨ã€‚

```js
function logContext(value, context) {
  console.log(context);
  return value;
}

class MyClass {
  @logContext
  static staticField = 42;

  @logContext
  #privateField = "Hello";

  @logContext
  myMethod() {}
}
// è¾“å‡º: { kind: 'field', name: 'staticField', static: true, private: false }
// è¾“å‡º: { kind: 'field', name: '#privateField', static: false, private: true }
// è¾“å‡º: { kind: 'method', name: 'myMethod', static: false, private: false }
```

1. æƒé™æ§åˆ¶ä¸­ç”¨äºé™åˆ¶æŸäº›æ–¹æ³•çš„è®¿é—®ã€‚

```js
function adminOnly(value, context) {
  return function (...args) {
    if (!this.isAdmin) throw new Error("Unauthorized");
    return value.apply(this, args);
  };
}

class User {
  isAdmin = false;

  @adminOnly
  deleteUser() {
    console.log("User deleted");
  }
}
```

2. æ—¥å¿—è®°å½•æ—¶åœ¨æ–¹æ³•è°ƒç”¨æ—¶è‡ªåŠ¨è®°å½•æ—¥å¿—ã€‚

```js
function logMethod(value, context) {
  return function (...args) {
    console.log(`Calling ${context.name} with`, args);
    return value.apply(this, args);
  };
}

class MyClass {
  @logMethod
  myMethod(x, y) {
    return x + y;
  }
}
```

3. éªŒè¯å­—æ®µçš„å€¼æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚

```js
function validateRange(min, max) {
  return function (value, context) {
    return function (initialValue) {
      if (initialValue < min || initialValue > max) {
        throw new Error(`${context.name} must be between ${min} and ${max}`);
      }
      return initialValue;
    };
  };
}

class MyClass {
  @validateRange(1, 10)
  myField = 5;
}
```

ç›®å‰è¯¥ç‰¹æ€§ä¹Ÿè¿˜æ²¡æœ‰æ­£å¼è½åœ°ï¼Œå³ä¾¿æ˜¯æœ€æ–°çš„ chrome æµè§ˆå™¨éƒ½è¿˜ä¸æ”¯æŒè¯¥ç‰¹æ€§ã€‚

ä½ å¯ä»¥åœ¨ https://tc39.es/proposal-decorators/ æŸ¥çœ‹è¯¥ç‰¹æ€§çš„æœ€æ–°åŠ¨æ€ã€‚

ES15 è¿˜æœ‰æ›´å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å¢å¼º
- æ–°å¢çš„ç®¡é“è¿ç®—ç¬¦ (|>)
- String.prototype.isWellFormed( ) æ–¹æ³•
- ArrayBuffer.prototype.resize( ) æ–¹æ³•
- ......

ç­‰ç­‰ã€‚è¦æ·±å…¥äº†è§£æ‰€æœ‰æ–°å†…å®¹ï¼Œè¯·æŸ¥çœ‹ MDN ä¸Šçš„å®˜æ–¹æ–‡æ¡£ã€‚
