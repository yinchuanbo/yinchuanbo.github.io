<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"
      name="viewport"
    />
    <title>React Hooks - 布局效果的终极解决方案</title>
    <link rel="shortcut icon" href="../code.svg" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/prism2.css" />
    <link rel="stylesheet" href="../css/edit2.css" />
  </head>
  <body class="line-numbers">
    <main>
      <header>
        <h1>React Hooks - 布局效果的终极解决方案</h1>
        <p class="time">HaoTian · 2024-09-01 15:21:24</p>
      </header>
      <p>React 的内置组件：<code>React.useLayoutEffect</code></p>
<p>在 React 的世界里，useEffect Hook 已经非常流行，它允许我们在组件的生命周期中执行副作用操作。但是，当涉及到 DOM 布局的副作用时，useLayoutEffect 提供了一个更加精确的解决方案。</p>
<h3>什么是 useLayoutEffect？</h3>
<p>useLayoutEffect 与 useEffect 非常相似，但它会在所有的 DOM 变更之后同步执行。这意味着，你可以在执行 DOM 操作后立即获取 DOM 的尺寸、位置等信息，而不会阻塞浏览器的渲染。</p>
<h3>原理解析：</h3>
<p>在 React 的渲染过程中，useLayoutEffect 会在 DOM 更新之前执行，这保证了副作用的执行不会影响浏览器的重排和重绘，从而提高性能。</p>
<h3>代码演示：</h3>
<p>下面是一个简单的 useLayoutEffect 使用示例：</p>
<pre><code class="language-js">import React, { useRef, useLayoutEffect } from &quot;react&quot;;

function ComponentWithLayoutEffect() {
  const ref = useRef(null);

  useLayoutEffect(() =&gt; {
    // 直接访问DOM节点的尺寸和位置
    const width = ref.current.offsetWidth;
    console.log(`Width: ${width}px`);
  }, []); // 空依赖数组意味着这个effect只在组件挂载时执行一次

  return &lt;div ref={ref}&gt;Check console for the width&lt;/div&gt;;
}
</code></pre>
<h3>注意：</h3>
<p>由于 useLayoutEffect 是同步执行的，如果副作用操作非常耗时，可能会导致浏览器的渲染阻塞。因此，如果副作用操作可以异步执行，推荐使用 useEffect。</p>
<h3>应用场景：</h3>
<p>useLayoutEffect 非常适合用于需要立即响应 DOM 布局变化的场景，比如动态调整元素尺寸、计算布局等。</p>
<h3>总结：</h3>
<p>useLayoutEffect 是 React 中一个非常有用的 Hook，它帮助我们解决了布局相关的副作用问题，提高了应用的性能和用户体验。</p>
<p>如果你正在开发复杂的 React 应用，并且需要处理 DOM 布局的副作用，那么 useLayoutEffect 绝对是你不可错过的工具！</p>
<h3>官方说明：</h3>
<p><img src="../imgs/24/01.png" alt=""></p>

    </main>
    <aside id="nav">
      <ul>
        <li class=""><a title="前端屏幕适配" href="/md/前端屏幕适配.html">02 前端屏幕适配</a></li><li class="active"><a title="React Hooks - 布局效果的终极解决方案" href="/md/React Hooks - 布局效果的终极解决方案.html">01 React Hooks - 布局效果的终极解决方案</a></li>
      </ul>
      <div class="switch">
        <svg
          t="1730889498743"
          class="icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="7580"
          width="25"
          height="25"
        >
          <path
            d="M755.114667 332.074667L694.144 392.96l181.034667 181.034667 60.928-60.970667z"
            fill="#ffffff"
            p-id="7581"
          ></path>
          <path
            d="M755.2 694.229333l-60.928-60.928 181.034667-181.034666 60.928 60.970666z"
            fill="#ffffff"
            p-id="7582"
          ></path>
          <path
            d="M554.666667 469.333333h298.666666v85.333334h-298.666666zM268.885333 332.202667l60.970667 60.928-181.034667 181.034666-60.928-60.970666z"
            fill="#ffffff"
            p-id="7583"
          ></path>
          <path
            d="M268.757333 694.357333l60.928-60.970666-180.992-180.992-60.970666 60.928z"
            fill="#ffffff"
            p-id="7584"
          ></path>
          <path
            d="M469.333333 469.461333H170.666667v85.333334h298.666666z"
            fill="#ffffff"
            p-id="7585"
          ></path>
        </svg>
      </div>
    </aside>
    <div class="other">
      <button onclick="location.href='/md'">
        <svg
          t="1730945692261"
          class="icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="4576"
          width="25"
          height="25"
        >
          <path
            d="M147.904 304.128l301.866667-179.541333a128 128 0 0 1 131.712 0.512l295.466666 178.88A128 128 0 0 1 938.666667 413.482667V810.666667a128 128 0 0 1-128 128H213.333333a128 128 0 0 1-128-128V414.144a128 128 0 0 1 62.570667-110.016z m43.626667 73.344A42.666667 42.666667 0 0 0 170.666667 414.144V810.666667a42.666667 42.666667 0 0 0 42.666666 42.666666h597.333334a42.666667 42.666667 0 0 0 42.666666-42.666666V413.482667a42.666667 42.666667 0 0 0-20.565333-36.501334l-295.466667-178.88a42.666667 42.666667 0 0 0-43.925333-0.170666l-301.866667 179.541333z"
            fill="#ffffff"
            p-id="4577"
          ></path>
          <path
            d="M405.333333 469.333333h213.333334a42.666667 42.666667 0 1 1 0 85.333334H405.333333a42.666667 42.666667 0 1 1 0-85.333334z m0 85.333334a42.666667 42.666667 0 1 0 0-85.333334h213.333334a42.666667 42.666667 0 1 0 0 85.333334H405.333333z"
            fill="#ffffff"
            p-id="4578"
          ></path>
        </svg>
      </button>
    </div>
    <script defer src="../js/prism.min.js"></script>
    <script defer src="../js/edit2.js"></script>
  </body>
</html>
