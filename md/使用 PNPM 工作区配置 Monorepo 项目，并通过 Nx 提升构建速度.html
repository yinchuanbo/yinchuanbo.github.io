<!DOCTYPE html>
<html lang="en" class="">
  <head>
    <meta charset="UTF-8" />
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"
      name="viewport"
    />
    <title>ä½¿ç”¨ PNPM å·¥ä½œåŒºé…ç½® Monorepo é¡¹ç›®ï¼Œå¹¶é€šè¿‡ Nx æå‡æ„å»ºé€Ÿåº¦</title>
    <link rel="shortcut icon" href="../code.svg" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=fallback"
      rel="stylesheet"
    />
    <link id="prismTheme" rel="stylesheet" href="../css/prism.css" />
    <link rel="stylesheet" href="../css/edit.css" />
    
    <style>
      /* Animation Styles */
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .slide-in {
        animation: slideIn 0.5s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .button {
        transition: background-color 0.3s, transform 0.3s;
      }

      .button:hover {
        background-color: #3700b3;
        transform: scale(1.05);
      }

      /* Tooltip Styles */
      .tooltip {
        position: relative;
        display: inline-block;
      }

      .tooltip .tooltiptext {
        visibility: hidden;
        width: 120px;
        background-color: black;
        color: #fff;
        text-align: center;
        border-radius: 5px;
        padding: 5px 0;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -60px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }
    </style>
  </head>

  <body class="fade-in">
    <button
      class="toggle-sidebar"
      id="toggleSidebar"
      aria-label="Toggle Sidebar"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>

    <div class="app-container">
      <!-- Sidebar Navigation -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <button class="toggle-sidebar" id="toggleSidebar">
            <span></span>
          </button>
        </div>
        <div class="sidebar-content">
          <div class="nav-section"><li class=""><a title="ç”¨ vue 3 + pnpm æ‰“é€ é«˜æ•ˆçš„ Monorepo é¡¹ç›®æ¶æ„" href="/md/ç”¨ vue 3 + pnpm æ‰“é€ é«˜æ•ˆçš„ Monorepo é¡¹ç›®æ¶æ„.html">06 ç”¨ vue 3 + pnpm æ‰“é€ é«˜æ•ˆçš„ Monorepo é¡¹ç›®æ¶æ„</a></li><li class=""><a title="lerna" href="/md/lerna.html">05 lerna</a></li><li class="active"><a title="ä½¿ç”¨ PNPM å·¥ä½œåŒºé…ç½® Monorepo é¡¹ç›®ï¼Œå¹¶é€šè¿‡ Nx æå‡æ„å»ºé€Ÿåº¦" href="/md/ä½¿ç”¨ PNPM å·¥ä½œåŒºé…ç½® Monorepo é¡¹ç›®ï¼Œå¹¶é€šè¿‡ Nx æå‡æ„å»ºé€Ÿåº¦.html">04 ä½¿ç”¨ PNPM å·¥ä½œåŒºé…ç½® Monorepo é¡¹ç›®ï¼Œå¹¶é€šè¿‡ Nx æå‡æ„å»ºé€Ÿåº¦</a></li><li class=""><a title="ä½¿ç”¨ PNPM workspace åˆ›å»º monorepo" href="/md/ä½¿ç”¨ PNPM workspace åˆ›å»º monorepo.html">03 ä½¿ç”¨ PNPM workspace åˆ›å»º monorepo</a></li><li class=""><a title="åº”è¯¥äº†è§£çš„ 11 ä¸ª Monorepo æ„å»ºå·¥å…·" href="/md/åº”è¯¥äº†è§£çš„ 11 ä¸ª Monorepo æ„å»ºå·¥å…·.html">02 åº”è¯¥äº†è§£çš„ 11 ä¸ª Monorepo æ„å»ºå·¥å…·</a></li><li class=""><a title="è¯¦è§£ Monorepo è¿›åŒ–ã€ä¼˜åŠ£ä¸ä½¿ç”¨åœºæ™¯" href="/md/è¯¦è§£ Monorepo è¿›åŒ–ã€ä¼˜åŠ£ä¸ä½¿ç”¨åœºæ™¯.html">01 è¯¦è§£ Monorepo è¿›åŒ–ã€ä¼˜åŠ£ä¸ä½¿ç”¨åœºæ™¯</a></li></div>
        </div>
      </nav>

      <!-- Main Content Area -->
      <main class="main-content">
        <header class="content-header">
          <div class="header-left">
            <h1 class="page-title">ä½¿ç”¨ PNPM å·¥ä½œåŒºé…ç½® Monorepo é¡¹ç›®ï¼Œå¹¶é€šè¿‡ Nx æå‡æ„å»ºé€Ÿåº¦</h1>
            <p class="time">HaoTian Â· 2024-11-10 19:13:06</p>
          </div>
          <div class="header-right">
            <div class="tag-container">
              <span class="tag">å•ä»“åº“</span>
            </div>
            <button
              id="themeToggle"
              class="theme-toggle"
              aria-label="Toggle theme"
            >
              <svg
                class="sun-icon"
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              <svg
                class="moon-icon"
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                ></path>
              </svg>
            </button>
            <button class="theme-toggle" aria-label="Toggle theme" style="width: 36px;height: 36px;" onclick="window.location.href='/md';">
              <svg t="1737442501710" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5258" width="20" height="20"><path d="M883.773793 626.047476c-17.308201 0-31.408337 14.029528-31.408337 31.304983l0 207.437469c0 17.204847-14.098089 31.302937-31.406291 31.302937L203.040834 896.092865c-17.340947 0-31.408337-14.098089-31.408337-31.302937L171.632497 657.352459c0-17.275455-14.099113-31.304983-31.408337-31.304983-17.380856 0-31.444153 14.029528-31.444153 31.304983l0 207.437469c0 51.773154 42.261523 93.91188 94.260827 93.91188l617.918331 0c52.031027 0 94.259804-42.139749 94.259804-93.91188L915.21897 657.352459C915.21897 640.077004 901.152603 626.047476 883.773793 626.047476L883.773793 626.047476zM230.262826 614.286618c55.523571 0 104.556311-27.674293 134.394896-69.762877 32.487925 46.451962 86.303598 77.0744 147.343813 77.0744 61.036122 0 114.846678-30.623461 147.306974-77.0744 29.943986 42.018999 78.902024 69.762877 134.426619 69.762877 90.948385 0 164.968216-73.77526 164.968216-164.371628 0-11.062963-2.342348-22.859637-5.130857-35.178197-0.209778-1.134847 0.031722-2.26867-0.277316-3.38612l-0.629333-2.267647c-0.24764-0.924045-0.140193-1.535983-0.352017-2.547009-0.138146-0.505513-0.521886-0.87288-0.695848-1.39579l-85.364203-316.671313c-3.699252-13.645788-16.051581-23.172769-30.293957-23.172769L187.965487 65.296145c-14.238282 0-26.665313 9.526981-30.360472 23.24133L72.309374 405.1566c-0.103354 0.50756-0.48607 0.820692-0.62524 1.309832-0.210801 0.942465-0.107447 1.639337-0.349971 2.511193l-0.62524 2.373047c-0.318248 1.11745 0 2.25025-0.210801 3.38612-2.863211 12.31856-5.201465 24.115234-5.201465 35.178197C65.295634 540.511357 139.315464 614.286618 230.262826 614.286618L230.262826 614.286618z" fill="currentColor" p-id="5259"></path></svg>
            </button>
          </div>
        </header>

        <!-- Article Content -->
        <article
          class="content-body md md "
        >
          <img src="../imgs/102/01.webp" />

<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥äº†è§£å¦‚ä½•ä½¿ç”¨ <a href="https://pnpm.io/workspaces">PNPM å·¥ä½œåŒº</a> é…ç½®ä¸€ä¸ªæ–°çš„ monorepoï¼Œå®ƒåŒ…å«ä¸€ä¸ª Remix åº”ç”¨å’Œä¸€ä¸ªåŸºäº React çš„åº“ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ PNPM è¿è¡Œå‘½ä»¤ï¼Œå¦‚ä½•å¹¶è¡Œè¿è¡Œå®ƒä»¬ï¼Œæœ€åæ·»åŠ  Nx æ¥å®ç°æ›´å¤æ‚çš„ä»»åŠ¡è°ƒåº¦ï¼ŒåŒ…æ‹¬å‘½ä»¤ç¼“å­˜ç­‰åŠŸèƒ½ã€‚</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/ngdoUQBvAjo" title="Setup a monorepo with PNPM workspaces and add Nx for speed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<h2>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ PNPM å·¥ä½œåŒº</h2>
<p>é¦–å…ˆï¼Œç¡®ä¿ä½ å·²å®‰è£… PNPMã€‚å¯ä»¥å‚è€ƒ<a href="https://pnpm.io/installation">å®˜æ–¹æ–‡æ¡£ä¸­çš„å®‰è£…é¡µé¢</a>è·å–è¯¦ç»†çš„å®‰è£…æ­¥éª¤ã€‚å¯¹äºéœ€è¦ç®¡ç†å¤šä¸ª NPM/PNPM ç‰ˆæœ¬å’Œ Node ç‰ˆæœ¬çš„ç”¨æˆ·ï¼Œå»ºè®®ä½¿ç”¨ <a href="https://volta.sh/">Volta</a> ç­‰å·¥å…·ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªåä¸º <code>pnpm-mono</code> çš„æ–°æ–‡ä»¶å¤¹ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œå¹¶è¿è¡Œ <code>pnpm init</code> ç”Ÿæˆé¡¶çº§ <code>package.json</code> æ–‡ä»¶ï¼Œè¿™å°†ä½œä¸ºæˆ‘ä»¬ PNPM monorepo çš„æ ¹ <code>package.json</code> æ–‡ä»¶ã€‚</p>
<pre><code class="language-sh">mkdir pnpm-mono
cd pnpm-mono
pnpm init
</code></pre>
<p>åŒæ—¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Git ä»“åº“ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œè¿™æ ·å¯ä»¥åœ¨è®¾ç½®è¿‡ç¨‹ä¸­éšæ—¶æäº¤å’Œå¤‡ä»½ã€‚</p>
<pre><code class="language-sh"># .gitignore
node_modules
dist
build
</code></pre>
<h2>è®¾ç½® Monorepo ç»“æ„</h2>
<p>Monorepo çš„ç»“æ„å¯ä»¥æ ¹æ®ç”¨é€”è€Œæœ‰æ‰€ä¸åŒï¼Œé€šå¸¸æœ‰ä¸¤ç§ç±»å‹ï¼š</p>
<ul>
<li><strong>åŸºäºåŒ…çš„ä»“åº“</strong>ï¼šç”¨äºå¼€å‘å’Œå‘å¸ƒä¸€ç»„å¯å¤ç”¨çš„åŒ…ï¼Œé€šå¸¸ç”¨äºå¼€æºé¡¹ç›®ï¼Œå¸¸è§çš„ä¾‹å­åŒ…æ‹¬ <a href="https://github.com/angular/angular">Angular</a>ã€<a href="https://github.com/facebook/react">React</a> å’Œ <a href="https://github.com/vuejs/vue">Vue</a>ï¼Œé€šå¸¸åŒ…å«ä¸€ä¸ª <code>packages</code> æ–‡ä»¶å¤¹ï¼Œå¹¶å‘å¸ƒåˆ°å…¬å…±æ³¨å†Œè¡¨å¦‚ <a href="https://npmjs.com/">NPM</a>ã€‚</li>
<li><strong>åŸºäºåº”ç”¨çš„ä»“åº“</strong>ï¼šä¸»è¦ç”¨äºå¼€å‘åº”ç”¨ç¨‹åºå’Œäº§å“ï¼Œå¸¸ç”¨äºå…¬å¸é¡¹ç›®ã€‚é€šå¸¸åŒ…å« <code>apps</code> æ–‡ä»¶å¤¹ï¼ˆç”¨äºå­˜æ”¾å¯æ„å»ºå’Œéƒ¨ç½²çš„åº”ç”¨ï¼‰å’Œ <code>packages</code> æˆ– <code>libs</code> æ–‡ä»¶å¤¹ï¼ˆå­˜æ”¾ä¸ºåº”ç”¨æœåŠ¡çš„åº“ï¼‰ï¼Œéƒ¨åˆ†åº“ä¹Ÿå¯ä»¥å‘å¸ƒåˆ°å…¬å…±æ³¨å†Œè¡¨ã€‚</li>
</ul>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨â€œåŸºäºåº”ç”¨â€çš„æ–¹æ³•æ¥å±•ç¤ºå¦‚ä½•åœ¨ monorepo å†…æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨å†…éƒ¨åŒ…ã€‚</p>
<p>åœ¨ <code>pnpm-mono</code> ä¸­åˆ›å»º <code>apps</code> å’Œ <code>packages</code> æ–‡ä»¶å¤¹ã€‚</p>
<pre><code class="language-sh">mkdir apps packages
</code></pre>
<p>ç°åœ¨è®©æˆ‘ä»¬é…ç½® PNPM ä»¥æ­£ç¡®è¯†åˆ« monorepo å·¥ä½œåŒºã€‚åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»“åº“æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>pnpm-workspace.yaml</code> æ–‡ä»¶ï¼Œå®šä¹‰ monorepo çš„ç»“æ„ã€‚</p>
<pre><code class="language-sh"># pnpm-workspace.yaml
packages:
  # executable/launchable applications
  - &#39;apps/*&#39;
  # all packages in subdirs of packages/ and components/
  - &#39;packages/*&#39;
</code></pre>
<h2>æ·»åŠ  Remix åº”ç”¨ç¨‹åº</h2>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ·»åŠ ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºäº†ã€‚æœ¬æ–‡ç¤ºä¾‹ä¸­é€‰æ‹©äº† <a href="https://remix.run/">Remix</a>ï¼Œä½†å…¶å®å¯ä»¥å®¹çº³ä»»ä½•ç±»å‹çš„åº”ç”¨ç¨‹åºã€‚</p>
<blockquote>
<p><em>ä¿¡æ¯ï¼šæˆ‘ä»¬åœ¨æ­¤ä½¿ç”¨å¸¸è§„çš„</em> <a href="https://remix.run/docs/en/v1"><em>Remix å®‰è£…å’Œè®¾ç½®æµç¨‹</em></a>ï¼Œ<em>å¯ä»¥åœ¨å…¶æ–‡æ¡£é¡µé¢ä¸­æ‰¾åˆ°ã€‚</em></p>
</blockquote>
<p>ç”±äºæˆ‘ä»¬å¸Œæœ›å°†åº”ç”¨ç¨‹åºæ”¾åœ¨ <code>apps</code> æ–‡ä»¶å¤¹ä¸­ï¼Œå› æ­¤éœ€è¦å…ˆè¿›å…¥è¯¥ç›®å½•ï¼š</p>
<pre><code class="language-sh">cd apps
npx create-remix@latest
</code></pre>
<p>åœ¨è®¾ç½® Remix åº”ç”¨æ—¶ï¼Œç³»ç»Ÿä¼šè¦æ±‚ä½ è¾“å…¥åº”ç”¨åç§°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ â€œmy-remix-appâ€ ä½œä¸ºç¤ºä¾‹åç§°ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–åç§°ã€‚æ­¤å¤–ï¼ŒRemix çš„è®¾ç½®è¿‡ç¨‹è¿˜ä¼šè¯¢é—®ä½ ä¸€äº›é—®é¢˜æ¥å®šåˆ¶å…·ä½“çš„é…ç½®ï¼Œè¿™äº›é€‰é¡¹å¯¹äºæœ¬æ–‡å¹¶ä¸é‡è¦ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ã€‚</p>
<p>å®Œæˆåï¼Œä½ åº”è¯¥ä¼šåœ¨ <code>apps/my-remix-app</code> æ–‡ä»¶å¤¹ä¸­çœ‹åˆ° Remix åº”ç”¨ï¼Œå¹¶ä¸”å®ƒå·²ç»æœ‰äº†ä¸€ä¸ªé…ç½®å¥½çš„ <code>package.json</code> æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†ç›¸å…³çš„è„šæœ¬ã€‚</p>
<pre><code class="language-json">{
  &quot;private&quot;: true,
  &quot;sideEffects&quot;: false,
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;remix build&quot;,
    &quot;dev&quot;: &quot;remix dev&quot;,
    &quot;start&quot;: &quot;remix-serve build&quot;
  }
  // ...
}
</code></pre>
<p>åœ¨ monorepo ä¸­ï¼Œé€šå¸¸å¸Œæœ›ä»ä»“åº“æ ¹ç›®å½•è¿è¡Œå‘½ä»¤ï¼Œè¿™æ ·å°±ä¸éœ€è¦åœ¨æ–‡ä»¶å¤¹ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚PNPM å·¥ä½œåŒºæä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’ <code>filter</code> å‚æ•°æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<pre><code class="language-sh">pnpm --filter &lt;package-name&gt; &lt;command&gt;
</code></pre>
<p>ç›®å‰ï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼‰ï¼ŒRemix çš„é»˜è®¤ <code>package.json</code> æ–‡ä»¶æ²¡æœ‰å®šä¹‰ <code>name</code> å±æ€§ï¼Œè€Œ PNPM éœ€è¦è¯¥å±æ€§æ‰èƒ½è¿è¡ŒåŒ…ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <code>apps/my-remix-app/package.json</code> ä¸­å®šä¹‰ä¸€ä¸ª <code>name</code> å±æ€§ã€‚</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;my-remix-app&quot;,
  &quot;private&quot;: true,
  &quot;sideEffects&quot;: false
  // ...
}
</code></pre>
<p>ä½ ç°åœ¨åº”è¯¥å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä»¥å¼€å‘æ¨¡å¼è¿è¡Œ Remix åº”ç”¨ï¼š</p>
<pre><code class="language-sh">pnpm --filter my-remix-app dev
</code></pre>
<img src="../imgs/102/01.avif" />

<h2>åˆ›å»ºä¸€ä¸ªå…±äº« UI åº“</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®äº†åº”ç”¨ç¨‹åºï¼Œæ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥è¢«åº”ç”¨ç¨‹åºæ¶ˆè´¹çš„åº“åŒ…ã€‚è¿™å°†æ˜¯ä¸€ä¸ªå…±äº«çš„ UI åº“ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºä¸­å¤ç”¨ç»„ä»¶ã€‚</p>
<pre><code class="language-sh">cd packages
mkdir shared-ui
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>package.json</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼ˆä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>pnpm init</code> å‘½ä»¤å¹¶è¿›è¡Œè°ƒæ•´ï¼‰ï¼š</p>
<pre><code class="language-js">{
  &quot;private&quot;: true,
  &quot;name&quot;: &quot;shared-ui&quot;,
  &quot;description&quot;: &quot;Shared UI components&quot;,
  &quot;scripts&quot;: {},
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;dependencies&quot;: {},
  &quot;devDependencies&quot;: {}
}
</code></pre>
<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†å…¶å£°æ˜ä¸º <code>private</code>ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›å°†å…¶å‘å¸ƒåˆ° NPM æˆ–å…¶ä»–åœ°æ–¹ï¼Œè€Œæ˜¯ä»…åœ¨æˆ‘ä»¬çš„å·¥ä½œç©ºé—´ä¸­å¼•ç”¨å¹¶ä½¿ç”¨å®ƒã€‚æˆ‘è¿˜åˆ é™¤äº† <code>version</code> å±æ€§ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¢«ä½¿ç”¨ã€‚</p>
<p>ç”±äºæˆ‘é€‰æ‹©äº† <a href="https://reactjs.org/">React</a> ä½œä¸ºæŠ€æœ¯æ ˆï¼ˆè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ Remix ä¸­å¯¼å…¥å®ƒï¼‰å’Œ <a href="https://www.typescriptlang.org/">TypeScript</a>ï¼ˆå› ä¸ºå®ƒç°åœ¨å‡ ä¹å¯ä»¥ç®—ä½œæ ‡å‡†ï¼‰ï¼Œè®©æˆ‘ä»¬ä»å·¥ä½œç©ºé—´çš„æ ¹ç›®å½•å®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼š</p>
<pre><code class="language-sh">pnpm add --filter shared-ui react
pnpm add --filter shared-ui typescript -D
</code></pre>
<p>é€šè¿‡å°† <code>--filter shared-ui</code> ä¼ é€’ç»™å®‰è£…å‘½ä»¤ï¼Œæˆ‘ä»¬å°†è¿™äº› NPM åŒ…æœ¬åœ°å®‰è£…åˆ° <code>shared-ui</code> åº“ä¸­ã€‚</p>
<blockquote>
<p>æç¤ºï¼šè¯·æ³¨æ„ï¼Œå¦‚æœåº“åŒ…å’Œä½¿ç”¨è€…ï¼ˆä¾‹å¦‚æˆ‘ä»¬çš„åº”ç”¨ï¼‰æ‰€ä½¿ç”¨çš„ React/TypeScript ç‰ˆæœ¬ä¸åŒï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬å†²çªã€‚ä¸€ç§è§£å†³æ–¹æ³•æ˜¯é‡‡ç”¨* <a href="https://opensource.google/documentation/reference/thirdparty/oneversion">å•ä¸€ç‰ˆæœ¬ç­–ç•¥</a>*ï¼Œå°†è¿™äº›åŒ…ç§»åŠ¨åˆ° monorepo çš„æ ¹ç›®å½•ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç»„ä»¶å°†æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ <code>Button</code> ç»„ä»¶ã€‚é‚£ä¹ˆè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå§ï¼š</p>
<pre><code class="language-tsx">// packages/shared-ui/Button.tsx
export function Button(props: any) {
  return &lt;button onClick={() =&gt; props.onClick()}&gt;{props.children}&lt;/button&gt;;
}
export default Button;
</code></pre>
<p>æˆ‘ä»¬è¿˜å¸Œæœ›æ‹¥æœ‰ä¸€ä¸ªå…¬å…± APIï¼Œåœ¨å…¶ä¸­å¯¼å‡ºç»„ä»¶ï¼Œä»¥ä¾¿åœ¨æˆ‘ä»¬çš„ <code>shared-ui</code> åŒ…å¤–éƒ¨ä½¿ç”¨ï¼š</p>
<pre><code class="language-tsx">// packages/shared-ui/index.tsx
export * from &quot;./Button&quot;;
</code></pre>
<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨ TypeScript ç¼–è¯‘å™¨æ¥ç¼–è¯‘æˆ‘ä»¬çš„åŒ…ã€‚æˆ‘ä»¬æœ¬å¯ä»¥ä½¿ç”¨åƒ <a href="https://rollupjs.org/guide/en/">Rollup</a> æˆ–å…¶ä»–ä½ å–œæ¬¢çš„å·¥å…·ï¼Œè¿›è¡Œæ›´å¤æ‚çš„è®¾ç½®ï¼Œå°†å¤šä¸ªæ–‡ä»¶æ†ç»‘åœ¨ä¸€èµ·ç­‰ï¼Œä½†è¿™äº›è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚</p>
<p>ä¸ºäº†åˆ›å»ºæ‰€éœ€çš„ç¼–è¯‘è¾“å‡ºï¼Œåˆ›å»ºä¸€ä¸ª <code>packages/shared-ui/tsconfig.json</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-ts">{
  &quot;compilerOptions&quot;: {
    &quot;jsx&quot;: &quot;react-jsx&quot;,
    &quot;allowJs&quot;: true,
    &quot;esModuleInterop&quot;: true,
    &quot;allowSyntheticDefaultImports&quot;: true,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;outDir&quot;: &quot;./dist&quot;
  },
  &quot;include&quot;: [&quot;.&quot;],
  &quot;exclude&quot;: [&quot;dist&quot;, &quot;node_modules&quot;, &quot;**/*.spec.ts&quot;]
}
</code></pre>
<blockquote>
<p>åœ¨ monorepo ä¸­ï¼Œæœ€å¥½å°†å…¬å…±é…ç½®éƒ¨åˆ†æå–åˆ°æ›´é«˜å±‚æ¬¡çš„é…ç½®æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚åœ¨æ ¹ç›®å½•ï¼‰ï¼Œç„¶ååœ¨å„ä¸ªé¡¹ç›®ä¸­è¿›è¡Œæ‰©å±•ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å¤šä¸ª monorepo åŒ…ä¸­å‡ºç°å¤§é‡é‡å¤ã€‚ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œæˆ‘åœ¨è¿™é‡Œå°†æ‰€æœ‰å†…å®¹ä¿ç•™åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚</p>
</blockquote>
<p>å¦‚ä½ æ‰€è§ï¼Œ<code>outDir</code> æŒ‡å‘äº†ä¸€ä¸ªåŒ…å†…çš„ <code>dist</code> æ–‡ä»¶å¤¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ <code>shared-ui</code> åŒ…çš„ <code>package.json</code> ä¸­æ·»åŠ ä¸€ä¸ªä¸»å…¥å£ç‚¹ï¼š</p>
<pre><code class="language-json">{
  &quot;private&quot;: true,
  &quot;name&quot;: &quot;shared-ui&quot;,
  &quot;main&quot;: &quot;dist/index.js&quot;
}
</code></pre>
<p>æœ€åï¼Œå®é™…çš„æ„å»ºè¿‡ç¨‹åŒ…æ‹¬åˆ é™¤ä¹‹å‰è¾“å‡ºçš„æ®‹ç•™æ–‡ä»¶å¤¹ï¼Œç„¶åè°ƒç”¨ TypeScript ç¼–è¯‘å™¨ï¼ˆ<code>tsc</code>ï¼‰ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„ <code>packages/shared-ui/package.json</code> æ–‡ä»¶ï¼š</p>
<pre><code class="language-json">{
  &quot;private&quot;: true,
  &quot;name&quot;: &quot;shared-ui&quot;,
  &quot;description&quot;: &quot;Shared UI components&quot;,
  &quot;main&quot;: &quot;dist/index.js&quot;,
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;rm -rf dist &amp;&amp; tsc&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;dependencies&quot;: {
    &quot;react&quot;: &quot;^17.0.2&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;typescript&quot;: &quot;^4.6.4&quot;
  }
}
</code></pre>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä» PNPM å·¥ä½œåŒºçš„æ ¹ç›®å½•è¿è¡Œæ„å»ºï¼š</p>
<pre><code class="language-sh">pnpm --filter shared-ui build
</code></pre>
<p>å¦‚æœæ„å»ºæˆåŠŸï¼Œä½ åº”è¯¥èƒ½åœ¨ <code>packages/shared-ui/dist</code> æ–‡ä»¶å¤¹ä¸­çœ‹åˆ°ç¼–è¯‘åçš„è¾“å‡ºã€‚</p>
<h2>ä» Remix åº”ç”¨ä¸­ä½¿ç”¨æˆ‘ä»¬çš„ shared-ui åŒ…</h2>
<p>æˆ‘ä»¬çš„ <code>shared-ui</code> åº“å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬ä»“åº“ä¸­ <code>apps</code> æ–‡ä»¶å¤¹å†…æ‰˜ç®¡çš„ Remix åº”ç”¨ä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†ä¾èµ–é¡¹æ·»åŠ åˆ° Remix çš„ <code>package.json</code> ä¸­ï¼Œæˆ–è€…ä½¿ç”¨ PNPM æ¥æ·»åŠ å®ƒï¼š</p>
<pre><code class="language-sh">pnpm add shared-ui --filter my-remix-app --workspace
</code></pre>
<p>è¿™å°†å…¶æ·»åŠ åˆ° <code>apps/my-remix-app/package.json</code> ä¸­çš„ä¾èµ–é¡¹ï¼š</p>
<pre><code class="language-js">{
  &quot;name&quot;: &quot;my-remix-app&quot;,
  &quot;private&quot;: true,
  &quot;sideEffects&quot;: false,
  // ...
  &quot;dependencies&quot;: {
    ...
    &quot;shared-ui&quot;: &quot;workspace:*&quot;
  },
  // ...
}
</code></pre>
<p><code>workspace:*</code> è¡¨ç¤ºè¯¥åŒ…åœ¨å·¥ä½œåŒºä¸­æ˜¯æœ¬åœ°è§£æçš„ï¼Œè€Œä¸æ˜¯ä»æŸä¸ªè¿œç¨‹æ³¨å†Œè¡¨ï¼ˆå¦‚ <a href="https://npmjs.com/">NPM</a>ï¼‰è·å–çš„ã€‚<code>*</code> ä»…è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä¾èµ–äºå®ƒçš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ç‰¹å®šç‰ˆæœ¬ã€‚åªæœ‰åœ¨ä½¿ç”¨å¤–éƒ¨ NPM åŒ…æ—¶ï¼ŒæŒ‡å®šç‰ˆæœ¬æ‰æœ‰æ„ä¹‰ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨æˆ‘ä»¬çš„ <code>Button</code> ç»„ä»¶ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä»æŸä¸ª Remix è·¯ç”±ä¸­å¯¼å…¥å®ƒã€‚å°† <code>apps/my-remix-app/app/routes/index.tsx</code> çš„å†…å®¹æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-tsx">// apps/my-remix-app/app/routes/index.tsx
import { Button } from &quot;shared-ui&quot;;
export default function Index() {
  return (
    &lt;div&gt;
      &lt;Button onClick={() =&gt; console.log(&quot;clicked&quot;)}&gt;Click me&lt;/Button&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<p>å¦‚æœä½ ç°åœ¨å†æ¬¡è¿è¡Œ Remix åº”ç”¨ï¼Œåº”è¯¥èƒ½çœ‹åˆ°æŒ‰é’®è¢«æ¸²æŸ“å‡ºæ¥ã€‚</p>
<pre><code class="language-sh">pnpm --filter my-remix-app dev
</code></pre>
<p>å¦‚æœä½ é‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼Œé‚£æ˜¯å› ä¸ºä½ éœ€è¦å…ˆæ„å»º shared-ui</p>
<pre><code class="language-sh">Error: Cannot find module &#39;/Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app/node_modules/shared-ui/dist/index.js&#39;. Please verify that the package.json has a valid &quot;main&quot; entry
    at tryPackage (node:internal/modules/cjs/loader:353:19)
    at Function.Module._findPath (node:internal/modules/cjs/loader:566:18)
    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:919:27)
    at Function.Module._load (node:internal/modules/cjs/loader:778:27)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at Object.&lt;anonymous&gt; (/Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app/app/routes/index.tsx:1:24)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
</code></pre>
<p>è¦æ„å»ºå®ƒï¼Œè¿è¡Œï¼š</p>
<pre><code class="language-sh">pnpm --filter shared-ui build
</code></pre>
<p>ä¸ºä»€ä¹ˆï¼Ÿè¿™æ˜¯å› ä¸º PNPM åˆ›å»ºäº†ç¬¦å·é“¾æ¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¼•ç”¨å’Œè§£ææœ¬åœ°ä¾èµ–é¡¹ã€‚é€šè¿‡å°† <code>shared-ui: &quot;workspace:*&quot;</code> æ·»åŠ åˆ° Remix çš„ <code>package.json</code> ä¸­ï¼Œä½ æŒ‡ç¤º PNPM å‘ Remix çš„ <code>node_modules</code> æ–‡ä»¶å¤¹æ·»åŠ ä¸€ä¸ªç¬¦å·é“¾æ¥ã€‚</p>
<img src="../imgs/102/02.avif" />

<p>PNPM åœ¨æœ¬åœ° <code>node_modules</code> æ–‡ä»¶å¤¹ä¸­åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¯¼å…¥æœ¬åœ°åŒ…</p>
<h2>ä½¿ç”¨ PNPM è¿è¡Œå‘½ä»¤</h2>
<p>PNPM æä¾›äº†æ–¹ä¾¿çš„åŠŸèƒ½æ¥è·¨ monorepo å·¥ä½œåŒºè¿è¡Œå‘½ä»¤ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ <code>--filter</code> å¯¹å•ä¸ªåŒ…è¿›è¡Œå‘½ä»¤ä½œç”¨åŸŸè®¾ç½®ï¼š</p>
<pre><code class="language-sh">pnpm --filter my-remix-app dev
</code></pre>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>-r</code> æ ‡å¿—é€’å½’åœ°åœ¨å·¥ä½œåŒºä¸­çš„æ‰€æœ‰åŒ…ä¸Šè¿è¡Œå‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ è¦å¯¹æ‰€æœ‰é¡¹ç›®è¿è¡Œæ„å»ºå‘½ä»¤ã€‚</p>
<pre><code class="language-sh">pnpm run -r buildScope: 2 of 3 workspace projects
packages/shared-ui build$ rm -rf dist &amp;&amp; tsc
â””â”€ Done in 603ms
apps/my-remix-app build$ remix build
â”‚ Building Remix app in production mode...
â”‚ The path &quot;shared-ui&quot; is imported in app/routes/index.tsx but shared-ui is not listed in your package.json
â”‚ Built in 156ms
â””â”€ Done in 547ms
</code></pre>
<p>ç±»ä¼¼åœ°ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>--parallel</code> æ¥å¹¶è¡Œè¿è¡Œå‘½ä»¤ã€‚</p>
<pre><code class="language-sh">pnpm run --parallel -r buildScope: 2 of 3 workspace projects
apps/my-remix-app build$ remix build
packages/shared-ui build$ rm -rf dist &amp;&amp; tsc
apps/my-remix-app build: Building Remix app in production mode...
apps/my-remix-app build: The path &quot;shared-ui&quot; is imported in app/routes/index.tsx but shared-ui is not listed in your package.json dependencies. Did you forget to install it?
apps/my-remix-app build: Built in 176ms
apps/my-remix-app build: Done
packages/shared-ui build: Done
</code></pre>
<h2>ä½¿ç”¨ Nx åŠ é€Ÿ</h2>
<p>PNPM å·¥ä½œåŒºæä¾›äº†ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ monorepo åŒ…ä¸Šè¿è¡Œä»»åŠ¡ï¼Œç”šè‡³æ˜¯å¹¶è¡Œè¿è¡Œã€‚éšç€ monorepo çš„æ‰©å±•ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›æ‹¥æœ‰æ›´é«˜çº§çš„æ–¹æ³•ï¼Œä»¥ä¾¿ï¼š</p>
<ul>
<li>ä»…åœ¨å‘ç”Ÿå˜åŒ–çš„åŒ…ä¸Šè¿è¡Œä»»åŠ¡</li>
<li>åŸºäºæ–‡ä»¶å†…å®¹çš„é«˜çº§ç¼“å­˜ï¼Œä»¥é¿å…é‡æ–°è¿è¡Œå·²ç»è®¡ç®—è¿‡çš„ä»»åŠ¡</li>
<li>è¿œç¨‹åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä»¥åŠ é€Ÿ CI</li>
</ul>
<p>è¿™æ­£æ˜¯ Nx å¯ä»¥å¸®åŠ©çš„åœ°æ–¹ã€‚å®ƒé’ˆå¯¹ monorepo åœºæ™¯è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ‹¥æœ‰å…ˆè¿›çš„ä»»åŠ¡è°ƒåº¦æœºåˆ¶ã€‚æˆ‘ä»¬ä»ç„¶ä¾èµ–äº PNPM å·¥ä½œåŒºæä¾›çš„åŒ…å®‰è£…å’ŒåŒ…é“¾æ¥æœºåˆ¶ï¼Œä½†ä½¿ç”¨ Nx æ¥ä»¥æœ€æœ‰æ•ˆçš„æ–¹å¼è¿è¡Œæˆ‘ä»¬çš„ä»»åŠ¡ã€‚</p>
<h2>å®‰è£… Nx</h2>
<p>ç”±äº Nx å°†ç”¨äºåœ¨æ•´ä¸ª monorepo å·¥ä½œåŒºä¸­è¿è¡Œæ“ä½œï¼Œæˆ‘ä»¬å°†åœ¨æ ¹ç›®å½•çš„ <code>package.json</code> ä¸­å®‰è£…å®ƒã€‚</p>
<pre><code class="language-sh">pnpm add nx -D -w
</code></pre>
<h2>ä½¿ç”¨ Nx è¿è¡Œä»»åŠ¡</h2>
<p>Nx ä½¿ç”¨ä»¥ä¸‹å½¢å¼æ¥è¿è¡Œä½ çš„å‘½ä»¤ï¼š</p>
<pre><code class="language-sh">npx nx &lt;target&gt; &lt;project&gt;
</code></pre>
<p><code>target</code> æ˜¯ä½ æƒ³è¦æ‰§è¡Œçš„ç‰¹å®š NPM è„šæœ¬ã€‚</p>
<p>è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸ºæˆ‘ä»¬çš„ <code>shared-ui</code> åŒ…è¿è¡Œæ„å»ºï¼š</p>
<pre><code class="language-sh">npx nx build shared-ui
</code></pre>
<p>è¿™å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š</p>
<pre><code class="language-sh">nx run shared-ui:build
shared-ui@ build /Users/juri/nrwl/content/pnpm-demos/pnpm-mono/packages/shared-ui
rm -rf dist &amp;&amp; tsc
NX Successfully ran target build for project shared-ui (1s)
</code></pre>
<p>Nx ä¼šè‡ªåŠ¨æ‰¾åˆ° <code>shared-ui</code> å¹¶è¿è¡Œåœ¨ <code>packages/shared-ui/package.json</code> ä¸­å®šä¹‰çš„ <code>build</code> è„šæœ¬ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œè¦å¯åŠ¨æˆ‘ä»¬çš„ Remix åº”ç”¨ï¼Œè¿è¡Œ <code>npx nx dev my-remix-app</code>ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åœ¨é¡¹ç›®ä¹‹é—´å¹¶è¡Œè¿è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="language-sh">npx nx run-many --target=build --all
âœ”  nx run my-remix-app:build (1s)
âœ”  nx run shared-ui:build (1s)
NX   Successfully ran target build for 2 projects (1s)
</code></pre>
<p>æˆ–è€…é€šè¿‡ä»¥ä¸‹æ–¹å¼é€‰æ‹©æ€§åœ°æŒ‡å®šé¡¹ç›®ï¼š</p>
<pre><code class="language-sh">npx nx run-many --target=build --projects=my-remix-app,shared-ui
âœ”  nx run my-remix-app:build (1s)
âœ”  nx run shared-ui:build (1s)
NX   Successfully ran target build for 2 projects (1s)
</code></pre>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œæˆ‘åœ¨å‘½ä»¤å‰é¢åŠ ä¸Šäº† npxï¼Œè¿™æ ·å¯ä»¥è¿è¡Œ node_modules æ–‡ä»¶å¤¹ä¸­çš„ Nx å¯æ‰§è¡Œæ–‡ä»¶ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä¸éœ€è¦å…¨å±€å®‰è£… nxã€‚å¦‚æœä½ æ›´å–œæ¬¢å…¨å±€å®‰è£…ï¼Œéšæ—¶å¯ä»¥è¿™ä¹ˆåšã€‚</p>
</blockquote>
<h2>é…ç½®ç¼“å­˜</h2>
<p>å°† Nx æ·»åŠ åˆ°æˆ‘ä»¬çš„ PNPM å·¥ä½œåŒºçš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯ <strong>é€šè¿‡ç¼“å­˜åŠ é€Ÿ</strong>ã€‚<a href="https://nx.dev/concepts/how-caching-works">è®¡ç®—ç¼“å­˜</a> æ˜¯ä¸€ç§åŠŸèƒ½ï¼Œå®ƒä¼šæ”¶é›†ä¸åŒçš„è¾“å…¥ï¼ˆæºæ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤æ ‡å¿—ç­‰ï¼‰ï¼Œå¹¶è®¡ç®—ä¸€ä¸ªå“ˆå¸Œå€¼å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶å¤¹ä¸­ã€‚ä¸‹æ¬¡å†æ¬¡è¿è¡Œå‘½ä»¤æ—¶ï¼ŒNx ä¼šæŸ¥æ‰¾åŒ¹é…çš„å“ˆå¸Œå€¼ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œå®ƒå°†æ¢å¤ç¼“å­˜ã€‚è¿™åŒ…æ‹¬æ¢å¤ç»ˆç«¯è¾“å‡ºä»¥åŠæ„å»ºäº§ç‰©ï¼ˆä¾‹å¦‚ <code>dist</code> æ–‡ä»¶å¤¹ä¸­çš„ JS æ–‡ä»¶ï¼‰ã€‚</p>
<p>å¹¶éæ‰€æœ‰æ“ä½œéƒ½å¯ä»¥ç¼“å­˜ï¼Œåªæœ‰é‚£äº›æ²¡æœ‰å‰¯ä½œç”¨çš„æ“ä½œæ‰èƒ½ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨ç›¸åŒçš„è¾“å…¥è¿è¡ŒæŸä¸ªæ“ä½œï¼Œå®ƒå¿…é¡»å§‹ç»ˆå¯é åœ°äº§ç”Ÿç›¸åŒçš„è¾“å‡ºã€‚å¦‚æœåœ¨è¯¥æ“ä½œä¸­è°ƒç”¨äº†æŸäº› APIï¼Œé‚£ä¹ˆå®ƒå°±æ— æ³•ç¼“å­˜ï¼Œå› ä¸ºå³ä½¿è¾“å…¥å‚æ•°ç›¸åŒï¼ŒAPI çš„ç»“æœä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</p>
<p>ä¸ºäº†å¯ç”¨ç¼“å­˜ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¯ç¼“å­˜çš„æ“ä½œã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨å·¥ä½œåŒºçš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>nx.json</code> æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-json">// nx.json
{
  &quot;tasksRunnerOptions&quot;: {
    &quot;default&quot;: {
      &quot;runner&quot;: &quot;nx/tasks-runners/default&quot;,
      &quot;options&quot;: {
        &quot;cacheableOperations&quot;: [&quot;build&quot;, &quot;test&quot;]
      }
    }
  }
}
</code></pre>
<p>æ³¨æ„ <code>cacheableOperations</code> æ•°ç»„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº† <code>build</code> å’Œ <code>test</code>ã€‚ä½ å¯ä»¥æ·»åŠ æ›´å¤šçš„æ“ä½œï¼Œæ¯”å¦‚ lintã€‚</p>
<p>å¯ç”¨è¿™ä¸€è®¾ç½®åï¼Œå¦‚æœæˆ‘ä»¬ç¬¬ä¸€æ¬¡è¿è¡Œ Remix åº”ç”¨ç¨‹åºçš„æ„å»ºï¼Œå®ƒå°†åƒå¾€å¸¸ä¸€æ ·æ‰§è¡Œï¼Œé¢„è®¡å¤§çº¦éœ€è¦ 1 ç§’é’Ÿã€‚</p>
<pre><code class="language-sh">npx nx build my-remix-app
nx run my-remix-app:build
my-remix-app@ build /Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app
remix buildBuilding Remix app in production mode...
The path &quot;shared-ui&quot; is imported in app/routes/index.tsx but shared-ui is not listed in your package.json dependencies. Did you forget to install it?
Built in 163ms
NX   Successfully ran target build for project my-remix-app (1s)
</code></pre>
<p>å¦‚æœä½ é‡æ–°è¿è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œå®ƒç°åœ¨ä¼šä»ç¼“å­˜ä¸­æå–ï¼Œä»…éœ€å‡ æ¯«ç§’ã€‚</p>
<pre><code class="language-sh">npx nx build my-remix-app&gt; nx run my-remix-app:build  [existing outputs match the cache, left as is]
my-remix-app@ build /Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app
remix buildBuilding Remix app in production mode...
The path &quot;shared-ui&quot; is imported in app/routes/index.tsx but shared-ui is not listed in your package.json dependencies. Did you forget to install it?
Built in 163ms
NX   Successfully ran target build for project my-remix-app (9ms)
Nx read the output from the cache instead of running the command for 1 out of 1 tasks.
</code></pre>
<p>ä½ ä¹Ÿå¯ä»¥ä»ç»ˆç«¯è¾“å‡ºä¸­çœ‹åˆ°â€œç°æœ‰è¾“å‡ºä¸ç¼“å­˜åŒ¹é…ï¼Œä¿æŒä¸å˜â€ï¼Œä»¥åŠæœ€åçš„â€œNx ä»ç¼“å­˜ä¸­è¯»å–äº†è¾“å‡ºï¼Œè€Œä¸æ˜¯æ‰§è¡Œ 1 ä¸ªä»»åŠ¡ä¸­çš„å‘½ä»¤â€ã€‚</p>
<p>å¯ç”¨ç¼“å­˜åï¼Œå¯ä»¥æ˜¾è‘—æé«˜å‘½ä»¤æ‰§è¡Œæ—¶é—´ã€‚å¦‚æœç¼“å­˜æ˜¯è¿œç¨‹åˆ†å‘çš„ï¼Œå®ƒå°†å˜å¾—æ›´åŠ æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ä¸ CI ä»¥åŠå…¶ä»–å¼€å‘è€…çš„æœºå™¨å…±äº«ã€‚å¯¹äº Nxï¼Œå¯ä»¥é€šè¿‡å¯ç”¨ <a href="https://nx.dev/ci/features/remote-cache">Nx Cloud</a> æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå®ƒæä¾›æ¯æœˆ 500 å°æ—¶çš„å…è´¹å­˜å‚¨ï¼ˆæ— éœ€ä¿¡ç”¨å¡ï¼‰ä»¥åŠæ— é™å°æ—¶æ•°ç”¨äºå¼€æºé¡¹ç›®ã€‚</p>
<h2>å¾®è°ƒç¼“å­˜</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜æœºåˆ¶å°† <a href="https://nx.dev/concepts/how-caching-works">æ‰€æœ‰é¡¹ç›®çº§åˆ«çš„æ–‡ä»¶ä½œä¸ºè¾“å…¥</a>ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æ ¹æ®æ‰§è¡Œçš„ç›®æ ‡åŒºåˆ†å“ªäº›æ–‡ä»¶ä¼šè¢«è€ƒè™‘ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªæœ‰å•å…ƒæµ‹è¯•çš„ <code>spec</code> æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›å› ä¸ºè¿™ä¸ªåŸå› è€Œä½¿ <code>build</code> ä»»åŠ¡çš„ç¼“å­˜å¤±æ•ˆã€‚</p>
<p>ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆè¿è¡Œ <code>npx nx build my-remix-app</code> ä¸¤æ¬¡ï¼Œä»¥ä¾¿å¯ç”¨ç¼“å­˜ã€‚æ¥ä¸‹æ¥ï¼Œä¿®æ”¹ Remix é¡¹ç›®çš„ <code>README.md</code> æ–‡ä»¶ï¼ˆ<code>apps/my-remix-app/README.md</code>ï¼‰ã€‚å¦‚æœä½ é‡æ–°è¿è¡Œ Remix åº”ç”¨çš„æ„å»ºï¼Œç¼“å­˜ä¼šå› ä¸º <code>README</code> æ–‡ä»¶çš„æ›´æ”¹è€Œå¤±æ•ˆã€‚è¿™æ˜¾ç„¶å¯èƒ½ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çš„æ“ä½œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ <code>nx.json</code> ä¸­æ·»åŠ ä¸€ä¸ª <code>targetDefaults</code> èŠ‚ç‚¹æ¥å¾®è°ƒç¼“å­˜ï¼Œå¹¶å®šä¹‰é»˜è®¤æƒ…å†µä¸‹ <code>build</code> ç›®æ ‡çš„ <code>input</code> åº”è¯¥æ’é™¤ <code>*.md</code> æ–‡ä»¶ã€‚</p>
<pre><code class="language-json">// nx.json
{
  &quot;tasksRunnerOptions&quot;: {
    &quot;default&quot;: {
      &quot;runner&quot;: &quot;nx/tasks-runners/default&quot;,
      &quot;options&quot;: {
        &quot;cacheableOperations&quot;: [&quot;build&quot;, &quot;test&quot;]
      }
    }
  },
  &quot;targetDefaults&quot;: {
    &quot;build&quot;: {
      &quot;inputs&quot;: [&quot;!{projectRoot}/**/*.md&quot;]
    }
  }
}
</code></pre>
<p>é€šè¿‡è¿™ä¸ªæ›´æ”¹ï¼Œåœ¨è¿è¡Œ <code>build</code> ä»»åŠ¡æ—¶ï¼ŒMD æ–‡ä»¶å°†ä¸ä¼šè¢«è§†ä¸ºç¼“å­˜è¾“å…¥çš„ä¸€éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œæ‰€æœ‰è·¯å¾„ glob æ˜¯ <strong>ç›¸å¯¹äºå·¥ä½œåŒºçš„æ ¹ç›®å½•</strong> çš„ã€‚è¿™é¿å…äº†æ··æ·†ï¼Œå› ä¸ºè¾“å…¥ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®çº§åˆ«çš„ <code>package.json</code> ä¸­å®šä¹‰ (<a href="https://nx.dev/reference/project-configuration">æ›´å¤šå†…å®¹è¯·è§æ­¤</a>)ã€‚ä½ å¯ä»¥ä½¿ç”¨æ’å€¼å˜é‡ <code>{projectRoot}</code> å’Œ <code>{workspaceRoot}</code> æ¥åŒºåˆ†è·¯å¾„æ˜¯åº”è¯¥æŒ‡å‘é¡¹ç›®ç‰¹å®šæ–‡ä»¶è¿˜æ˜¯å·¥ä½œåŒºçº§åˆ«çš„æ–‡ä»¶ã€‚</p>
</blockquote>
<h2>é‡ç”¨ç¼“å­˜è¾“å…¥ Glob</h2>
<p>ä½ è¿˜å¯ä»¥è¿›ä¸€æ­¥æ“ä½œï¼Œå‡è®¾ä½ è¦åœ¨ä¸€ä¸ªå‡è®¾çš„ <code>test</code> ç›®æ ‡ä¸­ä¹Ÿæ’é™¤ markdown æ–‡ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡å°† glob æå–åˆ° <code>namedInputs</code> å±æ€§ä¸­æ¥å®ç°ï¼š</p>
<pre><code class="language-json">// nx.json
{
  &quot;tasksRunnerOptions&quot;: {
    //...
  },
  &quot;namedInputs&quot;: {
    &quot;noMarkdown&quot;: [&quot;!{projectRoot}/**/*.md&quot;]
  },
  &quot;targetDefaults&quot;: {
    &quot;build&quot;: {
      &quot;inputs&quot;: [&quot;noMarkdown&quot;, &quot;^noMarkdown&quot;]
    },
    &quot;test&quot;: {
      &quot;inputs&quot;: [&quot;noMarkdown&quot;, &quot;^noMarkdown&quot;]
    }
  }
}
</code></pre>
<p>é€šè¿‡åœ¨ <code>namedInput</code> å‰é¢æ·»åŠ  <code>^</code>ï¼Œæˆ‘ä»¬è¡¨ç¤ºè¿™åº”è¯¥ä¹Ÿé€‚ç”¨äºé¡¹ç›®çš„ä»»ä½•ä¾èµ–é¡¹çš„å˜åŒ–ã€‚</p>
<h2>å®šä¹‰ä»»åŠ¡ä¾èµ–å…³ç³»ï¼ˆå³æ„å»ºç®¡é“ï¼‰</h2>
<p>æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°ï¼Œå½“è¿è¡Œ Remix å¼€å‘æœåŠ¡å™¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰å…ˆç¼–è¯‘ä¾èµ–çš„ <code>shared-ui</code> åŒ…ï¼Œåœ¨è¿è¡Œ Remix åº”ç”¨æ—¶ä¼šå‡ºç°é”™è¯¯ã€‚</p>
<pre><code class="language-sh">Error: Cannot find module &#39;/Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app/node_modules/shared-ui/dist/index.js&#39;. Please verify that the package.json has a valid &quot;main&quot; entry
    at tryPackage (node:internal/modules/cjs/loader:353:19)
    at Function.Module._findPath (node:internal/modules/cjs/loader:566:18)
    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:919:27)
    at Function.Module._load (node:internal/modules/cjs/loader:778:27)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at Object.&lt;anonymous&gt; (/Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app/app/routes/index.tsx:1:24)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
</code></pre>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæ‰‹åŠ¨æ„å»º <code>shared-ui</code>ã€‚é€šå¸¸ï¼Œä½ å¸Œæœ›é¿å…è¿™ç§æƒ…å†µï¼Œè¿™æ­£æ˜¯ Nx æä¾› <code>targetDefaults</code> å®šä¹‰ï¼ˆé€šå¸¸ä¹Ÿç§°ä¸ºâ€œæ„å»ºç®¡é“â€ï¼‰çš„åŸå› ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨å·¥ä½œåŒºæ ¹ç›®å½•çš„ <code>nx.json</code> ä¸­çš„ <code>targetDefaults</code> å±æ€§ä¸­å®šä¹‰è¿™äº›ä»»åŠ¡ä¾èµ–å…³ç³»ã€‚</p>
<p>ä½œä¸ºç¬¬ä¸€ä¸ªä¾èµ–é¡¹ï¼Œæˆ‘ä»¬å¸Œæœ›å®šä¹‰æ¯å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªé¡¹ç›®ä¸Šè¿è¡Œ <code>build</code> ç›®æ ‡æ—¶ï¼Œæ‰€æœ‰ä¾èµ–é¡¹ç›®çš„ <code>build</code> ç›®æ ‡åº”è¯¥å…ˆæ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘ <code>build</code> ä»»åŠ¡å®šä¹‰æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ <code>dependsOn</code> å±æ€§æ¥è¡¨è¾¾è¿™ä¸€ç‚¹ï¼š</p>
<pre><code class="language-json">{
  &quot;tasksRunnerOptions&quot;: {
    //...
  },
  //...
  &quot;targetDefaults&quot;: {
    &quot;build&quot;: {
      //...
      &quot;dependsOn&quot;: [&quot;^build&quot;]
    }
  }
}
</code></pre>
<p>ä¸æˆ‘ä»¬åœ¨å®šä¹‰ <code>inputs</code> æ—¶çœ‹åˆ°çš„ç±»ä¼¼ï¼Œè¿™é‡Œçš„ <code>^</code> è¡¨ç¤ºç›®æ ‡åº”è¯¥åœ¨æ‰€æœ‰ä¾èµ–é¡¹ç›®ä¸Šè¿è¡Œã€‚å¦‚æœå»æ‰ <code>^</code>ï¼Œé‚£ä¹ˆç›®æ ‡åªä¼šåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸Šè°ƒç”¨ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå§‹ç»ˆéœ€è¦æ‰§è¡Œçš„ <code>prebuild</code> æ­¥éª¤ï¼Œè¿™ç§æ–¹å¼ä¼šå¾ˆæœ‰ç”¨ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›ä¸ºæˆ‘ä»¬çš„ Remix <code>dev</code> å‘½ä»¤å®šä¹‰ä¸€ä¸ª <code>targetDefault</code>ï¼Œç¡®ä¿é¦–å…ˆè¿è¡Œæ‰€æœ‰ä¾èµ–åŒ…ï¼ˆä¾‹å¦‚æˆ‘ä»¬çš„ <code>shared-ui</code>ï¼‰ä¸Šçš„ <code>build</code>ã€‚</p>
<pre><code class="language-json">{
  &quot;tasksRunnerOptions&quot;: {
    //...
  },
  //...
  &quot;targetDefaults&quot;: {
    &quot;build&quot;: {
      //...
      &quot;dependsOn&quot;: [&quot;^build&quot;]
    },
    &quot;dev&quot;: {
      &quot;dependsOn&quot;: [&quot;^build&quot;]
    }
  }
}
</code></pre>
<p>è¿™é‡Œæ˜¯å®Œæ•´çš„ <code>nx.json</code> æ–‡ä»¶ï¼Œä½œä¸ºå‚è€ƒï¼š</p>
<pre><code class="language-json">{
  &quot;tasksRunnerOptions&quot;: {
    &quot;default&quot;: {
      &quot;runner&quot;: &quot;nx/tasks-runners/default&quot;,
      &quot;options&quot;: {
        &quot;cacheableOperations&quot;: [&quot;build&quot;, &quot;test&quot;]
      }
    }
  },
  &quot;namedInputs&quot;: {
    &quot;noMarkdown&quot;: [&quot;!{projectRoot}/**/*.md&quot;]
  },
  &quot;targetDefaults&quot;: {
    &quot;build&quot;: {
      &quot;inputs&quot;: [&quot;noMarkdown&quot;, &quot;^noMarkdown&quot;],
      &quot;dependsOn&quot;: [&quot;^build&quot;]
    },
    &quot;dev&quot;: {
      &quot;dependsOn&quot;: [&quot;^build&quot;]
    }
  }
}
</code></pre>
<p>å¦‚æœæˆ‘ä»¬ç°åœ¨è¿è¡Œ <code>npx nx build my-remix-app</code>ï¼Œå¯ä»¥çœ‹åˆ° Nx é¦–å…ˆåœ¨ä¾èµ–çš„é¡¹ç›®ä¸Šè¿è¡Œä»»åŠ¡ï¼Œç„¶åæ‰æ‰§è¡Œæˆ‘ä»¬è°ƒç”¨çš„å‘½ä»¤ã€‚</p>
<img src="../imgs/102/03.avif" />

<p>Nx å¼ºè°ƒäº†æ­£åœ¨æ„å»ºçš„ä¾èµ–é¡¹ç›®ï¼Œä½†å®ƒå°†ä¸»è¦æ³¨æ„åŠ›é›†ä¸­åœ¨å½“å‰ä»»åŠ¡ä¸Šï¼Œé¿å…åˆ†å¿ƒ</p>
<h2>ä»…è¿è¡Œå·²æ›´æ”¹çš„éƒ¨åˆ†</h2>
<p>é™¤äº†æä¾›ç¼“å­˜åŠŸèƒ½å¤–ï¼ŒNx è¿˜å…è®¸é€šè¿‡ä½¿ç”¨æ‰€è°“çš„ <a href="https://nx.dev/ci/features/affected">â€œaffected commandâ€</a> æ¥ä»…è¿è¡Œç›¸å¯¹äºåŸºç¡€åˆ†æ”¯å·²æ›´æ”¹çš„éƒ¨åˆ†ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨åœ¨å·¥ä½œåŒºä¸­å®šä¹‰çš„ä»»ä½•ç›®æ ‡ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>npx nx affected:build</code></li>
<li><code>npx nx affected:test</code></li>
<li><code>npx nx affected:lint</code></li>
<li><code>npx nx affected:publish</code></li>
</ul>
<p><strong>è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</strong> Nx æ ¹æ®ä½ å·¥ä½œåŒºä¸­åŒ…çš„ç»“æ„å’Œä¾èµ–å…³ç³»æ„å»ºä¸€ä¸ªé¡¹ç›®å›¾ã€‚å‡è®¾æœ‰ä»¥ä¸‹å‡è®¾çš„å›¾ï¼š</p>
<img src="../imgs/102/04.avif" />

<p>å•ä½“ä»“åº“å·¥ä½œåŒºçš„æ½œåœ¨å›¾</p>
<p>æ¯å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸Šè¿è¡Œå—å½±å“çš„å‘½ä»¤æ—¶ï¼ŒNx ä¼šå°†æ‰€æœ‰çš„æäº¤å’Œç›¸å¯¹å˜åŒ–ä¸åŸºå‡†åˆ†æ”¯è¿›è¡Œæ¯”è¾ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸºå‡†åˆ†æ”¯æ˜¯ <code>main</code>ï¼Œä½†ä½ å¯ä»¥åœ¨ <code>nx.json</code> æ–‡ä»¶ä¸­è¿›è¡Œç»†åŒ–é…ç½®ï¼š</p>
<pre><code class="language-json">{
  &quot;affected&quot;: {
    &quot;defaultBase&quot;: &quot;main&quot;
  }
}
</code></pre>
<p>å¦‚æœ <code>lib2</code> åœ¨æˆ‘ä»¬çš„åŠŸèƒ½åˆ†æ”¯ä¸­å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>affected:test</code> å¯¹å·¥ä½œåŒºè¿è¡Œæµ‹è¯•æ—¶ï¼Œåªä¼šè¿è¡Œ <code>lib2</code> å’Œ <code>appB</code> çš„æµ‹è¯•ã€‚</p>
<img src="../imgs/102/05.avif" />

<p>å¦‚æœâ€œlib2â€å‘ç”Ÿå˜åŒ–çš„å½±å“é¡¹ç›®</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œ <code>affected:build</code> å¹¶ä¸”åœ¨ <code>nx.json</code> ä¸­å®šä¹‰äº†ä¾èµ–å…³ç³»ï¼ŒæŒ‡ç¤ºéœ€è¦é¦–å…ˆæ„å»ºä¾èµ–é¡¹ç›®ï¼ˆå‚è§â€œå®šä¹‰ä»»åŠ¡ä¾èµ–å…³ç³»â€éƒ¨åˆ†ï¼‰ï¼Œé‚£ä¹ˆ <code>affected:build</code> å°†ä¼šæ„å»ºï¼š</p>
<ul>
<li><code>lib3</code></li>
<li><code>lib2</code></li>
<li><code>appB</code></li>
</ul>
<p>ä½†ä¸ä¼šæ„å»º <code>lib1</code> æˆ– <code>appA</code>ã€‚</p>
<h2>å…¶ä»–åŠŸèƒ½</h2>
<p>é™¤äº†é€Ÿåº¦å’Œä»»åŠ¡è°ƒåº¦æ”¹è¿›å¤–ï¼Œé€šè¿‡å°† Nx æ·»åŠ åˆ°æˆ‘ä»¬çš„ PNPM å·¥ä½œåŒºï¼Œæˆ‘ä»¬è¿˜è·å¾—äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚è®©æˆ‘ä»¬æ¢ç´¢ä¸€äº›ï¼š</p>
<h2>æƒ³è¦è‡ªåŠ¨åŒ–åˆ›å»ºåŒ…å—ï¼Ÿ</h2>
<p>ä¸€æ—¦ä½ ä¸ºä¸€ä¸ªåŒ…è®¾ç½®å¥½äº†è‰¯å¥½çš„é…ç½®ï¼Œæ˜¾ç„¶ä½ ä¼šå¸Œæœ›åœ¨åˆ›å»ºæ–°åŒ…æ—¶å¤åˆ¶è¿™ä¸ªé…ç½®ã€‚é€šå¸¸çš„åšæ³•æ˜¯ï¼šå¤åˆ¶å’Œç²˜è´´ï¼Œç„¶ååˆ é™¤æ‰€æœ‰ä¸éœ€è¦çš„å†…å®¹ã€‚</p>
<p>è¿™æ—¢ç¹çåˆå®¹æ˜“å‡ºé”™ã€‚Nx æœ‰ä¸€ä¸ªåä¸ºâ€œç”Ÿæˆå™¨â€çš„æ¦‚å¿µï¼ŒåŸºæœ¬ä¸Šæ˜¯ä»£ç è„šæ‰‹æ¶ï¼Œå®ƒå…è®¸ä½ åœ¨ monorepo ä¸­ç”Ÿæˆæ–°åŒ…ï¼Œè€Œä¸æ˜¯å¤åˆ¶å’Œç²˜è´´æ—§åŒ…ã€‚</p>
<p>å¦‚æœè¿™å¬èµ·æ¥å¾ˆæœ‰è¶£ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ“ä½œæŒ‡å—ï¼š</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/myqfGDWC2go" title="Scaffold new Pkgs in a PNPM Workspaces Monorepo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<h2>åŠ¨æ€ç»ˆç«¯è¾“å‡º</h2>
<p>ä½¿ç”¨ PNPM å¹¶è¡Œè¿è¡Œä»»åŠ¡ä¼šå¯¼è‡´ç»ˆç«¯è¾“å‡ºå˜å¾—éå¸¸æ··ä¹±ã€‚ç”±äºä¸åŒå‘½ä»¤çš„è¾“å‡ºæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œå› æ­¤æ—¥å¿—ä¿¡æ¯äº¤é”™åœ¨ä¸€èµ·ï¼Œéš¾ä»¥è§£æã€‚</p>
<pre><code class="language-sh">pnpm run --parallel -r buildScope: 2 of 3 workspace projects
apps/my-remix-app build$ remix build
packages/shared-ui build$ rm -rf dist &amp;&amp; tsc
apps/my-remix-app build: Building Remix app in production mode...
apps/my-remix-app build: The path &quot;shared-ui&quot; is imported in app/routes/index.tsx but shared-ui is not listed in your package.json dependencies. Did you forget to install it?
apps/my-remix-app build: Built in 176ms
apps/my-remix-app build: Done
packages/shared-ui build: Done
</code></pre>
<p>ä½¿ç”¨ Nx è¿è¡Œä»»åŠ¡æ—¶ï¼Œç»ˆç«¯è¾“å‡ºæ˜¯åŠ¨æ€çš„ï¼Œåªæ˜¾ç¤ºå½“å‰æ‰§è¡Œå‘½ä»¤æ‰€éœ€çš„æœ€ç›¸å…³çš„ä¿¡æ¯ã€‚å½“ä½¿ç”¨ Nx è¿è¡Œç›¸åŒçš„å¹¶è¡Œæ„å»ºä»»åŠ¡æ—¶ï¼Œè¾“å‡ºå°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="../imgs/102/06.avif" />

<p>Nx åŠ¨æ€æ˜¾ç¤ºæ­£åœ¨è®¡ç®—çš„å¹¶è¡Œä»»åŠ¡ä»¥åŠå·²æˆåŠŸå®Œæˆçš„ä»»åŠ¡çš„ç»ˆç«¯è¾“å‡º</p>
<h2>é¡¹ç›®å›¾å¯è§†åŒ–</h2>
<pre><code class="language-sh">npx nx graph
</code></pre>
<p>è¿™å°†å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼çš„å·¥ä½œåŒºé¡¹ç›®å›¾å¯è§†åŒ–ï¼Œå…·æœ‰ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå¦‚è¿‡æ»¤ã€è°ƒè¯•å·¥ä½œåŒºç»“æ„ç­‰ã€‚</p>
<img src="../imgs/102/07.avif" />

<p><em>Nx é¡¹ç›®å›¾å¯è§†åŒ–æˆ‘ä»¬çš„ PNPM å·¥ä½œåŒº</em></p>
<blockquote>
<p><em>é™„å¸¦è¯´æ˜ï¼šä½ å¯ä»¥åœ¨ä»»ä½• PNPM å·¥ä½œåŒºä¸Šè¿è¡Œé¡¹ç›®å›¾ï¼Œå³ä½¿æ²¡æœ‰å®‰è£… Nxã€‚è¿è¡Œ</em> <code>_npx nx graph_</code> <em>åº”è¯¥ä¹Ÿèƒ½å·¥ä½œã€‚</em></p>
</blockquote>
<h2>ç»“è®º</h2>
<p>æˆ‘ä»¬å®Œæˆäº†ï¼ä»¥ä¸‹æ˜¯æˆ‘ä»¬è¦†ç›–çš„ä¸€äº›å†…å®¹ï¼š</p>
<ul>
<li>å¦‚ä½•è®¾ç½®åŸºäº PNPM çš„ monorepo å·¥ä½œåŒº</li>
<li>åœ¨ PNPM monorepo ä¸­åˆ›å»º Remix å’Œå…±äº« React åº“</li>
<li>å¦‚ä½•ä½¿ç”¨ PNPM è¿è¡Œä¸åŒçš„å‘½ä»¤</li>
<li>å¦‚ä½•å°† Nx æ·»åŠ åˆ° monorepo ä¸­å¹¶é€æ­¥é‡‡ç”¨</li>
<li>å‘ PNPM å·¥ä½œåŒºæ·»åŠ  Nx åçš„å¥½å¤„å’Œç‰¹æ€§</li>
</ul>
<p>ä½ å¯ä»¥åœ¨ <strong>Nx Recipe GitHub ä»“åº“</strong> ä¸­æ‰¾åˆ°è¿™æ ·çš„è®¾ç½®ç¤ºä¾‹ï¼š<br><a href="https://github.com/nrwl/nx-recipes/tree/main/pnpm-workspace">https://github.com/nrwl/nx-recipes/tree/main/pnpm-workspace</a></p>
<h2>äº†è§£æ›´å¤š</h2>
<ul>
<li>ğŸ§  <a href="https://nx.dev/getting-started/intro">Nx æ–‡æ¡£</a></li>
<li>ğŸ‘©â€ğŸ’» <a href="https://github.com/nrwl/nx">Nx GitHub</a></li>
<li>ğŸ’¬ <a href="https://go.nx.dev/community">Nx å®˜æ–¹ Discord æœåŠ¡å™¨</a></li>
<li>ğŸ“¹ <a href="https://www.youtube.com/nrwl_io">Nrwl YouTube é¢‘é“</a></li>
<li>ğŸ¥š <a href="https://egghead.io/courses/scale-react-development-with-nx-4038">å…è´¹ Egghead è¯¾ç¨‹</a></li>
</ul>

        </article>
      </main>

      <!-- Table of Contents Sidebar -->
      <aside class="toc-sidebar">
        <div class="toc-header">
          <h3>Table of Contents</h3>
        </div>
        <div class="toc-content" id="tocContent">
          <!-- TOC will be generated dynamically -->
        </div>
      </aside>
    </div>

    <div class="body_bg"></div>
    <div class="zoom-overlay"></div>

    <button id="backToTop" class="back-to-top" aria-label="Back to top">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M12 19V5M5 12l7-7 7 7" />
      </svg>
    </button>

    <style>
      .zoom-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        z-index: 1000;
        cursor: zoom-out;
      }
      .zoomed-image {
        position: fixed;
        z-index: 1001;
        will-change: transform;
        cursor: zoom-out;
        max-width: 90vw;
        max-height: 90vh;
        object-fit: contain;
      }
      .back-button {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 50px;
        height: 50px;
        border-radius: 100%;
        background-color: #07a;
        border: none;
        color: #333;
        text-decoration: none;
        font-size: 14px;
        margin-bottom: 16px;
        cursor: pointer;
        transition: background-color 0.2s;
        position: fixed !important;
        top: 30px;
        right: 30px;
        z-index: 10;
        display: none;
      }
      .back-button svg {
        width: 50%;
        height: 50%;
      }
      .back-button:hover {
        opacity: 0.8;
      }
      .layout {
        position: relative;
        z-index: 1;
      }
      .back-to-top {
        position: fixed;
        bottom: 2rem;
        right: 340px;
        background: linear-gradient(
          135deg,
          var(--accent),
          rgba(59, 130, 246, 0.8)
        );
        color: white;
        border: none;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      }

      .back-to-top svg {
        width: 1.5rem;
        height: 1.5rem;
        stroke: currentColor;
        transition: transform 0.3s ease;
      }

      .back-to-top:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.3);
        background: linear-gradient(135deg, var(--accent), #2563eb);
      }

      .back-to-top:hover svg {
        transform: translateY(-2px);
      }

      .dark .back-to-top {
        background: linear-gradient(135deg, #4b5563, #1f2937);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .dark .back-to-top:hover {
        background: linear-gradient(135deg, #4b5563, #111827);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }
    </style>
    <script defer src="../js/prism.min.js"></script>
    <script>
      // Sidebar Toggle
      const toggleBtn = document.getElementById("toggleSidebar");
      const sidebar = document.querySelector(".sidebar");
      const mainContent = document.querySelector(".main-content");

      function toggleSidebar() {
        sidebar.classList.toggle("hidden");
        // Store sidebar state in localStorage
        localStorage.setItem(
          "sidebarHidden",
          sidebar.classList.contains("hidden")
        );
      }

      toggleBtn.addEventListener("click", toggleSidebar);

      // Keyboard shortcut (Ctrl + B)
      window.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.key === "b") {
          e.preventDefault(); // Prevent browser's default behavior
          toggleSidebar();
        }
      });

      // Restore sidebar state from localStorage
      document.addEventListener("DOMContentLoaded", () => {
        const sidebarHidden = localStorage.getItem("sidebarHidden") === "true";
        if (sidebarHidden) {
          sidebar.classList.add("hidden");
        }
      });

      // Generate Table of Contents
      function generateTOC() {
        const article = document.querySelector(".content-body");
        const headings = article.querySelectorAll("h1, h2, h3, h4");
        const tocContent = document.getElementById("tocContent");
        const toc = document.createElement("ul");

        headings.forEach((heading, index) => {
          const id = `heading-${index}`;
          heading.id = id;

          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = `#${id}`;
          a.textContent = heading.textContent;
          a.className = `toc-level-${heading.tagName.toLowerCase()}`;

          li.appendChild(a);
          toc.appendChild(li);
        });

        tocContent.appendChild(toc);
      }

      // Initialize TOC
      document.addEventListener("DOMContentLoaded", generateTOC);

      // Image zoom with FLIP animation
      const overlay = document.querySelector(".zoom-overlay");
      let activeImage = null;

      document.querySelectorAll("img").forEach((img) => {
        if (img.closest("a")) return; // Skip images that are inside links
        img.style.cursor = "zoom-in";
        img.addEventListener("click", handleImageClick);
      });

      function handleImageClick(event) {
        const img = event.target;

        if (activeImage) {
          // If an image is already zoomed, unzoom it
          unzoomImage();
          return;
        }

        // Get the initial position and size
        const rect = img.getBoundingClientRect();
        const first = {
          x: rect.left,
          y: rect.top,
          width: rect.width,
          height: rect.height,
        };

        // Create a clone of the image
        const clone = img.cloneNode();
        clone.classList.add("zoomed-image");
        document.body.appendChild(clone);

        // Position the clone exactly over the original
        clone.style.position = "fixed";
        clone.style.left = `${first.x}px`;
        clone.style.top = `${first.y}px`;
        clone.style.width = `${first.width}px`;
        clone.style.height = `${first.height}px`;
        clone.style.margin = "0";
        clone.style.transformOrigin = "top left";

        // Show the overlay
        overlay.style.display = "block";

        // Calculate the final position and scale
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        const targetWidth = Math.min(img.naturalWidth, viewportWidth * 0.9);
        const targetHeight = Math.min(img.naturalHeight, viewportHeight * 0.9);
        const scaleX = targetWidth / first.width;
        const scaleY = targetHeight / first.height;
        const scale = Math.min(scaleX, scaleY);

        const last = {
          width: first.width * scale,
          height: first.height * scale,
        };
        last.x = (viewportWidth - last.width) / 2;
        last.y = (viewportHeight - last.height) / 2;

        // Calculate and apply the transform
        const dx = last.x - first.x;
        const dy = last.y - first.y;

        requestAnimationFrame(() => {
          clone.style.transform = `translate(${dx}px, ${dy}px) scale(${scale})`;
          clone.style.transition = "transform 0.3s ease-out";
        });

        activeImage = { original: img, clone: clone };

        // Add click handlers for closing
        clone.addEventListener("click", unzoomImage);
        overlay.addEventListener("click", unzoomImage);
      }

      function unzoomImage() {
        if (!activeImage) return;

        const { original, clone } = activeImage;
        const rect = original.getBoundingClientRect();

        // Animate back to the original position
        clone.style.transform = `translate(0, 0) scale(1)`;

        // Clean up after the animation
        clone.addEventListener(
          "transitionend",
          () => {
            clone.remove();
            overlay.style.display = "none";
          },
          { once: true }
        );

        activeImage = null;
      }

      // ç›‘å¬ ctrl + b
      window.addEventListener("keydown", (e) => {
        const leftDom = document.querySelector(".sidebar");
        if (e.ctrlKey && e.key === "b") {
          leftDom.classList.toggle("hidden");
        }
      });

      // Modal
      // const modal = document.getElementById("myModal");
      // const modalContent = modal.querySelector(".modal-content");
      // const openModal = document.getElementById("openModal");
      // const close = modal.querySelector(".close");

      // openModal.addEventListener("click", () => {
      //     modal.style.display = "block";
      // });

      // close.addEventListener("click", () => {
      //     modal.style.display = "none";
      // });

      // window.addEventListener("click", (e) => {
      //     if (e.target === modal) {
      //         modal.style.display = "none";
      //     }
      // });

      // Back to top button
      const backToTop = document.getElementById("backToTop");
      window.addEventListener("scroll", () => {
        if (window.scrollY > 200) {
          backToTop.style.display = "block";
        } else {
          backToTop.style.display = "none";
        }
      });

      backToTop.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      // Theme toggle
      document.addEventListener("DOMContentLoaded", () => {
        const themeToggle = document.getElementById("themeToggle");
        const html = document.documentElement;
        const prismTheme = document.getElementById("prismTheme");

        // Function to update theme and stylesheet
        function updateTheme(theme) {
          html.className = theme;
          prismTheme.href = `../css/prism${theme === "dark" ? "2" : ""}.css`;
          localStorage.setItem("theme", theme);
        }

        // Check for saved theme preference
        const savedTheme = localStorage.getItem("theme") || "light";
        updateTheme(savedTheme);

        themeToggle.addEventListener("click", () => {
          const currentTheme = html.className;
          const newTheme = currentTheme === "light" ? "dark" : "light";
          updateTheme(newTheme);
        });
      });
    </script>
  </body>
</html>
