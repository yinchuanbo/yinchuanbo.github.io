<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"
      name="viewport"
    />
    <title>webpack 打包体积优化，app.js 文件从 9.2MB 优化至 2.7MB</title>
    <link rel="shortcut icon" href="../code.svg" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/prism2.css" />
    <link rel="stylesheet" href="../css/edit2.css" />
  </head>
  <body class="line-numbers">
    <main>
      <header>
        <h1>webpack 打包体积优化，app.js 文件从 9.2MB 优化至 2.7MB</h1>
        <p class="time">HaoTian · 2024-10-19 14:18:15</p>
      </header>
      <h2>未优化前 app.js 文件大小</h2>
<p>未优化前 app.js 文件大小为 9.2MB</p>
<h2>写一个 webpack 插件，找出 size 比较大的 module</h2>
<pre><code class="language-js">class WebpackCustomPlugin {
    compiler.hooks.done.tap(&#39;&#39;, (stats) =&gt; {
        const chunks = stats.compilation.chunks
        chunks.forEach(chunk =&gt; {
            consone.log(chunk.id, chunk.files)
            const newModules = []
            // 遍历组合成chunk的modules，将一些需要的数据放入到数组中
            for(const module of chunk._modules) {
                newModules.push({
                    id: module.id,
                    resource: module.resource,
                    _sourceSize: module._sourceSize,
                    reasons: module.reason[0]?.module?.id
                })
            }
            // 对newModules数组按大小排序
            newModules.sort((a, b) =&gt; b._sourceSize - a._sourceSize)
            if (chunk?.id.toString().indexOf(&#39;app&#39;) &gt; -1) {
                console.log(newModules.slice(0, 20))
            }
        })
    })
}
</code></pre>
<h2>优化 1</h2>
<p><code>src/theme/index.less</code> 文件大小 706977，定位到该文件，发现语句<code>@import &#39;~ant-design-vue/dist/antd.less&#39;</code>，项目已经按需加载 <code>ant-design-vue</code>，所以只需要删除该语句。删除后 app.js 大小为<code>7.5MB</code>。</p>
<h2>优化 2</h2>
<p>一个大小为 26943 的 <code>TableSetting.vue</code> 组件全局引入了，但没有地方使用，所以删除。删除后 app.js 大小为<code>7.4MB</code></p>
<h2>优化 3</h2>
<p>将个别页面使用到的组件，从 main.js 文件移除注册，优化后，app.js 文件大小为<code>6.8MB</code>。</p>
<h2>优化 4</h2>
<p>发现很多大的图片，都被打包到了 app.js 中</p>
<p>设置 url-loader 的阀值为 8KB，即超过 8K 大小的图片文件不会转换为 DataURL。</p>
<p>优化后 app.js 文件大小为<code>2.7MB</code></p>
<p>原来 app.js 文件里面大部分都是图片的大小！！！</p>

    </main>
    <aside id="nav">
      <ul>
        <li class=""><a title="使用 vite 如何开启 gzip 压缩" href="/md/使用 vite 如何开启 gzip 压缩.html">18 使用 vite 如何开启 gzip 压缩</a></li><li class="active"><a title="webpack 打包体积优化" href="/md/webpack 打包体积优化.html">17 webpack 打包体积优化</a></li><li class=""><a title="前端项目中的 node_modules 无用依赖检测工具" href="/md/前端项目中的 node_modules 无用依赖检测工具.html">16 前端项目中的 node_modules 无用依赖检测工具</a></li><li class=""><a title="详解 Monorepo 进化、优劣与使用场景" href="/md/详解 Monorepo 进化、优劣与使用场景.html">15 详解 Monorepo 进化、优劣与使用场景</a></li><li class=""><a title="ESLint 现已支持检查 JSON 和 Markdown" href="/md/ESLint 现已支持检查 JSON 和 Markdown.html">14 ESLint 现已支持检查 JSON 和 Markdown</a></li><li class=""><a title="如何使用 Vike 和 Vite 构建可扩展的微前端" href="/md/如何使用 Vike 和 Vite 构建可扩展的微前端.html">13 如何使用 Vike 和 Vite 构建可扩展的微前端</a></li><li class=""><a title="使用 Axios 配置动态域名的基础 URL 和项目打包" href="/md/使用 Axios 配置动态域名的基础 URL 和项目打包.html">12 使用 Axios 配置动态域名的基础 URL 和项目打包</a></li><li class=""><a title="vite插件开发,项目版本号自增,自动压缩构建产物上传oss" href="/md/vite插件开发,项目版本号自增,自动压缩构建产物上传oss.html">11 vite插件开发,项目版本号自增,自动压缩构建产物上传oss</a></li><li class=""><a title="vite 创建 vue3 项目" href="/md/vite 创建 vue3 项目.html">010 vite 创建 vue3 项目</a></li><li class=""><a title="使用 eslint-plugin-depend 移除无用的 NPM 包" href="/md/使用 eslint-plugin-depend 移除无用的 NPM 包.html">09 使用 eslint-plugin-depend 移除无用的 NPM 包</a></li><li class=""><a title="前端版本管理工具 - volta" href="/md/前端版本管理工具 - volta.html">08 前端版本管理工具 - volta</a></li><li class=""><a title="vite 配置" href="/md/vite 配置.html">07 vite 配置</a></li><li class=""><a title="Eslint 配置指南" href="/md/Eslint 配置指南.html">06 Eslint 配置指南</a></li><li class=""><a title="ESLint 忽略检查行和文件总结" href="/md/ESLint 忽略检查行和文件总结.html">05 ESLint 忽略检查行和文件总结</a></li><li class=""><a title="Eslint 和 Prettier 的配置与冲突处理" href="/md/Eslint 和 Prettier 的配置与冲突处理.html">04 Eslint 和 Prettier 的配置与冲突处理</a></li><li class=""><a title="检查前端项目和 node 项目中未被使用的依赖包" href="/md/检查前端项目和 node 项目中未被使用的依赖包.html">03 检查前端项目和 node 项目中未被使用的依赖包</a></li><li class=""><a title="最新 ESLint 9.0 + vue3.0 + TS 配置" href="/md/最新 ESLint 9.0 + vue3.0 + TS 配置.html">02 最新 ESLint 9.0 + vue3.0 + TS 配置</a></li><li class=""><a title="前端构建系统浅析" href="/md/前端构建系统浅析.html">01 前端构建系统浅析</a></li>
      </ul>
      <div class="switch">
        <svg
          t="1730889498743"
          class="icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="7580"
          width="25"
          height="25"
        >
          <path
            d="M755.114667 332.074667L694.144 392.96l181.034667 181.034667 60.928-60.970667z"
            fill="#ffffff"
            p-id="7581"
          ></path>
          <path
            d="M755.2 694.229333l-60.928-60.928 181.034667-181.034666 60.928 60.970666z"
            fill="#ffffff"
            p-id="7582"
          ></path>
          <path
            d="M554.666667 469.333333h298.666666v85.333334h-298.666666zM268.885333 332.202667l60.970667 60.928-181.034667 181.034666-60.928-60.970666z"
            fill="#ffffff"
            p-id="7583"
          ></path>
          <path
            d="M268.757333 694.357333l60.928-60.970666-180.992-180.992-60.970666 60.928z"
            fill="#ffffff"
            p-id="7584"
          ></path>
          <path
            d="M469.333333 469.461333H170.666667v85.333334h298.666666z"
            fill="#ffffff"
            p-id="7585"
          ></path>
        </svg>
      </div>
    </aside>
    <div class="other">
      <button onclick="location.href='/md'">
        <svg
          t="1730945692261"
          class="icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="4576"
          width="25"
          height="25"
        >
          <path
            d="M147.904 304.128l301.866667-179.541333a128 128 0 0 1 131.712 0.512l295.466666 178.88A128 128 0 0 1 938.666667 413.482667V810.666667a128 128 0 0 1-128 128H213.333333a128 128 0 0 1-128-128V414.144a128 128 0 0 1 62.570667-110.016z m43.626667 73.344A42.666667 42.666667 0 0 0 170.666667 414.144V810.666667a42.666667 42.666667 0 0 0 42.666666 42.666666h597.333334a42.666667 42.666667 0 0 0 42.666666-42.666666V413.482667a42.666667 42.666667 0 0 0-20.565333-36.501334l-295.466667-178.88a42.666667 42.666667 0 0 0-43.925333-0.170666l-301.866667 179.541333z"
            fill="#ffffff"
            p-id="4577"
          ></path>
          <path
            d="M405.333333 469.333333h213.333334a42.666667 42.666667 0 1 1 0 85.333334H405.333333a42.666667 42.666667 0 1 1 0-85.333334z m0 85.333334a42.666667 42.666667 0 1 0 0-85.333334h213.333334a42.666667 42.666667 0 1 0 0 85.333334H405.333333z"
            fill="#ffffff"
            p-id="4578"
          ></path>
        </svg>
      </button>
    </div>
    <script defer src="../js/prism.min.js"></script>
    <script defer src="../js/edit2.js"></script>
  </body>
</html>
