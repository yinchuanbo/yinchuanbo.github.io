<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"
      name="viewport"
    />
    <title>利用fetchpriority优化资源加载，提升网页性能</title>
    <link rel="shortcut icon" href="../code.svg" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=fallback"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/prism.css" />
    <link rel="stylesheet" href="../css/edit.css" />
    
  </head>
  
  <body>
    <div class="layout">
      <div class="layout__main">
        <div class="layout__main_left" style="order: 0">
          <div class="layout__main_left-switch"></div>
          <ul>
            <li class=""><a title="Rust vs JavaScript 使用 WebAssembly 提升百分 66 的性能" href="/md/Rust vs JavaScript 使用 WebAssembly 提升百分 66 的性能.html">30 Rust vs JavaScript 使用 WebAssembly 提升百分 66 的性能</a></li><li class=""><a title="避免巨大网络负载的 10 个方法" href="/md/避免巨大网络负载的 10 个方法.html">29 避免巨大网络负载的 10 个方法</a></li><li class="active"><a title="利用fetchpriority优化资源加载，提升网页性能" href="/md/利用fetchpriority优化资源加载，提升网页性能.html">28 利用fetchpriority优化资源加载，提升网页性能</a></li><li class=""><a title="一文读懂 JS 内存管理，掌握面试中 7 大内存泄漏场景" href="/md/一文读懂 JS 内存管理，掌握面试中 7 大内存泄漏场景.html">27 一文读懂 JS 内存管理，掌握面试中 7 大内存泄漏场景</a></li><li class=""><a title="首页加载速度优化" href="/md/首页加载速度优化.html">26 首页加载速度优化</a></li><li class=""><a title="前端如何实现 gzip 打包压缩" href="/md/前端如何实现 gzip 打包压缩.html">25 前端如何实现 gzip 打包压缩</a></li><li class=""><a title="性能优化思路之网络层优化" href="/md/性能优化思路之网络层优化.html">24 性能优化思路之网络层优化</a></li><li class=""><a title="你实现的前端图片预加载真的够优雅吗" href="/md/你实现的前端图片预加载真的够优雅吗.html">23 你实现的前端图片预加载真的够优雅吗</a></li><li class=""><a title="前端如何避免重排 reflow 和重绘 repaint" href="/md/前端如何避免重排 reflow 和重绘 repaint.html">22 前端如何避免重排 reflow 和重绘 repaint</a></li><li class=""><a title="页面加载流程分析技巧" href="/md/页面加载流程分析技巧.html">21 页面加载流程分析技巧</a></li><li class=""><a title="资源优先级" href="/md/资源优先级.html">20 资源优先级</a></li><li class=""><a title="聊聊图片预加载" href="/md/聊聊图片预加载.html">19 聊聊图片预加载</a></li><li class=""><a title="网站优化之静态资源优化" href="/md/网站优化之静态资源优化.html">18 网站优化之静态资源优化</a></li><li class=""><a title="看《浏览器基本原理与实践》后，36点总结" href="/md/看《浏览器基本原理与实践》后，36点总结.html">17 看《浏览器基本原理与实践》后，36点总结</a></li><li class=""><a title="渲染优化" href="/md/渲染优化.html">16 渲染优化</a></li><li class=""><a title="浏览器渲染性能分析技巧" href="/md/浏览器渲染性能分析技巧.html">15 浏览器渲染性能分析技巧</a></li><li class=""><a title="构建优化" href="/md/构建优化.html">14 构建优化</a></li><li class=""><a title="性能优化全家桶：6 个方面 9 点建议" href="/md/性能优化全家桶：6 个方面 9 点建议.html">13 性能优化全家桶：6 个方面 9 点建议</a></li><li class=""><a title="性能优化-时间分片渲染简单做法" href="/md/性能优化-时间分片渲染简单做法.html">12 性能优化-时间分片渲染简单做法</a></li><li class=""><a title="加载注意事项" href="/md/加载注意事项.html">11 加载注意事项</a></li><li class=""><a title="利用 Performance API 分析网站性能" href="/md/利用 Performance API 分析网站性能.html">10 利用 Performance API 分析网站性能</a></li><li class=""><a title="内存泄漏排查" href="/md/内存泄漏排查.html">09 内存泄漏排查</a></li><li class=""><a title="了解透彻浏览器缓存" href="/md/了解透彻浏览器缓存.html">08 了解透彻浏览器缓存</a></li><li class=""><a title="书写高性能的代码" href="/md/书写高性能的代码.html">07 书写高性能的代码</a></li><li class=""><a title="Performance 面板分析性能瓶颈全流程" href="/md/Performance 面板分析性能瓶颈全流程.html">06 Performance 面板分析性能瓶颈全流程</a></li><li class=""><a title="API 技巧" href="/md/API 技巧.html">05 API 技巧</a></li><li class=""><a title="速通 JS 性能优化" href="/md/速通 JS 性能优化.html">04 速通 JS 性能优化</a></li><li class=""><a title="网页太慢了怎么排查" href="/md/网页太慢了怎么排查.html">03 网页太慢了怎么排查</a></li><li class=""><a title="浅谈前端性能优化之评估工具" href="/md/浅谈前端性能优化之评估工具.html">02 浅谈前端性能优化之评估工具</a></li><li class=""><a title="前端如何优化资源加载" href="/md/前端如何优化资源加载.html">01 前端如何优化资源加载</a></li>
          </ul>
        </div>
        <div
          style="order: 1"
          class="layout__main_right md "
        >
          <div class="page-header">
            <h1>利用fetchpriority优化资源加载，提升网页性能</h1>
            <p class="time">HaoTian · 2024-12-07 18:44:28</p>
          </div>
          <p>在网页开发中，资源加载的优化一直是提升用户体验的关键环节。 在没有 fetchpriority 之前， <a href="https://www.kelen.cc/posts/html-fetch-priority#">浏览器</a>对资源的加载优先级有一定的预设规则，但这些规则可能不完全符合我们的优化需求。使用 fetchpriority，我们可以更精确地控制资源的加载顺序，从而优化页面的关键渲染路径（Critical Rendering Path），提升如最大内容绘制（Largest Contentful Paint, LCP）等性能指标。</p>
<h2>什么是 fetchpriority?</h2>
<p>fetchpriority 是一个 HTML 属性，它可以被添加到任何加载资源的 HTML 元素上，如图片、脚本等。 通过这个属性，我们可以告诉浏览器哪些资源更加重要，应该优先加载。 fetchpriority 有三个可选值值：low、high 和默认的 auto。</p>
<ul>
<li>low：降低资源的相对优先级。</li>
<li>high：提高资源的相对优先级。</li>
<li>auto：默认值，让浏览器决定优先级。</li>
</ul>
<p>如何使用 fetchpriority 来提高资源加载权重呢？下面举个几个常见的场景。</p>
<h2>提高图片加载权重</h2>
<p>假设我们有一个图片轮播，其中包含了页面的主要内容。我们希望浏览器优先加载当前显示的图片，以提升 LCP 性能。</p>
<pre><code class="language-html">&lt;!-- 当前显示的图片设置高优先级 --&gt;
&lt;img src=&quot;current-image.jpg&quot; fetchpriority=&quot;high&quot; /&gt;
&lt;!-- 其他轮播图片设置低优先级 --&gt;
&lt;img src=&quot;other-image1.jpg&quot; fetchpriority=&quot;low&quot; /&gt;
&lt;img src=&quot;other-image2.jpg&quot; fetchpriority=&quot;low&quot; /&gt;
</code></pre>
<h2>优化延迟加载的图片</h2>
<p>对于使用 <code>loading=&quot;lazy&quot;</code> 属性的延迟加载图片，我们可以通过 <code>fetchpriority</code> 来优化它们的加载顺序。</p>
<pre><code class="language-html">&lt;!-- 延迟加载的图片，优先加载主要内容图片 --&gt;
&lt;img src=&quot;main-content-image.jpg&quot; loading=&quot;lazy&quot; fetchpriority=&quot;high&quot; /&gt;
&lt;!-- 其他延迟加载的图片 --&gt;
&lt;img src=&quot;lazy-image1.jpg&quot; loading=&quot;lazy&quot; fetchpriority=&quot;low&quot; /&gt;
&lt;img src=&quot;lazy-image2.jpg&quot; loading=&quot;lazy&quot; fetchpriority=&quot;low&quot; /&gt;
</code></pre>
<h2>JS 资源的加载优先级</h2>
<p>对于 JS 资源，我们可以使用 <code>fetchpriority</code> 来调整它们的加载顺序，确保关键脚本首先被加载。</p>
<pre><code class="language-html">&lt;!-- 重要的JavaScript脚本 --&gt;
&lt;script src=&quot;critical.js&quot; fetchpriority=&quot;high&quot;&gt;&lt;/script&gt;
&lt;!-- 较不重要的JavaScript脚本 --&gt;
&lt;script src=&quot;non-critical.js&quot; fetchpriority=&quot;low&quot;&gt;&lt;/script&gt;
</code></pre>
<h2>fetch 请求优先级</h2>
<p>可以使用 <code>fetchpriority</code> 来设置 fetch 请求的优先级。</p>
<pre><code class="language-js">// 高优先级的fetch请求，用于获取主要内容
fetch(&quot;https://api.example.com/content&quot;, { fetchpriority: &quot;high&quot; })
  .then((response) =&gt; response.json())
  .then((data) =&gt; console.log(&quot;Main content:&quot;, data));
// 低优先级的fetch请求，用于获取评论
fetch(&quot;https://api.example.com/comments&quot;, { fetchpriority: &quot;low&quot; })
  .then((response) =&gt; response.json())
  .then((data) =&gt; console.log(&quot;Comments:&quot;, data));
</code></pre>
<p>fetchpriority 为我们提供了一个强大的工具来优化资源加载，从而提升网页的性能和用户体验。虽然 <a href="https://www.kelen.cc/posts/html-fetch-priority#">浏览器</a>支持该属性，但是也要适当使用，不要滥用，过度使用反而会适得其反。</p>

        </div>
      </div>
    </div>
    <div class="body_bg"></div>
    <script defer src="../js/prism.min.js"></script>
    <script>
      const switchBtn = document.querySelector(".layout__main_left-switch");
      const left = document.querySelector(".layout__main_left");
      switchBtn.addEventListener("click", () => {
        left.classList.toggle("show");
      });
    </script>
  </body>
</html>
