<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"
      name="viewport"
    />
    <title>如何在 Nginx 中阻止特定国家的 IP 地址访问</title>
    <link rel="shortcut icon" href="../code.svg" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/prism2.css" />
    <link rel="stylesheet" href="../css/edit2.css" />
  </head>
  <body>
    <main>
      <header>
        <h1>如何在 Nginx 中阻止特定国家的 IP 地址访问</h1>
        <p class="time">HaoTian · 2024-10-03 21:49:11</p>
      </header>
      <p><strong>一、为什么要阻止特定国家的 IP 访问？</strong></p>
<p>在实际应用中，可能会有以下几种情况需要阻止特定国家的 IP 访问：</p>
<ol>
<li>安全考虑：防止来自某些高风险国家的恶意攻击。</li>
<li>版权保护：限制特定地区的用户访问受版权保护的内容。</li>
<li>合规要求：满足某些法律法规或业务规定。</li>
</ol>
<p><strong>二、如何在 Nginx 中阻止特定国家的 IP 地址访问？</strong></p>
<p><strong>第 1 步：安装 GeoIP 模块</strong></p>
<p>Nginx 需要借助 GeoIP 模块来识别客户端的地理位置信息。如果你使用的是 Nginx 主分支，可以通过以下命令安装该模块：</p>
<pre><code class="language-sh">sudo apt-get install nginx-module-geoip # 对于基于Debian的系统
sudo yum install nginx-mod-http-geoip # 对于RPM-based系统
</code></pre>
<p><strong>第 2 步：下载 GeoIP 数据库</strong></p>
<p>GeoIP 模块需要数据库文件来映射 IP 地址到国家。你可以从 MaxMind 的官方网站 (<code>https://dev.maxmind.com/geoip/geoip2/geolite2/</code>) 免费下载 GeoIP.dat 和 GeoLiteCity.dat 两个文件</p>
<p>下载后，将文件放置到 Nginx 配置文件指定的路径，如`/etc/nginx/geoip/</p>
<p><strong>第 3 步：配置 Nginx</strong>在/etc/nginx/conf.d/下，编写 geoip.conf 文件如下：</p>
<pre><code class="language-nginx">map $geoip_country_code $allowed_country {
    default yes;
    US no; # 禁止从美国的访问，这里只是示例，可以根据需要修改国家代码
}

server {
    listen 80;
    server_name example.com;

    if ($allowed_country = no) {
        return 403;
    }

    # 其他配置...
}
</code></pre>
<p>在上述配置中，我们使用了<code>geoip_country</code>指令指定了 GeoIP 数据库的路径。然后，通过<code>map</code>指令创建了一个变量<code>$allowed_country</code>，根据国家代码判断是否允许访问。如果<code>$allowed_country</code>的值为<code>no</code>，则返回 403 禁止访问。</p>
<p><strong>第 4 步：测试并重启 Nginx</strong></p>
<p>配置完成后，使用<code>nginx -t</code>命令测试配置是否正确，然后使用<code>systemctl restart nginx</code>或<code>service nginx restart</code>命令重启 Nginx 使更改生效。</p>

    </main>
    <aside id="nav">
      <ul>
        <li class=""><a title="Nginx 常用的基础配置-前端相关方面" href="/md/Nginx 常用的基础配置-前端相关方面.html">08 Nginx 常用的基础配置-前端相关方面</a></li><li class=""><a title="nginx 轻松实现从 HTTP 到 HTTPS 的重定向" href="/md/nginx 轻松实现从 HTTP 到 HTTPS 的重定向.html">07 nginx 轻松实现从 HTTP 到 HTTPS 的重定向</a></li><li class="active"><a title="如何在 Nginx 中阻止特定国家的 IP 地址访问" href="/md/如何在 Nginx 中阻止特定国家的 IP 地址访问.html">06 如何在 Nginx 中阻止特定国家的 IP 地址访问</a></li><li class=""><a title="Nginx 跨域配置" href="/md/Nginx 跨域配置.html">05 Nginx 跨域配置</a></li><li class=""><a title="Nginx 日志" href="/md/Nginx 日志.html">04 Nginx 日志</a></li><li class=""><a title="Nginx 如何防止 DDoS 攻击" href="/md/Nginx 如何防止 DDoS 攻击.html">03 Nginx 如何防止 DDoS 攻击</a></li><li class=""><a title="Nginx 反向代理" href="/md/Nginx 反向代理.html">02 Nginx 反向代理</a></li><li class=""><a title="高级前端应该掌握的 Nginx 相关知识" href="/md/高级前端应该掌握的 Nginx 相关知识.html">01 高级前端应该掌握的 Nginx 相关知识</a></li>
      </ul>
      <div class="switch">
        <svg
          t="1730889498743"
          class="icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="7580"
          width="25"
          height="25"
        >
          <path
            d="M755.114667 332.074667L694.144 392.96l181.034667 181.034667 60.928-60.970667z"
            fill="#ffffff"
            p-id="7581"
          ></path>
          <path
            d="M755.2 694.229333l-60.928-60.928 181.034667-181.034666 60.928 60.970666z"
            fill="#ffffff"
            p-id="7582"
          ></path>
          <path
            d="M554.666667 469.333333h298.666666v85.333334h-298.666666zM268.885333 332.202667l60.970667 60.928-181.034667 181.034666-60.928-60.970666z"
            fill="#ffffff"
            p-id="7583"
          ></path>
          <path
            d="M268.757333 694.357333l60.928-60.970666-180.992-180.992-60.970666 60.928z"
            fill="#ffffff"
            p-id="7584"
          ></path>
          <path
            d="M469.333333 469.461333H170.666667v85.333334h298.666666z"
            fill="#ffffff"
            p-id="7585"
          ></path>
        </svg>
      </div>
    </aside>
    <script defer src="../js/prism.min.js"></script>
    <script defer src="../js/edit2.js"></script>
  </body>
</html>
