<!DOCTYPE html>
<html lang="en" class="">
  <head>
    <meta charset="UTF-8" />
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"
      name="viewport"
    />
    <title>维护</title>
    <link rel="shortcut icon" href="../code.svg" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=fallback"
      rel="stylesheet"
    />
    <link id="prismTheme" rel="stylesheet" href="../css/prism.css" />
    <link rel="stylesheet" href="../css/edit.css" />
    
    <style>
      /* Animation Styles */
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .slide-in {
        animation: slideIn 0.5s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .button {
        transition: background-color 0.3s, transform 0.3s;
      }

      .button:hover {
        background-color: #3700b3;
        transform: scale(1.05);
      }

      /* Tooltip Styles */
      .tooltip {
        position: relative;
        display: inline-block;
      }

      .tooltip .tooltiptext {
        visibility: hidden;
        width: 120px;
        background-color: black;
        color: #fff;
        text-align: center;
        border-radius: 5px;
        padding: 5px 0;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -60px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }
    </style>
  </head>

  <body class="fade-in">
    <button
      class="toggle-sidebar"
      id="toggleSidebar"
      aria-label="Toggle Sidebar"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>

    <div class="app-container">
      <!-- Sidebar Navigation -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <button class="toggle-sidebar" id="toggleSidebar">
            <span></span>
          </button>
        </div>
        <div class="sidebar-content">
          <div class="nav-section"><li class="active"><a title="维护" href="/md/维护.html">04 维护</a></li><li class=""><a title="开源" href="/md/开源.html">03 开源</a></li><li class=""><a title="测试" href="/md/测试.html">02 测试</a></li><li class=""><a title="构建" href="/md/构建.html">01 构建</a></li></div>
        </div>
      </nav>

      <!-- Main Content Area -->
      <main class="main-content">
        <header class="content-header">
          <div class="header-left">
            <h1 class="page-title">维护</h1>
            <p class="time">HaoTian · 2025-02-01 20:54:52</p>
          </div>
          <div class="header-right">
            <div class="tag-container">
              <span class="tag">现代 JavaScript 库开发</span>
            </div>
            <button
              id="themeToggle"
              class="theme-toggle"
              aria-label="Toggle theme"
            >
              <svg
                class="sun-icon"
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              <svg
                class="moon-icon"
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                ></path>
              </svg>
            </button>
            <button
              class="theme-toggle"
              aria-label="Toggle theme"
              style="width: 36px; height: 36px"
              onclick="window.location.href='/md';"
            >
              <svg
                t="1737442501710"
                class="icon"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="5258"
                width="20"
                height="20"
              >
                <path
                  d="M883.773793 626.047476c-17.308201 0-31.408337 14.029528-31.408337 31.304983l0 207.437469c0 17.204847-14.098089 31.302937-31.406291 31.302937L203.040834 896.092865c-17.340947 0-31.408337-14.098089-31.408337-31.302937L171.632497 657.352459c0-17.275455-14.099113-31.304983-31.408337-31.304983-17.380856 0-31.444153 14.029528-31.444153 31.304983l0 207.437469c0 51.773154 42.261523 93.91188 94.260827 93.91188l617.918331 0c52.031027 0 94.259804-42.139749 94.259804-93.91188L915.21897 657.352459C915.21897 640.077004 901.152603 626.047476 883.773793 626.047476L883.773793 626.047476zM230.262826 614.286618c55.523571 0 104.556311-27.674293 134.394896-69.762877 32.487925 46.451962 86.303598 77.0744 147.343813 77.0744 61.036122 0 114.846678-30.623461 147.306974-77.0744 29.943986 42.018999 78.902024 69.762877 134.426619 69.762877 90.948385 0 164.968216-73.77526 164.968216-164.371628 0-11.062963-2.342348-22.859637-5.130857-35.178197-0.209778-1.134847 0.031722-2.26867-0.277316-3.38612l-0.629333-2.267647c-0.24764-0.924045-0.140193-1.535983-0.352017-2.547009-0.138146-0.505513-0.521886-0.87288-0.695848-1.39579l-85.364203-316.671313c-3.699252-13.645788-16.051581-23.172769-30.293957-23.172769L187.965487 65.296145c-14.238282 0-26.665313 9.526981-30.360472 23.24133L72.309374 405.1566c-0.103354 0.50756-0.48607 0.820692-0.62524 1.309832-0.210801 0.942465-0.107447 1.639337-0.349971 2.511193l-0.62524 2.373047c-0.318248 1.11745 0 2.25025-0.210801 3.38612-2.863211 12.31856-5.201465 24.115234-5.201465 35.178197C65.295634 540.511357 139.315464 614.286618 230.262826 614.286618L230.262826 614.286618z"
                  fill="currentColor"
                  p-id="5259"
                ></path>
              </svg>
            </button>
          </div>
        </header>

        <!-- Article Content -->
        <article
          class="content-body md md "
        >
          <p>库的开源不是一劳永逸的事情，需要持续迭代和持续维护。</p>
<h2>社区协作</h2>
<p>一个流行的开源库会有众多使用者，同时会有社区参与贡献和维护。</p>
<h3>社区反馈</h3>
<p>社区用户可以通过 GitHub 的 Issue 反馈信息，库的开发者需要对 Issue 进行回复，并于 Issue 进行管理。</p>
<p>GitHub 提供了对 Issue 分类的功能，在 Issue 详情页可以为 Issue 添加 Label。</p>
<img src="../imgs/140/12.png" />

<p>Issue 可以分为 3 类，分别是求助类、故障类、建议类。分类和 GitHub Label 的对应关系如下：</p>
<ul>
<li><p>求助类：help wanted</p>
</li>
<li><p>故障类：bug</p>
</li>
<li><p>建议类：enhancement</p>
</li>
</ul>
<p>为了更好的解答 Issue 反馈的问题，就需要了解一些用户的环境信息，从而能够快速复现问题。</p>
<p>社区用户在提问时由于习惯各异，大概率不会提供完整的信息，为了避免反复沟通，可以规范 Issue 的录入内容。</p>
<p><strong>通过 Issue 模板可以实现这个诉求。</strong></p>
<p>只需要在项目的根目录下添加 <code>.github/ISSUE_TEMPLATE.md</code> 文件即可。</p>
<img src="../imgs/140/13.png" />

<p>在新建 Issue 时，GitHub 会默认展示 ISSUE_TEMPLATE.md 模板中的内容，如下，如果没有此文件，则默认填充为空。</p>
<img src="../imgs/140/14.png" />

<p>一般对于求助类 Issue，Issue 系统自身就可以完成整个过程的流转，而对于故障类 Issue，则还需要修复 Bug，提交代码，发布新版本。</p>
<p><strong>那么如何将代码提交信息和 Issue 关联起来呢？</strong></p>
<p>其实每个 Issue 都有一个 ID，其位于 Issue 标签的旁边，如下图中显示 Issue ID 是 <code>#3</code>。</p>
<img src="../imgs/140/15.png" />

<p>在提交信息中添加 Issue ID，即可让提交信息和 Issue 产生联系，GitHub 会在 Issue 下面自动显示和当前 Issue 关联的提交信息。</p>
<p>下面的命令会创建一个关联 Issue ID 为 <code>#3</code> 的提交信息：</p>
<pre><code class="language-sh">git commit -m &quot;测试修改代码 #3&quot;
</code></pre>
<p>再次查看 GitHub Issue 页面，结果如图，可以看到提交信息自动关联了过来。</p>
<img src="../imgs/140/16.png" />

<p>Issue 问题解决后，可以单击 <code>Close Issue</code> 按钮关闭 Issue。除了手动关闭，还可以在提交信息中添加 fix、fixed、close、closed 等关键字自动关闭 Issue。<strong>关键字不区分大小写</strong></p>
<pre><code class="language-sh">git commit -m &quot;测试修改代码 fixed #3&quot;
</code></pre>
<p>通过提交信息关闭的 Issue 在 GitHub 上会有特殊的关联显示，</p>
<img src="../imgs/140/17.png" />

<p>Pull request 是一种特殊的社区反馈，反馈内容是源码。对于建议类和故障类 Issue，可以由社区来贡献代码；因为 Pull request 的 ID 和 Issue 是打通的，所以可以相互关联，关联的方式很简单，只需要在评论框中输入 “#” 符号即可。</p>
<img src="../imgs/140/18.png" />

<p>对于建议类的问题，使用 Issue 并不是最合适的方式。大一点的开源你项目一般会有自己的社区。</p>
<p>为了方便用户交流互动，需要一个讨论区，Issue 不应该承担此功能。</p>
<p><strong>现在可以使用 GitHub 的 Discussions，由于 Discussions 尚未完全成熟，因此新建项目的 Discussions 默认是关闭的，需要在 &quot;Settings&quot; 面板中打开</strong></p>
<img src="../imgs/140/19.png" />

<p>下面为 create-react-app 项目的 Discussions 截图，左侧可以有分类，右侧是主题列表。</p>
<img src="../imgs/140/20.png" />

<p>Issue 和 Discussions 的功能不同，因此需要注意二者之间的区别，并合理使用。</p>
<p>Issue 用来反馈求助、问题等，Discussions 用来进行社区讨论，包括计划、草案、希望的新特性等。</p>
<h3>社区协作</h3>
<p>开源可以给社区中的使用者带来方便，同时社区中库的使用者也会给开发者带来反哺。</p>
<p><strong>在 GitHub 上多人共建一个开源库有 3 种方式：</strong></p>
<p>Git 被设计为去中心化的分布式版本管理系统，其可以有多个远端（Remote），这个特性非常适合社区共建。社区贡献者可以克隆仓库，修改代码，将其推送到自己的远端，然后通知库的开发者合并自己的修改，最早是通过邮件等方式通知库的开发者。</p>
<p>在 GitHub 上，上述这一套流程叫作 <code>Fork + Pull request</code>。社区贡献者可以 Fork 一个库，Fork 其实就是拷贝一份源码到自己的仓库，修改代码后，可以创建一个 Pull request，库的开发者在收到 Pull request 后，可以进行代码审查、评论等操作，没有问题后可以合并代码，<strong>上面的步骤完成了一次社区协作的流程</strong></p>
<p><code>Fork + Pull request</code> 默认适合社区贡献者，人人都可以贡献，由库的开发者决定是否合并社区贡献者提供的修改。这种模式可以协调陌生人一起工作，却没有安全问题。</p>
<p>如果库的贡献者是可以信赖的，那么 Fork 模式就显得效率有些低下了，此时让多个贡献者都可以直接操作同一个项目是更好的选择。GitHub 支持给库设置开发者，首先选择 “Settings” 面板，然后选择 “Collaborators” 标签，可以给库添加共同开发者，</p>
<img src="../imgs/140/21.png" />

<p>多人都对同一个项目有开发权限，这种模式被称为开发者模式，这种模式比较适合单个项目，并且有少量核心开发者的情况。</p>
<p>如果有多个项目都需要协作开发，或者有很多人一起开发，希望对权限有更细粒度的控制，那么库开发者模式就捉襟见肘了。此时可以使用由 GitHub 提供的 Organization（组织）功能创建一个 Organization，并将一组功能相关的库都放到一个 Organization 下，Organization 对开发者权限的管理也很好用，可以控制不同开发者拥有不同的权限。很多前端项目都是使用 Organization 来管理的。</p>
<h2>规范先行</h2>
<p>在一个多人相同的项目里，统一的规范对保证开发效率和代码质量至关重要。</p>
<h3>编辑器</h3>
<p>不同的编辑器有不同的默认行为，同一款编辑器在不同的操作系统上也会有不用的表现，不同的开发者也会有自己的个人喜好。</p>
<p>这些差异给社区协作带来了很大麻烦，为了解决编辑器之间的差异问题，推荐使用 EditorConfig。EditorConfig 可以在不同平台的不同编辑器之间维护一致的公共配置。使用 EditorConfig 需要在项目中提供 <code>.editorconfig</code> 文件，在根目录和子目录下可以同时存在 <code>.editorconfig</code> 文件，子目录优先级更高，而位于根目录中的 <code>.editorconfig</code> 文件则需要将 root 配置设置为 true。</p>
<pre><code class="language-sh"># 根目录的配置
root = true

# Unix-style newlines with a newline ending every file
[*]
end_of_line = lf
insert_final_newline = true

# set default charset
[*.{js}]
charset = utf-8
</code></pre>
<p>EditorConfig 支持的配置项和建议：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th align="center">说明</th>
<th align="right">建议</th>
</tr>
</thead>
<tbody><tr>
<td>charset</td>
<td align="center">指定字符集</td>
<td align="right">建议配置</td>
</tr>
<tr>
<td>end_of_line</td>
<td align="center">指定换行符，可选 lf、cr、crlf</td>
<td align="right">建议配置</td>
</tr>
<tr>
<td>indent_style</td>
<td align="center">缩进风格设置为空格，可选 space、tab</td>
<td align="right">建议配置</td>
</tr>
<tr>
<td>indent_size</td>
<td align="center">缩进的空格数量设置为 2 个</td>
<td align="right">建议配置</td>
</tr>
<tr>
<td>trim_trailing_whitespace</td>
<td align="center">去除行尾空格</td>
<td align="right">可选配置</td>
</tr>
<tr>
<td>insert_final_newline</td>
<td align="center">文件结尾插入新行</td>
<td align="right">可选配置</td>
</tr>
</tbody></table>
<p>下面给我们的库添加 EditorConfig 支持，首先在项目根目录下添加 <code>.editorconfig</code> 文件，需要配置一下文件：</p>
<ul>
<li><p><code>.html</code> 文件</p>
</li>
<li><p><code>.js</code> 文件</p>
</li>
<li><p><code>.json</code> 文件</p>
</li>
<li><p><code>.yml</code> 文件：YAML 是专门用来写配置文件的语言，比 JSON 格式方便</p>
</li>
<li><p><code>.md</code> 文件</p>
</li>
</ul>
<p><code>.editorconfig</code> 文件具体的配置如下：</p>
<pre><code class="language-sh"># 根目录的配置
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true

[*.{html}]
indent_style = space
indent_size = 2

[*.{js}]
indent_style = space
indent_size = 2

[*.{yml}]
indent_style = space
indent_size = 2

[*.{md}]
indent_style = space
indent_size = 2
</code></pre>
<p>有些编辑器默认支持 EditorConfig，如 Webstorm；而有些编辑器则需要安装插件后才能支持，如 VS Code 和 Submit Text 等。</p>
<p>EditorConfig 官网有支持的编辑器空列表。以 VS Code 为例，需要安装 <code>EditorConfig for VS Code</code> 插件，</p>
<img src="../imgs/140/23.png" />

<p>安装好插件后，再次打开编辑器，就可以看到 EditorConfig 的配置生效了。</p>
<h3>格式化</h3>
<p>EditorConfig 只解决了少数基本风格问题，而对于一段代码来说，代码风格包括更多内容，如 大括号位置、逗号后面的空格等。</p>
<p>试想一下，如果协作开发的两个人使用的代码风格不一样，那么在合并代码时就会带来很多麻烦，虽然在使用 <code>git diff</code> 对比代码时可以忽略空白元素，能够解决空格不统一的问题，但是上面例子中的情况无法解决。</p>
<p>但是当大家协作时，统一的代码风格是非常必要的，可以用工具来统一代码风格，推荐 <code>Prettier</code> 工具。</p>
<p>安装：</p>
<pre><code class="language-sh">npm install --save-dev --save-exact prettier
</code></pre>
<p>然后执行下面的命令，即可格式化当前目录下的代码：</p>
<pre><code class="language-sh">npm prettier --write .
</code></pre>
<p>如果直接执行上面的命令，则会将全部文件格式化，而有些文件可能并不希望被格式化，如构建的临时文件等，此时可以在项目的根目录添加一个 <code>.prettierignore</code> 文件：</p>
<pre><code class="language-sh"># .prettierignore
dist
coverage
.nyc_output
package-lock.json
</code></pre>
<p>尽管 Prettier 是开箱即用的，也不鼓励自定义样式，但还是提供了少量的配置项可以更改，常见的配置如表：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th align="center">描述</th>
<th align="right">默认值</th>
</tr>
</thead>
<tbody><tr>
<td>tabWidth</td>
<td align="center">缩进的宽度</td>
<td align="right">默认为 2</td>
</tr>
<tr>
<td>useTabs</td>
<td align="center">缩进使用 Tab 键</td>
<td align="right">默认为空格</td>
</tr>
<tr>
<td>singleQuote</td>
<td align="center">使用单引号</td>
<td align="right">默认使用双引号</td>
</tr>
<tr>
<td>bracketSpacing</td>
<td align="center">括号两侧插入空格</td>
<td align="right">默认插入</td>
</tr>
<tr>
<td>endOfLine</td>
<td align="center">换行符</td>
<td align="right">默认为 lf</td>
</tr>
<tr>
<td>trailingComma</td>
<td align="center">多行结构，尾部添加逗号</td>
<td align="right">es5</td>
</tr>
</tbody></table>
<p>这里介绍一下 trailingComma，先来介绍背景知识，在 ECMAScript 3 中，在数组的最后面添加逗号，并不会在末尾添加一个空元素，末尾逗号不会影响数组的值。下面两种写法是等价的：</p>
<pre><code class="language-js">[1, 2] // [1, 2]
[1, 2, ] // [1, 2]
</code></pre>
<p>Prettier 的配置项 trailingComma 有 3 个值，分别是 none、es5 和 all，默认值是 es5。建议使用默认值即可，如果有兼容性问题，则可以使用 none。</p>
<ul>
<li><p>none: 不添加尾后逗号</p>
</li>
<li><p>es5: 给多行数组和对象添加尾后逗号</p>
</li>
<li><p>all: 给多行数组、对象、函数添加尾后逗号</p>
</li>
</ul>
<p>需要注意的，Prettier 中的部分配置和 EditorConfig 中的部分配置时重叠的，所以要保证两款工具的配置时一致的，否则会相互影响，上面的配置基本使用默认值就可以了。</p>
<p>由于我们习惯使用单引号，下面来看一下如何设置自定义配置，在项目的根目录下添加 <code>.prettierrc.json</code> 文件，并在该文件中添加如下内容，再次执行 <code>npx prettier --write .</code> 命令，即可看到双引号变成单引号了。</p>
<pre><code class="language-json">{
  &quot;singleQuote&quot;: true
}
</code></pre>
<p>上面我们一直使用命令行完成格式化，除了在命令行中使用 Prettier，Prettier 也能和编辑器集成，</p>
<img src="../imgs/140/24.png" />

<p>将 Prettier 设置为默认格式化工具，</p>
<p>设置保存时即可自动格式化：</p>
<pre><code class="language-json">{
  &quot;editor.formatOnSave&quot;: true,
  &quot;editor.defaultFormat&quot;: &quot;esbenp.prettier-vscode&quot; // 设置默认格式化工具
}
</code></pre>
<p>虽然编辑器自动格式化可以提升编程体验，但是不能保证代码风格一致，存在编辑器可能不支持 prettier 的情况，如果用户未安装插件，或者用户使用的编辑器和设置的不一样等。除了可以和编辑器集成，Prettier 还可以和 Git 集成，在使用 Git 提交时，可以将提交文件自动格式化。</p>
<p>其原理是 Git 自身提供的 hook 功能，每次在提交之前，Git 都会检查是否存在 <code>pre-commit hook</code>，如果存在，则会自动执行其中的命令，在 <code>pre-commit hook</code> 中加入格式化的命令，就可以实现提交时自动格式化了。</p>
<p>其一：直接运行 <code>npm prettier --write .</code> 命令会将整个项目格式化，比较好的做法是只格式化本次提交的文件，<code>pretty-quick</code> 工具可以实现选择性格式化，其有很多参数，<code>--staged</code> 可以实现只格式化待提交的文件。</p>
<p>其二：需要添加 <code>pre-commit hook</code>，并加入格式化的代码，这可能需要对 hook 和命令行有一些了解，还要处理跨平台的问题，同时需要将写好的 hook 让每一名用户都安装。husky 是一个 npm 包，只需要简单安装，就可以给 JavaScript 项目带来使用 hook 的功能。</p>
<p><strong>首先安装 husky，husky 支持自动和手动两种安装方式。</strong></p>
<p>自动安装：</p>
<pre><code class="language-sh">npx husky-init
</code></pre>
<p>手动安装：</p>
<pre><code class="language-sh"># 1. 安装
npm install husky --save-dev

# 2. 初始化 husky 配置
npx husky install

# 3. 设置 prepare，这样就会自动执行 2
npm set-script prepare &quot;husky install&quot;
</code></pre>
<p>选择上面任意一种安装方式完成 husky 的安装后，会在 package.json 文件中添加如下代码：</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;prepare&quot;: &quot;husky install&quot;
  }
}
</code></pre>
<p>同时会多出一个 <code>.husky</code> 目录，其中的 pre-commit 就是我们要用到的 Git hook，husky 会将 Git 的 hooksPath 配置从 <code>.git/hook</code> 修改为 <code>.husky</code>。如果有其他流程也依赖 Git hook，则可能需要注意 hook 的路径变化问题，通过运行 <code>cat .git/config</code> 命令可以看到 hooksPath 的配置，如下：</p>
<pre><code class="language-sh">$ cat .git/config

[core]
  hooksPath = .husky
</code></pre>
<p>接下来安装 pretty-quick，</p>
<pre><code class="language-sh">npm install --save-dev pretty-quick
</code></pre>
<p>通过如下命令将 pretty-quick 添加到 hook 中：</p>
<pre><code class="language-sh">npx husky set .husky/pre-commit &quot;npx pretty-quick --staged&quot;
</code></pre>
<p>此时打开 <code>.husky/pre-commit</code> 文件，该文件中的内容如下，也可以不使用 <code>husky set</code> 命令，直接修改这个文件。</p>
<pre><code class="language-sh">#!/bin/sh
. &quot;$(dirname &quot;$0&quot;)/_/husky.sh&quot;

npx pretty-quick --staged
</code></pre>
<p>接下来，试着修改代码，提交代码，即可体验提交时自动格式化的效果。</p>
<h3>代码 Lint</h3>
<p>ESLint 是社区中流行的代码校验工具，其通过插件的方式提供了对 JavaScript 代码最佳的校验功能。</p>
<p>安装 ESLint</p>
<pre><code class="language-sh">npm install eslint --save-dev
</code></pre>
<p>安装好后，使用如下命令初始化，执行后通过询问的方式完成初始化，参考如下的配置选项即可。</p>
<p>[89]</p>

        </article>
      </main>

      <!-- Table of Contents Sidebar -->
      <aside class="toc-sidebar">
        <div class="toc-header">
          <h3>Table of Contents</h3>
        </div>
        <div class="toc-content" id="tocContent">
          <!-- TOC will be generated dynamically -->
        </div>
      </aside>
    </div>

    <div class="body_bg"></div>
    <div class="zoom-overlay"></div>

    <button id="backToTop" class="back-to-top" aria-label="Back to top">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M12 19V5M5 12l7-7 7 7" />
      </svg>
    </button>

    <style>
      .zoom-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        z-index: 1000;
        cursor: zoom-out;
      }
      .zoomed-image {
        position: fixed;
        z-index: 1001;
        will-change: transform;
        cursor: zoom-out;
        max-width: 90vw;
        max-height: 90vh;
        object-fit: contain;
      }
      .back-button {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 50px;
        height: 50px;
        border-radius: 100%;
        background-color: #07a;
        border: none;
        color: #333;
        text-decoration: none;
        font-size: 14px;
        margin-bottom: 16px;
        cursor: pointer;
        transition: background-color 0.2s;
        position: fixed !important;
        top: 30px;
        right: 30px;
        z-index: 10;
        display: none;
      }
      .back-button svg {
        width: 50%;
        height: 50%;
      }
      .back-button:hover {
        opacity: 0.8;
      }
      .layout {
        position: relative;
        z-index: 1;
      }
      .back-to-top {
        position: fixed;
        bottom: 2rem;
        right: 340px;
        background: linear-gradient(
          135deg,
          var(--accent),
          rgba(59, 130, 246, 0.8)
        );
        color: white;
        border: none;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      }

      .back-to-top svg {
        width: 1.5rem;
        height: 1.5rem;
        stroke: currentColor;
        transition: transform 0.3s ease;
      }

      .back-to-top:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.3);
        background: linear-gradient(135deg, var(--accent), #2563eb);
      }

      .back-to-top:hover svg {
        transform: translateY(-2px);
      }

      .dark .back-to-top {
        background: linear-gradient(135deg, #4b5563, #1f2937);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .dark .back-to-top:hover {
        background: linear-gradient(135deg, #4b5563, #111827);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }
      @media screen and (max-width: 768px) {
        .back-to-top {
          right: 15px;
          bottom: 15px;
          width: 36px;
          height: 36px;
        }
      }

      @media screen and (max-width: 480px) {
        .back-to-top {
          right: 12px;
          bottom: 12px;
          width: 32px;
          height: 32px;
        }
      }
    </style>
    <script defer src="../js/prism.min.js"></script>
    <script>
      // Sidebar Toggle
      const toggleBtn = document.getElementById("toggleSidebar");
      const sidebar = document.querySelector(".sidebar");
      const mainContent = document.querySelector(".main-content");

      function toggleSidebar() {
        sidebar.classList.toggle("hidden");
        // Store sidebar state in localStorage
        localStorage.setItem(
          "sidebarHidden",
          sidebar.classList.contains("hidden")
        );
      }

      toggleBtn.addEventListener("click", toggleSidebar);

      // Keyboard shortcut (Ctrl + B)
      window.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.key === "b") {
          e.preventDefault(); // Prevent browser's default behavior
          toggleSidebar();
        }
      });

      // Restore sidebar state from localStorage
      document.addEventListener("DOMContentLoaded", () => {
        const sidebarHidden = localStorage.getItem("sidebarHidden") === "true";
        if (sidebarHidden) {
          sidebar.classList.add("hidden");
        }
      });

      // Generate Table of Contents
      function generateTOC() {
        const article = document.querySelector(".content-body");
        const headings = article.querySelectorAll("h1, h2, h3, h4");
        const tocContent = document.getElementById("tocContent");
        const toc = document.createElement("ul");

        headings.forEach((heading, index) => {
          const id = `heading-${index}`;
          heading.id = id;

          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = `#${id}`;
          a.textContent = heading.textContent;
          a.className = `toc-level-${heading.tagName.toLowerCase()}`;

          li.appendChild(a);
          toc.appendChild(li);
        });

        tocContent.appendChild(toc);
      }

      // Initialize TOC
      document.addEventListener("DOMContentLoaded", generateTOC);

      // Image zoom with FLIP animation
      const overlay = document.querySelector(".zoom-overlay");
      let activeImage = null;

      document.querySelectorAll("img").forEach((img) => {
        if (img.closest("a")) return; // Skip images that are inside links
        img.style.cursor = "zoom-in";
        img.addEventListener("click", handleImageClick);
      });

      function handleImageClick(event) {
        const img = event.target;

        if (activeImage) {
          // If an image is already zoomed, unzoom it
          unzoomImage();
          return;
        }

        // Get the initial position and size
        const rect = img.getBoundingClientRect();
        const first = {
          x: rect.left,
          y: rect.top,
          width: rect.width,
          height: rect.height,
        };

        // Create a clone of the image
        const clone = img.cloneNode();
        clone.classList.add("zoomed-image");
        document.body.appendChild(clone);

        // Position the clone exactly over the original
        clone.style.position = "fixed";
        clone.style.left = `${first.x}px`;
        clone.style.top = `${first.y}px`;
        clone.style.width = `${first.width}px`;
        clone.style.height = `${first.height}px`;
        clone.style.margin = "0";
        clone.style.transformOrigin = "top left";

        // Show the overlay
        overlay.style.display = "block";

        // Calculate the final position and scale
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        const targetWidth = Math.min(img.naturalWidth, viewportWidth * 0.9);
        const targetHeight = Math.min(img.naturalHeight, viewportHeight * 0.9);
        const scaleX = targetWidth / first.width;
        const scaleY = targetHeight / first.height;
        const scale = Math.min(scaleX, scaleY);

        const last = {
          width: first.width * scale,
          height: first.height * scale,
        };
        last.x = (viewportWidth - last.width) / 2;
        last.y = (viewportHeight - last.height) / 2;

        // Calculate and apply the transform
        const dx = last.x - first.x;
        const dy = last.y - first.y;

        requestAnimationFrame(() => {
          clone.style.transform = `translate(${dx}px, ${dy}px) scale(${scale})`;
          clone.style.transition = "transform 0.3s ease-out";
        });

        activeImage = { original: img, clone: clone };

        // Add click handlers for closing
        clone.addEventListener("click", unzoomImage);
        overlay.addEventListener("click", unzoomImage);
      }

      function unzoomImage() {
        if (!activeImage) return;

        const { original, clone } = activeImage;
        const rect = original.getBoundingClientRect();

        // Animate back to the original position
        clone.style.transform = `translate(0, 0) scale(1)`;

        // Clean up after the animation
        clone.addEventListener(
          "transitionend",
          () => {
            clone.remove();
            overlay.style.display = "none";
          },
          { once: true }
        );

        activeImage = null;
      }

      // 监听 ctrl + b
      window.addEventListener("keydown", (e) => {
        const leftDom = document.querySelector(".sidebar");
        if (e.ctrlKey && e.key === "b") {
          leftDom.classList.toggle("hidden");
        }
      });

      // Modal
      // const modal = document.getElementById("myModal");
      // const modalContent = modal.querySelector(".modal-content");
      // const openModal = document.getElementById("openModal");
      // const close = modal.querySelector(".close");

      // openModal.addEventListener("click", () => {
      //     modal.style.display = "block";
      // });

      // close.addEventListener("click", () => {
      //     modal.style.display = "none";
      // });

      // window.addEventListener("click", (e) => {
      //     if (e.target === modal) {
      //         modal.style.display = "none";
      //     }
      // });

      // Back to top button
      const backToTop = document.getElementById("backToTop");
      window.addEventListener("scroll", () => {
        if (window.scrollY > 200) {
          backToTop.style.display = "block";
        } else {
          backToTop.style.display = "none";
        }
      });

      backToTop.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      // Theme toggle
      document.addEventListener("DOMContentLoaded", () => {
        const themeToggle = document.getElementById("themeToggle");
        const html = document.documentElement;
        const prismTheme = document.getElementById("prismTheme");

        // Function to update theme and stylesheet
        function updateTheme(theme) {
          html.className = theme;
          prismTheme.href = `../css/prism${theme === "dark" ? "2" : ""}.css`;
          localStorage.setItem("theme", theme);
        }

        // Check for saved theme preference
        const savedTheme = localStorage.getItem("theme") || "light";
        updateTheme(savedTheme);

        themeToggle.addEventListener("click", () => {
          const currentTheme = html.className;
          const newTheme = currentTheme === "light" ? "dark" : "light";
          updateTheme(newTheme);
        });
      });
    </script>
  </body>
</html>
