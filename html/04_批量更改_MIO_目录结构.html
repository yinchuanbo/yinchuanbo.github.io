<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>04 批量更改 MIO 目录结构</title>
    <link rel="shortcut icon" href="../code.svg" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.css"
    />
    <link rel="stylesheet" href="../css/edit-code.css" />
  </head>
  <body>
    <div class="layout">
      <div class="layout__main">
        <div class="layout__main_left html__left">
          <ul><li data-id="57" data-path="checkEjsSrc.js"><svg t="1725441988000" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5301" width="200" height="200"><path d="M64 1024h960V576H64z" fill="#F4AF3D" fill-opacity=".7" p-id="5302"></path><path d="M448 64L192 320h256z" fill="#9AA7B0" fill-opacity=".8" p-id="5303"></path><path d="M512 64v320H192v128h640V64z" fill="#9AA7B0" fill-opacity=".8" p-id="5304"></path><path d="M153.28 869.632c14.72 16 28.352 26.368 57.088 26.368 33.664 0 45.632-26.368 45.632-44.928V640h64v229.632C320 916.48 276.928 960 220.8 960c-52.544 0-83.2-15.168-105.6-43.52l38.08-46.848zM446.272 736.128c0-23.616 19.904-32.128 55.808-32.128H576v-64H503.04C433.792 640 384 669.44 384 732.8c0 55.36 26.88 79.36 94.144 93.824 49.28 10.56 65.6 20.032 65.6 40.448 0 20.48-22.912 28.928-65.6 28.928H403.2v64h74.944C608 960 608 896 608 867.072c0-40.448-30.72-72.128-85.824-89.664-55.168-17.536-75.904-17.728-75.904-41.28z" fill="#231F20" fill-opacity=".7" p-id="5305"></path></svg>checkEjsSrc.js</li><li data-id="58" data-path="fileMoveCss.js"><svg t="1725441988000" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5301" width="200" height="200"><path d="M64 1024h960V576H64z" fill="#F4AF3D" fill-opacity=".7" p-id="5302"></path><path d="M448 64L192 320h256z" fill="#9AA7B0" fill-opacity=".8" p-id="5303"></path><path d="M512 64v320H192v128h640V64z" fill="#9AA7B0" fill-opacity=".8" p-id="5304"></path><path d="M153.28 869.632c14.72 16 28.352 26.368 57.088 26.368 33.664 0 45.632-26.368 45.632-44.928V640h64v229.632C320 916.48 276.928 960 220.8 960c-52.544 0-83.2-15.168-105.6-43.52l38.08-46.848zM446.272 736.128c0-23.616 19.904-32.128 55.808-32.128H576v-64H503.04C433.792 640 384 669.44 384 732.8c0 55.36 26.88 79.36 94.144 93.824 49.28 10.56 65.6 20.032 65.6 40.448 0 20.48-22.912 28.928-65.6 28.928H403.2v64h74.944C608 960 608 896 608 867.072c0-40.448-30.72-72.128-85.824-89.664-55.168-17.536-75.904-17.728-75.904-41.28z" fill="#231F20" fill-opacity=".7" p-id="5305"></path></svg>fileMoveCss.js</li><li data-id="59" data-path="fileMoveJs.js"><svg t="1725441988000" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5301" width="200" height="200"><path d="M64 1024h960V576H64z" fill="#F4AF3D" fill-opacity=".7" p-id="5302"></path><path d="M448 64L192 320h256z" fill="#9AA7B0" fill-opacity=".8" p-id="5303"></path><path d="M512 64v320H192v128h640V64z" fill="#9AA7B0" fill-opacity=".8" p-id="5304"></path><path d="M153.28 869.632c14.72 16 28.352 26.368 57.088 26.368 33.664 0 45.632-26.368 45.632-44.928V640h64v229.632C320 916.48 276.928 960 220.8 960c-52.544 0-83.2-15.168-105.6-43.52l38.08-46.848zM446.272 736.128c0-23.616 19.904-32.128 55.808-32.128H576v-64H503.04C433.792 640 384 669.44 384 732.8c0 55.36 26.88 79.36 94.144 93.824 49.28 10.56 65.6 20.032 65.6 40.448 0 20.48-22.912 28.928-65.6 28.928H403.2v64h74.944C608 960 608 896 608 867.072c0-40.448-30.72-72.128-85.824-89.664-55.168-17.536-75.904-17.728-75.904-41.28z" fill="#231F20" fill-opacity=".7" p-id="5305"></path></svg>fileMoveJs.js</li><li data-id="60" data-path="start.js"><svg t="1725441988000" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5301" width="200" height="200"><path d="M64 1024h960V576H64z" fill="#F4AF3D" fill-opacity=".7" p-id="5302"></path><path d="M448 64L192 320h256z" fill="#9AA7B0" fill-opacity=".8" p-id="5303"></path><path d="M512 64v320H192v128h640V64z" fill="#9AA7B0" fill-opacity=".8" p-id="5304"></path><path d="M153.28 869.632c14.72 16 28.352 26.368 57.088 26.368 33.664 0 45.632-26.368 45.632-44.928V640h64v229.632C320 916.48 276.928 960 220.8 960c-52.544 0-83.2-15.168-105.6-43.52l38.08-46.848zM446.272 736.128c0-23.616 19.904-32.128 55.808-32.128H576v-64H503.04C433.792 640 384 669.44 384 732.8c0 55.36 26.88 79.36 94.144 93.824 49.28 10.56 65.6 20.032 65.6 40.448 0 20.48-22.912 28.928-65.6 28.928H403.2v64h74.944C608 960 608 896 608 867.072c0-40.448-30.72-72.128-85.824-89.664-55.168-17.536-75.904-17.728-75.904-41.28z" fill="#231F20" fill-opacity=".7" p-id="5305"></path></svg>start.js</li></ul>
          <div class="left__border"></div>
        </div>
        <div class="layout__main_right"></div>
        
          <div class="layout__main_nav">
            <a href="/articles/html/04 批量更改 MIO 目录结构 - download/download.zip"><svg t="1725527866228" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6724" width="25" height="25"><path d="M896 672c-17.066667 0-32 14.933333-32 32v128c0 6.4-4.266667 10.666667-10.666667 10.666667H170.666667c-6.4 0-10.666667-4.266667-10.666667-10.666667v-128c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v128c0 40.533333 34.133333 74.666667 74.666667 74.666667h682.666666c40.533333 0 74.666667-34.133333 74.666667-74.666667v-128c0-17.066667-14.933333-32-32-32z" fill="#fff" p-id="6725"></path><path d="M488.533333 727.466667c6.4 6.4 14.933333 8.533333 23.466667 8.533333s17.066667-2.133333 23.466667-8.533333l213.333333-213.333334c12.8-12.8 12.8-32 0-44.8-12.8-12.8-32-12.8-44.8 0l-157.866667 157.866667V170.666667c0-17.066667-14.933333-32-32-32s-34.133333 14.933333-34.133333 32v456.533333L322.133333 469.333333c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8l211.2 213.333334z" fill="#fff" p-id="6726"></path></svg></a>
          </div>
        
      </div>
    </div>
    <pre id="pre" style="display: none">{
  &#34;checkEjsSrc.js&#34;: &#34;const fs = require(\&#34;fs\&#34;);\r\nconst path = require(\&#34;path\&#34;);\r\nconst request = require(\&#34;sync-request\&#34;);\r\nconst cheerio = require(\&#34;cheerio\&#34;);\r\nconst ejs = require(\&#34;ejs\&#34;);\r\n\r\nconst langs = [\&#34;ar\&#34;, \&#34;de\&#34;, \&#34;en\&#34;, \&#34;es\&#34;, \&#34;fr\&#34;, \&#34;it\&#34;, \&#34;jp\&#34;, \&#34;kr\&#34;, \&#34;pt\&#34;, \&#34;tw\&#34;];\r\n\r\nlangs.forEach((lan) =&gt; {\r\n  const ejsDir = path.join(\&#34;.\&#34;, lan, \&#34;ejs\&#34;);\r\n  const cssDir = path.join(\&#34;.\&#34;, lan, \&#34;dist\&#34;, \&#34;css\&#34;);\r\n  const jsDir = path.join(\&#34;.\&#34;, lan, \&#34;dist\&#34;, \&#34;js\&#34;);\r\n  const imgDir = path.join(\&#34;.\&#34;, lan, \&#34;dist\&#34;, \&#34;img\&#34;);\r\n\r\n  const blogCheck = () =&gt; {\r\n    const urls = [\r\n      \&#34;https://www.miocreate.com/blog.html\&#34;,\r\n      \&#34;https://www.miocreate.com/blog/adult-chatbot-223.html\&#34;,\r\n      \&#34;https://www.miocreate.com/category/87.html\&#34;,\r\n    ];\r\n    function fetchResourcesSync(urls) {\r\n      const resourceSources = new Set();\r\n      for (const url of urls) {\r\n        try {\r\n          const res = request(\&#34;GET\&#34;, url);\r\n          const $ = cheerio.load(res.getBody());\r\n          $(\&#34;script\&#34;).each((i, element) =&gt; {\r\n            const src = $(element).attr(\&#34;src\&#34;);\r\n            if (src &amp;&amp; !src.includes(\&#34;https://\&#34;) &amp;&amp; !src.startsWith(\&#34;//\&#34;)) {\r\n              resourceSources.add(`./${lan}${src}`);\r\n            }\r\n          });\r\n          $(\&#34;link[rel=&#39;stylesheet&#39;]\&#34;).each((i, element) =&gt; {\r\n            const href = $(element).attr(\&#34;href\&#34;);\r\n            if (href &amp;&amp; !href.includes(\&#34;https://\&#34;) &amp;&amp; !href.startsWith(\&#34;//\&#34;)) {\r\n              resourceSources.add(`./${lan}${href}`);\r\n            }\r\n          });\r\n        } catch (error) {\r\n          console.error(`Error fetching ${url}:`, error.message);\r\n        }\r\n      }\r\n      return Array.from(resourceSources);\r\n    }\r\n    const resources = fetchResourcesSync(urls);\r\n    for (let i = 0; i &lt; resources.length; i++) {\r\n      const resourcePath = resources[i];\r\n      if (!fs.existsSync(resourcePath)) {\r\n        console.error(`在 blog.html 中找到不存在的资源引用: ${resourcePath}`);\r\n      }\r\n    }\r\n  };\r\n  blogCheck();\r\n\r\n  const read01 = fs.readdirSync(ejsDir);\r\n  if (read01?.length) {\r\n    for (let i = 0; i &lt; read01.length; i++) {\r\n      const file = read01[i];\r\n      if (path.extname(file).toLowerCase() === \&#34;.ejs\&#34;) {\r\n        const ejsFilePath = path.join(ejsDir, file);\r\n        checkResourceReferences(ejsFilePath, cssDir, jsDir, imgDir);\r\n      }\r\n    }\r\n  }\r\n  const read02 = fs.readdirSync(ejsDir);\r\n  if (read02?.length) {\r\n    for (let i = 0; i &lt; read02.length; i++) {\r\n      const file = read02[i];\r\n      if (path.extname(file).toLowerCase() === \&#34;.ejs\&#34;) {\r\n        const ejsFilePath = path.join(ejsDir, file);\r\n        checkResourceReferences(ejsFilePath, cssDir, jsDir, imgDir, true);\r\n        compressAndObfuscate(ejsFilePath);\r\n      }\r\n    }\r\n  }\r\n\r\n  // 编译 ejs\r\n  async function compressAndObfuscate(filePath) {\r\n    const pathArr = filePath.split(\&#34;\\\\\&#34;);\r\n    const filename = pathArr[pathArr.length - 1];\r\n    const name = filename.split(\&#34;.\&#34;);\r\n    try {\r\n      delete require.cache[require.resolve(`./${lan}/dist/lan/index.js`)];\r\n      let jsonData = require(`./${lan}/dist/lan/index.js`);\r\n      const templatePath = path.join(__dirname, filePath);\r\n      ejs.renderFile(\r\n        templatePath,\r\n        {\r\n          ...jsonData,\r\n          faceSSwap: JSON.stringify(jsonData.faceSwap),\r\n          allData: JSON.stringify(jsonData),\r\n          voice_Generator: JSON.stringify(jsonData.voiceGenerator),\r\n        },\r\n        (err, result) =&gt; {\r\n          if (err) {\r\n            console.log(err);\r\n            return;\r\n          }\r\n          const htmlPath = path.join(__dirname, `./${lan}/${name[0]}.html`);\r\n          fs.writeFileSync(htmlPath, result);\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error(`${filePath} 编译时出错：`, error);\r\n    }\r\n  }\r\n\r\n  function checkResourceReferences(\r\n    ejsFilePath,\r\n    cssDir,\r\n    jsDir,\r\n    imgDir,\r\n    isHas = false\r\n  ) {\r\n    const ejsContent = fs.readFileSync(ejsFilePath, \&#34;utf8\&#34;);\r\n    const ejsContentWithoutComments = removeCommentedBlocks(ejsContent);\r\n    const cssRegex = /href=\&#34;(.*?\\.css)\&#34;/g;\r\n    checkResourceExistence(\r\n      ejsFilePath,\r\n      cssRegex,\r\n      cssDir,\r\n      ejsContentWithoutComments,\r\n      isHas\r\n    );\r\n    const jsRegex = /src=\&#34;(.*?\\.js)\&#34;/g;\r\n    checkResourceExistence(\r\n      ejsFilePath,\r\n      jsRegex,\r\n      jsDir,\r\n      ejsContentWithoutComments,\r\n      isHas\r\n    );\r\n    const imgRegex = /src=\&#34;(.*?\\.(?:jpg|jpeg|png|gif|svg))\&#34;/g;\r\n    checkResourceExistence(\r\n      ejsFilePath,\r\n      imgRegex,\r\n      imgDir,\r\n      ejsContentWithoutComments,\r\n      isHas\r\n    );\r\n  }\r\n\r\n  function handleMatch(match, path) {\r\n    const resourcePath = match.split(&#39;\&#34;&#39;)[1];\r\n    let filep = resourcePath;\r\n    if (resourcePath.startsWith(\&#34;/dist/\&#34;)) {\r\n      filep = `./${lan}${resourcePath}`;\r\n    } else if (resourcePath.startsWith(\&#34;../dist/\&#34;)) {\r\n      filep = `./${lan}${resourcePath.replace(\&#34;../dist/\&#34;, \&#34;/dist/\&#34;)}`;\r\n    } else if (resourcePath.startsWith(\&#34;../../dist/\&#34;)) {\r\n      filep = `./${lan}${resourcePath.replace(\&#34;../../dist/\&#34;, \&#34;/dist/\&#34;)}`;\r\n    } else if (resourcePath.startsWith(\&#34;./img/\&#34;)) {\r\n      filep = `./${lan}${resourcePath.replace(\&#34;./img/\&#34;, \&#34;/dist/img/\&#34;)}`;\r\n    } else if (\r\n      resourcePath.startsWith(\&#34;https://\&#34;) ||\r\n      resourcePath.startsWith(\&#34;http://\&#34;) ||\r\n      resourcePath.startsWith(\&#34;//\&#34;)\r\n    ) {\r\n      filep = \&#34;\&#34;;\r\n    }\r\n    return filep;\r\n  }\r\n  function checkResourceExistence(\r\n    ejsFilePath,\r\n    regex,\r\n    resourceDir,\r\n    ejsContent,\r\n    isHas = false\r\n  ) {\r\n    let matches = ejsContent.match(regex);\r\n    if (matches) {\r\n      for (let i = 0; i &lt; matches.length; i++) {\r\n        const match = matches[i];\r\n        const filep = handleMatch(match, ejsFilePath);\r\n        if (filep &amp;&amp; !fs.existsSync(filep)) {\r\n          if (isHas) {\r\n            console.error(`在 ${ejsFilePath} 中找到不存在的资源引用: ${filep}`);\r\n          } else {\r\n            if (!filep.includes(\&#34;.min.\&#34;)) {\r\n              const fileNameWithExt = path.basename(filep);\r\n              editEjsScript(ejsFilePath, fileNameWithExt);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nfunction removeCommentedBlocks(content) {\r\n  let cleanedContent = content.replace(/\\/\\*[\\s\\S]*?\\*\\//g, \&#34;\&#34;);\r\n  cleanedContent = cleanedContent.replace(/&lt;!--[\\s\\S]*?--&gt;/g, \&#34;\&#34;);\r\n  return cleanedContent;\r\n}\r\n\r\nfunction editEjsScript(ejsPath = \&#34;\&#34;, filename = \&#34;\&#34;) {\r\n  if (!ejsPath || filename.includes(\&#34;.min.\&#34;)) return false;\r\n  const ejsFilePath = ejsPath;\r\n  const jsFileName = filename;\r\n  let fileContent = fs.readFileSync(ejsFilePath, \&#34;utf8\&#34;);\r\n  const escapedJsFileName = jsFileName.replace(\r\n    /[-\\/\\\\^$*+?.()|[\\]{}]/g,\r\n    \&#34;\\\\$&amp;\&#34;\r\n  );\r\n  const scriptRegex = new RegExp(\r\n    `(&lt;script\\\\s+[^&gt;]*src=[\&#34;&#39;].*?${escapedJsFileName}[\&#34;&#39;][^&gt;]*&gt;&lt;\\\\/script&gt;)`,\r\n    \&#34;g\&#34;\r\n  );\r\n  fileContent = fileContent.replace(scriptRegex, (match) =&gt; {\r\n    return match.replace(jsFileName, jsFileName.replace(\&#34;.js\&#34;, \&#34;.min.js\&#34;));\r\n  });\r\n  try {\r\n    fs.writeFileSync(ejsFilePath, fileContent, \&#34;utf8\&#34;);\r\n  } catch (error) {\r\n    console.error(`Error writing the modified EJS file: ${error.message}`);\r\n  }\r\n}\r\n&#34;,
  &#34;fileMoveCss.js&#34;: &#34;const fs = require(\&#34;fs\&#34;);\r\nconst request = require(\&#34;sync-request\&#34;);\r\nconst cheerio = require(\&#34;cheerio\&#34;);\r\nconst path = require(\&#34;path\&#34;);\r\nconst langs = [\&#34;ar\&#34;, \&#34;de\&#34;, \&#34;en\&#34;, \&#34;es\&#34;, \&#34;fr\&#34;, \&#34;it\&#34;, \&#34;jp\&#34;, \&#34;kr\&#34;, \&#34;pt\&#34;, \&#34;tw\&#34;];\r\n\r\nlet resources = [],\r\n  filenameSet = new Set();\r\n\r\nlangs.forEach((lan) =&gt; {\r\n  filenameSet = new Set();\r\n  const ejsDir = path.join(\&#34;.\&#34;, lan, \&#34;ejs\&#34;);\r\n  const cssDir = path.join(\&#34;.\&#34;, lan, \&#34;dist\&#34;, \&#34;css\&#34;);\r\n  const devSssDir = path.join(\&#34;.\&#34;, lan, \&#34;dev\&#34;, \&#34;scss\&#34;);\r\n  const jsDir = path.join(\&#34;.\&#34;, lan, \&#34;dist\&#34;, \&#34;js\&#34;);\r\n\r\n  if (!fs.existsSync(devSssDir)) {\r\n    fs.mkdirSync(devSssDir, { recursive: true });\r\n  }\r\n\r\n\r\n  const deleteMapFiles = (dirPath) =&gt; {\r\n    try {\r\n      const files = fs.readdirSync(dirPath);\r\n      files.forEach((file) =&gt; {\r\n        const filePath = path.join(dirPath, file);\r\n        if (path.extname(file) === \&#34;.map\&#34;) {\r\n          try {\r\n            fs.unlinkSync(filePath);\r\n            console.log(`Deleted: ${filePath}`);\r\n          } catch (err) {\r\n            console.error(`Error deleting ${filePath}:`, err);\r\n          }\r\n        }\r\n      });\r\n    } catch (err) {\r\n      console.error(\&#34;Error reading directory:\&#34;, err);\r\n    }\r\n  };\r\n\r\n  deleteMapFiles(cssDir);\r\n  deleteMapFiles(jsDir);\r\n\r\n  const blogCheck = () =&gt; {\r\n    const urls = [\r\n      \&#34;https://www.miocreate.com/blog.html\&#34;,\r\n      \&#34;https://www.miocreate.com/blog/adult-chatbot-223.html\&#34;,\r\n      \&#34;https://www.miocreate.com/category/87.html\&#34;,\r\n    ];\r\n    function fetchResourcesSync(urls) {\r\n      const resourceSources = new Set();\r\n      for (const url of urls) {\r\n        try {\r\n          const res = request(\&#34;GET\&#34;, url);\r\n          const $ = cheerio.load(res.getBody());\r\n          $(\&#34;link[rel=&#39;stylesheet&#39;]\&#34;).each((i, element) =&gt; {\r\n            const href = $(element).attr(\&#34;href\&#34;);\r\n            if (href &amp;&amp; !href.includes(\&#34;https://\&#34;) &amp;&amp; !href.startsWith(\&#34;//\&#34;)) {\r\n              resourceSources.add(href);\r\n            }\r\n          });\r\n        } catch (error) {\r\n          console.error(`Error fetching ${url}:`, error.message);\r\n        }\r\n      }\r\n      return Array.from(resourceSources);\r\n    }\r\n    resources = fetchResourcesSync(urls);\r\n    // for (let i = 0; i &lt; resources.length; i++) {\r\n    //   const resourcePath = resources[i];\r\n    //   if (!fs.existsSync(resourcePath)) {\r\n    //     console.error(`在 blog.html 中找到不存在的资源引用: ${resourcePath}`);\r\n    //   }\r\n    // }\r\n  };\r\n  blogCheck();\r\n  function getCssPathFromEjs() {\r\n    const cssFileRegex =\r\n      /&lt;link\\s+[^&gt;]*href=[\&#34;&#39;]([^\&#34;&#39;]+\\.css(?:\\?[^\&#34;&#39;]*)?)[\&#34;&#39;]/g;\r\n    function getEjsFiles(dir, files = []) {\r\n      const items = fs.readdirSync(dir);\r\n      items.forEach((item) =&gt; {\r\n        const fullPath = path.join(dir, item);\r\n        if (fs.statSync(fullPath).isDirectory()) {\r\n          getEjsFiles(fullPath, files);\r\n        } else if (item.endsWith(\&#34;.ejs\&#34;)) {\r\n          files.push(fullPath);\r\n        }\r\n      });\r\n      return files;\r\n    }\r\n    function extractCssPathsFromEjs(filePath) {\r\n      const content = fs.readFileSync(filePath, \&#34;utf-8\&#34;);\r\n      const cssPaths = [];\r\n      let match;\r\n      while ((match = cssFileRegex.exec(content)) !== null) {\r\n        cssPaths.push(match[1]);\r\n      }\r\n      return cssPaths;\r\n    }\r\n    function getAllUniqueCssPaths(ejsDir) {\r\n      const ejsFiles = getEjsFiles(ejsDir);\r\n      const cssPathSet = new Set();\r\n      ejsFiles.forEach((file) =&gt; {\r\n        const cssPaths = extractCssPathsFromEjs(file);\r\n        cssPaths.forEach((cssPath) =&gt; cssPathSet.add(cssPath.split(\&#34;?\&#34;)[0])); // 去重\r\n      });\r\n      return Array.from(cssPathSet); // 转换为数组\r\n    }\r\n    const uniqueCssPaths = getAllUniqueCssPaths(ejsDir);\r\n    const setData = [...new Set([...resources, ...uniqueCssPaths])];\r\n    setData.forEach((item) =&gt; {\r\n      const dir = path.basename(item);\r\n      if (!filenameSet.has(dir)) {\r\n        filenameSet.add(dir);\r\n      }\r\n    });\r\n  }\r\n  getCssPathFromEjs();\r\n  filenameSet = [...filenameSet];\r\n  filenameSet = filenameSet.filter((item) =&gt; !item.includes(\&#34;swiper.min.css\&#34;));\r\n  filenameSet = filenameSet.sort();\r\n  let filenameObj = {};\r\n  for (let i = 0; i &lt; filenameSet.length; i++) {\r\n    const element = filenameSet[i];\r\n    const name = element.split(\&#34;.\&#34;)[0];\r\n    const name01 = `${name}.min.css`;\r\n    const name02 = `${name}.scss`;\r\n    const name03 = `${name}.css`;\r\n    const path01 = path.join(cssDir, name01);\r\n    const path02 = path.join(cssDir, name02);\r\n    const path03 = path.join(cssDir, name03);\r\n    const fileArr = [];\r\n    if (fs.existsSync(path01)) {\r\n      fileArr.push(name01);\r\n    }\r\n    if (fs.existsSync(path02)) {\r\n      fileArr.push(name02);\r\n    }\r\n    if (fs.existsSync(path03)) {\r\n      fileArr.push(name03);\r\n    }\r\n    filenameObj[element] = fileArr;\r\n  }\r\n  let filenameObjCopy = JSON.parse(JSON.stringify(filenameObj));\r\n  for (const key in filenameObj) {\r\n    const val = filenameObj[key];\r\n    const len = val.length;\r\n    const bName = key.split(\&#34;.\&#34;)[0];\r\n    if (len === 1) {\r\n      const srcPath = path.join(cssDir, key);\r\n      const destPath = path.join(devSssDir, `${bName}.scss`);\r\n      fs.copyFileSync(srcPath, destPath);\r\n      delete filenameObjCopy[key];\r\n    } else if (len === 2) {\r\n      const path01 = path.join(cssDir, `${bName}.scss`);\r\n      const path02 = path.join(cssDir, `${bName}.css`);\r\n      if (fs.existsSync(path01)) {\r\n        const srcPath = path.join(cssDir, `${bName}.scss`);\r\n        const destPath = path.join(devSssDir, `${bName}.scss`);\r\n        fs.renameSync(srcPath, destPath);\r\n      } else if (fs.existsSync(path02)) {\r\n        const srcPath = path.join(cssDir, `${bName}.css`);\r\n        const destPath = path.join(devSssDir, `${bName}.scss`);\r\n        if (fs.existsSync(srcPath)) {\r\n          fs.copyFileSync(srcPath, destPath);\r\n        }\r\n      }\r\n      delete filenameObjCopy[key];\r\n    } else if (len === 3) {\r\n      const srcPath = path.join(cssDir, `${bName}.scss`);\r\n      const destPath = path.join(devSssDir, `${bName}.scss`);\r\n      if (fs.existsSync(srcPath)) {\r\n        fs.renameSync(srcPath, destPath);\r\n        delete filenameObjCopy[key];\r\n      }\r\n      delete filenameObjCopy[key];\r\n    }\r\n  }\r\n});\r\n&#34;,
  &#34;fileMoveJs.js&#34;: &#34;const fs = require(\&#34;fs\&#34;);\r\nconst fs2 = require(\&#34;fs\&#34;).promises;\r\nconst path = require(\&#34;path\&#34;);\r\nconst { minify } = require(\&#34;terser\&#34;);\r\n\r\nconst langs = [\&#34;ar\&#34;, \&#34;de\&#34;, \&#34;en\&#34;, \&#34;es\&#34;, \&#34;fr\&#34;, \&#34;it\&#34;, \&#34;jp\&#34;, \&#34;kr\&#34;, \&#34;pt\&#34;, \&#34;tw\&#34;];\r\n\r\nlangs.forEach((curLan) =&gt; {\r\n  const srcDir = path.join(\&#34;.\&#34;, curLan, \&#34;dist\&#34;, \&#34;js\&#34;);\r\n  const destDir = path.join(\&#34;.\&#34;, curLan, \&#34;dev\&#34;, \&#34;js\&#34;);\r\n\r\n  const specialFiles = [\&#34;lottie-player.js\&#34;];\r\n\r\n  if (!fs.existsSync(destDir)) {\r\n    fs.mkdirSync(destDir, { recursive: true });\r\n  }\r\n\r\n  const compressJS = async (filePath) =&gt; {\r\n    try {\r\n      const fileContent = await fs2.readFile(filePath, \&#34;utf-8\&#34;);\r\n      const minified = await minify(fileContent);\r\n      let originalFileName = null;\r\n      originalFileName = path.basename(filePath, path.extname(filePath));\r\n      if (originalFileName === \&#34;blogDetail\&#34;) {\r\n        originalFileName = `blogDetail.js`;\r\n      } else {\r\n        originalFileName = `${originalFileName}.min.js`;\r\n      }\r\n      await fs2.writeFile(path.join(srcDir, originalFileName), minified.code);\r\n    } catch (error) {\r\n      console.error(`压缩和混淆文件 ${filePath} 时出错：`, error);\r\n    }\r\n  };\r\n\r\n  fs.readdir(srcDir, (err, files) =&gt; {\r\n    if (err) {\r\n      console.error(\&#34;读取源文件夹出错:\&#34;, err);\r\n      return;\r\n    }\r\n    files.forEach((file) =&gt; {\r\n      if (path.extname(file).toLowerCase() === \&#34;.js\&#34;) {\r\n        const srcFilePath = path.join(srcDir, file);\r\n        let destFilePath = path.join(destDir, file);\r\n        if (specialFiles.includes(file)) {\r\n          const newFileName = `${file.split(\&#34;.\&#34;)[0]}.min.js`;\r\n          const newSrcFilePath = path.join(srcDir, newFileName);\r\n          fs.renameSync(srcFilePath, newSrcFilePath);\r\n        } else if (!file.includes(\&#34;.min.\&#34;)) {\r\n          fs.rename(srcFilePath, destFilePath, (err) =&gt; {\r\n            if (err) {\r\n              console.error(`移动文件 ${file} 出错:`, err);\r\n            } else {\r\n              const currentPath = `${destDir}\\\\${file}`;\r\n              compressJS(currentPath);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n});\r\n&#34;,
  &#34;start.js&#34;: &#34;const chokidar = require(\&#34;chokidar\&#34;);\r\nconst liveServer = require(\&#34;live-server\&#34;);\r\nconst sass = require(\&#34;node-sass\&#34;);\r\nconst { minify } = require(\&#34;terser\&#34;);\r\nvar ejs = require(\&#34;ejs\&#34;);\r\nconst path = require(\&#34;path\&#34;);\r\nconst fs = require(\&#34;fs\&#34;).promises;\r\nconst fs2 = require(\&#34;fs\&#34;);\r\n\r\nconst langs = [\&#34;ar\&#34;, \&#34;de\&#34;, \&#34;en\&#34;, \&#34;es\&#34;, \&#34;fr\&#34;, \&#34;it\&#34;, \&#34;jp\&#34;, \&#34;kr\&#34;, \&#34;pt\&#34;, \&#34;tw\&#34;],\r\n  noWatchList = [\r\n    \&#34;bottom-message\&#34;,\r\n    \&#34;credits\&#34;,\r\n    \&#34;pay\&#34;,\r\n    \&#34;share-dialog\&#34;,\r\n    \&#34;popup\&#34;,\r\n    \&#34;confirm-dialog\&#34;,\r\n    \&#34;commonSignin\&#34;,\r\n  ];\r\n\r\nconst compressAndObfuscate = async (filePath, curLan = \&#34;\&#34;) =&gt; {\r\n  const pathArr = filePath.split(\&#34;\\\\\&#34;);\r\n  const filename = pathArr[pathArr.length - 1];\r\n  const name = filename.split(\&#34;.\&#34;);\r\n  try {\r\n    const LanPath = `./${curLan}/dist/lan/index.js`;\r\n    delete require.cache[require.resolve(LanPath)];\r\n    let jsonData = require(LanPath);\r\n    const templatePath = path.join(__dirname, filePath);\r\n    ejs.renderFile(\r\n      templatePath,\r\n      {\r\n        ...jsonData,\r\n        faceSSwap: JSON.stringify(jsonData.faceSwap),\r\n        allData: JSON.stringify(jsonData),\r\n        voice_Generator: JSON.stringify(jsonData.voiceGenerator),\r\n      },\r\n      (err, result) =&gt; {\r\n        if (err) {\r\n          console.log(err);\r\n          return;\r\n        }\r\n        const htmlPath = path.join(__dirname, `./${curLan}/${name[0]}.html`);\r\n        fs2.writeFileSync(htmlPath, result);\r\n      }\r\n    );\r\n  } catch (error) {\r\n    console.error(`${filePath} 编译时出错：`, error);\r\n  }\r\n};\r\n\r\nasync function asyncEs6Json(curLan = \&#34;\&#34;) {\r\n  delete require.cache[require.resolve(`./${curLan}/dist/lan/index.js`)];\r\n  let jsonData = require(`./${curLan}/dist/lan/index.js`);\r\n  await fs.writeFile(\r\n    path.join(`./`, `./${curLan}/dist/lan/es6.js`),\r\n    `var jsonData = ${JSON.stringify(\r\n      jsonData,\r\n      null,\r\n      2\r\n    )}; export default jsonData`\r\n  );\r\n  await fs.writeFile(\r\n    path.join(`./`, `./${curLan}/dist/lan/normal.js`),\r\n    `var jsonData = ${JSON.stringify(jsonData, null, 2)}`\r\n  );\r\n}\r\n\r\nfunction getAllFilePaths(dirPath) {\r\n  const files = fs2.readdirSync(dirPath);\r\n  const filePaths = [];\r\n  for (const file of files) {\r\n    const filePath = `${dirPath}/${file}`;\r\n    if (fs2.statSync(filePath).isDirectory()) {\r\n      filePaths.push(...getAllFilePaths(filePath));\r\n    } else {\r\n      filePaths.push(filePath);\r\n    }\r\n  }\r\n  return filePaths;\r\n}\r\n\r\nconst compileSCSS = (filePath, curLan = \&#34;\&#34;) =&gt; {\r\n  return new Promise((resolve, reject) =&gt; {\r\n    const outputFilePath = path.join(\r\n      `./${curLan}/dist/css`,\r\n      path.basename(filePath).replace(\&#34;.scss\&#34;, \&#34;.css\&#34;)\r\n    );\r\n    sass.render(\r\n      {\r\n        file: filePath,\r\n        outputStyle: \&#34;compressed\&#34;,\r\n        outFile: outputFilePath,\r\n      },\r\n      (error, result) =&gt; {\r\n        if (!error) {\r\n          fs.writeFile(outputFilePath, result.css)\r\n            .then(() =&gt; {\r\n              console.log(`SCSS 文件 ${filePath} 编译成功！`);\r\n              resolve();\r\n            })\r\n            .catch((error) =&gt; {\r\n              console.error(\r\n                `写入编译后的 SCSS 文件 ${outputFilePath} 时出错：`,\r\n                error\r\n              );\r\n              reject(error);\r\n            });\r\n        } else {\r\n          console.error(`编译 SCSS 文件 ${filePath} 时出错：`, error);\r\n          reject(error);\r\n        }\r\n      }\r\n    );\r\n  });\r\n};\r\n\r\nconst compressJS = async (filePath, curLan = \&#34;\&#34;) =&gt; {\r\n  try {\r\n    const fileContent = await fs.readFile(filePath, \&#34;utf-8\&#34;);\r\n    const minified = await minify(fileContent);\r\n    let originalFileName = null;\r\n    originalFileName = path.basename(filePath, path.extname(filePath));\r\n    if (originalFileName === \&#34;blogDetail\&#34;) {\r\n      originalFileName = `blogDetail.js`;\r\n    } else {\r\n      originalFileName = `${originalFileName}.min.js`;\r\n    }\r\n    await fs.writeFile(\r\n      path.join(`./${curLan}/dist/js`, originalFileName),\r\n      minified.code\r\n    );\r\n    console.log(`文件 ${filePath} 压缩和混淆成功！`);\r\n  } catch (error) {\r\n    console.error(`压缩和混淆文件 ${filePath} 时出错：`, error);\r\n  }\r\n};\r\n\r\nfor (let i = 0; i &lt; langs.length; i++) {\r\n  let curPort = 6170;\r\n  curPort += i;\r\n  const lan = langs[i];\r\n  const ejsSourceDir = `./${lan}/ejs`;\r\n  const patilesDir = `./${lan}/patiles`;\r\n  const jsSourceDir = `./${lan}/dev/js`;\r\n  const scssSourceDir = `./${lan}/dev/scss`;\r\n  const lanJsPath = `./${lan}/dist/lan/index.js`;\r\n  const watcher = chokidar.watch(\r\n    [ejsSourceDir, jsSourceDir, scssSourceDir, patilesDir],\r\n    {\r\n      ignoreInitial: true,\r\n    }\r\n  );\r\n  watcher.on(\&#34;change\&#34;, async (filePath) =&gt; {\r\n    if (filePath.endsWith(\&#34;.ejs\&#34;)) {\r\n      if (filePath.includes(\&#34;patiles\&#34;) || filePath.includes(\&#34;components\&#34;)) {\r\n        const filePaths = getAllFilePaths(ejsSourceDir);\r\n        for (let i = 0; i &lt; filePaths.length; i++) {\r\n          let p = filePaths[i];\r\n          if (p.endsWith(\&#34;.ejs\&#34;) &amp;&amp; !p.includes(\&#34;components\&#34;)) {\r\n            p = p.replace(/\\//g, \&#34;\\\\\&#34;);\r\n            await compressAndObfuscate(p, lan);\r\n          }\r\n        }\r\n      } else {\r\n        await compressAndObfuscate(filePath, lan);\r\n      }\r\n    } else if (\r\n      filePath.endsWith(\&#34;.js\&#34;) &amp;&amp;\r\n      filePath.includes(\&#34;/dev/js/\&#34;) &amp;&amp;\r\n      !filePath.includes(\&#34;.min\&#34;)\r\n    ) {\r\n      try {\r\n        const folders = filePath.split(\&#34;\\\\\&#34;);\r\n        const parentFolder = folders[folders.length - 2];\r\n        if (!noWatchList.includes(parentFolder)) {\r\n          await compressJS(filePath, lan);\r\n        }\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    } else if (filePath.endsWith(\&#34;.scss\&#34;) &amp;&amp; filePath.includes(\&#34;/dev/scss/\&#34;)) {\r\n      try {\r\n        await compileSCSS(filePath, lan);\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    }\r\n  });\r\n  fs2.watchFile(lanJsPath, async (curr, prev) =&gt; {\r\n    if (curr.mtime !== prev.mtime) {\r\n      const filePaths = getAllFilePaths(ejsSourceDir);\r\n      for (let i = 0; i &lt; filePaths.length; i++) {\r\n        let p = filePaths[i];\r\n        if (p.endsWith(\&#34;.ejs\&#34;) &amp;&amp; !p.includes(\&#34;components\&#34;)) {\r\n          p = p.replace(/\\//g, \&#34;\\\\\&#34;);\r\n          await asyncEs6Json(lan);\r\n          await compressAndObfuscate(p, lan);\r\n        }\r\n      }\r\n      console.log(\&#34;执行完成\&#34;);\r\n    }\r\n  });\r\n  var params = {\r\n    port: curPort,\r\n    host: \&#34;0.0.0.0\&#34;,\r\n    root: `./${lan}`,\r\n    open: false,\r\n  };\r\n  liveServer.start(params);\r\n}\r\n&#34;
}</pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.js"></script>
    <script src="../js/edit.js"></script>
  </body>
</html>
