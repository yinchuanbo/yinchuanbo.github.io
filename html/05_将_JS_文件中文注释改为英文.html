<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>05 将 JS 文件中文注释改为英文</title>
    <link rel="shortcut icon" href="../code.svg" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.css"
    />
    <link rel="stylesheet" href="../css/edit-code.css" />
  </head>
  <body>
    <div class="layout">
      <div class="layout__main">
        <div class="layout__main_left html__left">
          <ul><li data-id="61" data-path="switchZhComment.js"><svg t="1725441988000" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5301" width="200" height="200"><path d="M64 1024h960V576H64z" fill="#F4AF3D" fill-opacity=".7" p-id="5302"></path><path d="M448 64L192 320h256z" fill="#9AA7B0" fill-opacity=".8" p-id="5303"></path><path d="M512 64v320H192v128h640V64z" fill="#9AA7B0" fill-opacity=".8" p-id="5304"></path><path d="M153.28 869.632c14.72 16 28.352 26.368 57.088 26.368 33.664 0 45.632-26.368 45.632-44.928V640h64v229.632C320 916.48 276.928 960 220.8 960c-52.544 0-83.2-15.168-105.6-43.52l38.08-46.848zM446.272 736.128c0-23.616 19.904-32.128 55.808-32.128H576v-64H503.04C433.792 640 384 669.44 384 732.8c0 55.36 26.88 79.36 94.144 93.824 49.28 10.56 65.6 20.032 65.6 40.448 0 20.48-22.912 28.928-65.6 28.928H403.2v64h74.944C608 960 608 896 608 867.072c0-40.448-30.72-72.128-85.824-89.664-55.168-17.536-75.904-17.728-75.904-41.28z" fill="#231F20" fill-opacity=".7" p-id="5305"></path></svg>switchZhComment.js</li></ul>
          <div class="left__border"></div>
        </div>
        <div class="layout__main_right"></div>
        
          <div class="layout__main_nav">
            <a href="/articles/html/05 将 JS 文件中文注释改为英文 - download/download.zip"><svg t="1725527866228" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6724" width="25" height="25"><path d="M896 672c-17.066667 0-32 14.933333-32 32v128c0 6.4-4.266667 10.666667-10.666667 10.666667H170.666667c-6.4 0-10.666667-4.266667-10.666667-10.666667v-128c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v128c0 40.533333 34.133333 74.666667 74.666667 74.666667h682.666666c40.533333 0 74.666667-34.133333 74.666667-74.666667v-128c0-17.066667-14.933333-32-32-32z" fill="#fff" p-id="6725"></path><path d="M488.533333 727.466667c6.4 6.4 14.933333 8.533333 23.466667 8.533333s17.066667-2.133333 23.466667-8.533333l213.333333-213.333334c12.8-12.8 12.8-32 0-44.8-12.8-12.8-32-12.8-44.8 0l-157.866667 157.866667V170.666667c0-17.066667-14.933333-32-32-32s-34.133333 14.933333-34.133333 32v456.533333L322.133333 469.333333c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8l211.2 213.333334z" fill="#fff" p-id="6726"></path></svg></a>
          </div>
        
      </div>
    </div>
    <pre id="pre" style="display: none">{
  &#34;switchZhComment.js&#34;: &#34;const fs = require(\&#34;fs-extra\&#34;);\r\nconst path = require(\&#34;path\&#34;);\r\nconst acorn = require(\&#34;acorn\&#34;);\r\nconst { Translator } = require(\&#34;google-translate-api-x\&#34;);\r\nconst fetch = require(\&#34;node-fetch\&#34;);\r\nglobal.fetch = fetch;\r\n\r\nconst languageDirs = [\r\n  \&#34;en\&#34;,\r\n  \&#34;ar\&#34;,\r\n  \&#34;de\&#34;,\r\n  \&#34;es\&#34;,\r\n  \&#34;fr\&#34;,\r\n  \&#34;it\&#34;,\r\n  \&#34;jp\&#34;,\r\n  \&#34;kr\&#34;,\r\n  \&#34;pt\&#34;,\r\n  \&#34;tw\&#34;,\r\n];\r\n\r\nconst paths = `/dist/js/`;\r\n\r\nconst noWatchList = [\r\n  \&#34;bottom-message\&#34;,\r\n  \&#34;credits\&#34;,\r\n  \&#34;pay\&#34;,\r\n  \&#34;share-dialog\&#34;,\r\n  \&#34;popup\&#34;,\r\n  \&#34;confirm-dialog\&#34;,\r\n  \&#34;commonSignin\&#34;,\r\n  \&#34;self-select\&#34;,\r\n];\r\n\r\nconst getFilesInDirectory = (dir, noWatchList) =&gt; {\r\n  let filesFound = [];\r\n  const filesAndDirs = fs.readdirSync(dir);\r\n  filesAndDirs.forEach((item) =&gt; {\r\n    const fullPath = path.join(dir, item);\r\n    const stat = fs.statSync(fullPath);\r\n    if (stat.isDirectory()) {\r\n      if (noWatchList.includes(item)) {\r\n        const jsFiles = fs\r\n          .readdirSync(fullPath)\r\n          .filter((file) =&gt; file.endsWith(\&#34;.js\&#34;))\r\n          .map((file) =&gt; path.join(fullPath, file));\r\n        filesFound = filesFound.concat(jsFiles);\r\n      }\r\n    }\r\n  });\r\n  return filesFound;\r\n};\r\n\r\nasync function translateComments(inputPath, outputPath) {\r\n  const code = await fs.readFile(inputPath, \&#34;utf-8\&#34;);\r\n  const comments = [];\r\n  const ast = acorn.parse(code, {\r\n    ecmaVersion: 2023,\r\n    sourceType: \&#34;module\&#34;,\r\n    locations: true,\r\n    onComment: (block, text, start, end) =&gt; {\r\n      comments.push({\r\n        type: block ? \&#34;Block\&#34; : \&#34;Line\&#34;,\r\n        value: text,\r\n        start,\r\n        end,\r\n      });\r\n    },\r\n  });\r\n\r\n  const translator = new Translator();\r\n  for (let comment of comments) {\r\n    if (/[\\u4e00-\\u9fa5]/.test(comment.value)) {\r\n      const translated = await translator.translate(comment.value.trim(), {\r\n        from: \&#34;zh-CN\&#34;,\r\n        to: \&#34;en\&#34;,\r\n      });\r\n      comment.translatedValue = translated.text;\r\n    }\r\n  }\r\n  let result = \&#34;\&#34;;\r\n  let lastIndex = 0;\r\n  for (let comment of comments) {\r\n    result += code.slice(lastIndex, comment.start);\r\n    if (comment.translatedValue) {\r\n      result +=\r\n        comment.type === \&#34;Line\&#34;\r\n          ? \&#34;//\&#34; + comment.translatedValue\r\n          : \&#34;/*\&#34; + comment.translatedValue + \&#34;*/\&#34;;\r\n    } else {\r\n      result += code.slice(comment.start, comment.end);\r\n    }\r\n    lastIndex = comment.end;\r\n  }\r\n  result += code.slice(lastIndex);\r\n  await fs.outputFile(outputPath, result);\r\n  console.log(`Translated file saved to: ${outputPath}`);\r\n}\r\n\r\nconst translateCommentsInAllDirectories = async () =&gt; {\r\n  for (const langDir of languageDirs) {\r\n    const targetDir = `./${langDir}${paths}`;\r\n    const jsFilesInNoWatchListDirs = getFilesInDirectory(\r\n      targetDir,\r\n      noWatchList\r\n    );\r\n    for (const file of jsFilesInNoWatchListDirs) {\r\n      const inputPath = file;\r\n      const outputPath = file;\r\n      if (!fs.existsSync(inputPath)) {\r\n        console.error(`Error: Input file \&#34;${inputPath}\&#34; does not exist.`);\r\n        process.exit(1);\r\n      }\r\n      translateComments(inputPath, outputPath).catch((err) =&gt; {\r\n        console.error(\&#34;Translation error:\&#34; + inputPath, err, inputPath);\r\n        process.exit(1);\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\ntranslateCommentsInAllDirectories();\r\n&#34;
}</pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.js"></script>
    <script src="../js/edit.js"></script>
  </body>
</html>
